// This snippet file was generated by processing the source file:
// ./firestore-next/test.firestore.js
//
// To update the snippets in this file, edit the source and then run
// 'npm run snippets'.

// [START server_timestamp_resolution_options_modular]
import { doc, updateDoc, serverTimestamp, onSnapshot } from "firebase/firestore";
// Perform an update followed by an immediate read without
// waiting for the update to complete. Due to the snapshot
// options we will get two results: one with an estimate
// timestamp and one with the resolved server timestamp.
const docRef = doc(db, 'objects', 'some-id');
updateDoc(docRef, {
    timestamp: serverTimestamp()
});

onSnapshot(docRef, (snapshot) => {
  const data = snapshot.data({
    // Options: 'estimate', 'previous', or 'none'
    serverTimestamps: "estimate"
  });
  console.log(
      'Timestamp: ' + data.timestamp +
      ', pending: ' + snapshot.metadata.hasPendingWrites);
});
// [END server_timestamp_resolution_options_modular]