(function() { var Promise = firebase && firebase.INTERNAL.Promise; var g,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba=function(){ba=function(){};k.Symbol||(k.Symbol=ca)},ca=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}(),ea=function(){ba();var a=k.Symbol.iterator;a||(a=k.Symbol.iterator=k.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&
aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return da(this)}});ea=function(){}},da=function(a){var b=0;return fa(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})},fa=function(a){ea();a={next:a};a[k.Symbol.iterator]=function(){return this};return a},m=function(a){ea();var b=a[Symbol.iterator];return b?b.call(a):da(a)},ha="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},ia;
if("function"==typeof Object.setPrototypeOf)ia=Object.setPrototypeOf;else{var ja;a:{var ka={a:!0},la={};try{la.__proto__=ka;ja=la.a;break a}catch(a){}ja=!1}ia=ja?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
var ma=ia,n=function(a,b){a.prototype=ha(b.prototype);a.prototype.constructor=a;if(ma)ma(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype},na=function(a){if(!(a instanceof Array)){a=m(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a},oa=function(a,b){if(b){var c=k;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=
a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}};oa("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}});
oa("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b){b(a)})}if(a)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a)};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=k.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(w){this.asyncThrow_(w)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(p){b.reject(p)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(p){this.reject_(p);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(w){c.reject(w)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(Qc){f(Qc)}}:b}var d,f,h=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,
d),c(b,f));return h};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=
m(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,d)})};e.all=function(a){var b=m(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){h[b]=c;l--;0==l&&a(h)}}var h=[],l=0;do h.push(void 0),l++,c(d.value).callWhenSettled_(f(h.length-1),e),d=b.next();while(!d.done)})};return e});
var pa=function(a,b){ea();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};oa("Array.prototype.keys",function(a){return a?a:function(){return pa(this,function(a){return a})}});oa("Array.prototype.values",function(a){return a?a:function(){return pa(this,function(a,c){return c})}});
var qa=qa||{},q=this,ra=function(a){return void 0!==a},r=function(a){return"string"==typeof a},sa=function(a){return"number"==typeof a},ta=function(){},ua=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";
if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==b&&"undefined"==typeof a.call)return"object";return b},va=function(a){return"array"==ua(a)},wa=function(a){var b=ua(a);return"array"==b||"object"==b&&"number"==typeof a.length},xa=function(a){return"function"==ua(a)},ya=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},za="closure_uid_"+(1E9*Math.random()>>>
0),Aa=0,Ba=function(a,b,c){return a.call.apply(a.bind,arguments)},Ca=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},t=function(a,b,c){t=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ba:Ca;return t.apply(null,arguments)},Da=function(a,b){var c=
Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}},Ea=Date.now||function(){return+new Date},u=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};var v;v="undefined"!==typeof window?window:"undefined"!==typeof self?self:global;
var __extends=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},__rest=function(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"===typeof Object.getOwnPropertySymbols){var e=
0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&(c[d[e]]=a[d[e]])}return c},__decorate=function(a,b,c,d){var e=arguments.length,f=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;var h=v.Reflect;if("object"===typeof h&&h&&"function"===typeof h.decorate)f=h.decorate(a,b,c,d);else for(var l=a.length-1;0<=l;l--)if(h=a[l])f=(3>e?h(f):3<e?h(b,c,f):h(b,c))||f;return 3<e&&f&&Object.defineProperty(b,c,f),f},__metadata=function(a,b){var c=v.Reflect;if("object"===typeof c&&
c&&"function"===typeof c.metadata)return c.metadata(a,b)},__param=function(a,b){return function(c,d){b(c,d,a)}},__awaiter=function(a,b,c,d){return new (c||(c=Promise))(function(e,f){function h(a){try{p(d.next(a))}catch(B){f(B)}}function l(a){try{p(d["throw"](a))}catch(B){f(B)}}function p(a){a.done?e(a.value):(new c(function(b){b(a.value)})).then(h,l)}p((d=d.apply(a,b)).next())})},__generator=function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(f)throw new TypeError("Generator is already executing.");
for(;e;)try{if(f=1,h&&(l=h[c[0]&2?"return":c[0]?"throw":"next"])&&!(l=l.call(h,c[1])).done)return l;if(h=0,l)c=[0,l.value];switch(c[0]){case 0:case 1:l=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++;h=c[1];c=[0];continue;case 7:c=e.ops.pop();e.trys.pop();continue;default:if(!(l=e.trys,l=0<l.length&&l[l.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!l||c[1]>l[0]&&c[1]<l[3]))e.label=c[1];else if(6===c[0]&&e.label<l[1])e.label=l[1],l=c;else if(l&&e.label<l[2])e.label=
l[2],e.ops.push(c);else{l[2]&&e.ops.pop();e.trys.pop();continue}}c=b.call(a,e)}catch(w){c=[6,w],h=0}finally{f=l=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},f,h,l;return{next:c(0),"throw":c(1),"return":c(2)}},__values=function(a){var b="function"===typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){a&&c>=a.length&&(a=void 0);return{value:a&&a[c++],done:!a}}}},__read=function(a,
b){var c="function"===typeof Symbol&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[];try{for(;(void 0===b||0<b--)&&!(d=a.next()).done;)e.push(d.value)}catch(h){var f={error:h}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error;}}return e},__spread=function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(__read(arguments[b]));return a};
"undefined"!==typeof v.COMPILED&&v.COMPILED||(v.__extends=__extends,v.__assign=__assign,v.__rest=__rest,v.__extends=__extends,v.__decorate=__decorate,v.__metadata=__metadata,v.__param=__param,v.__awaiter=__awaiter,v.__generator=__generator,v.__values=__values,v.__read=__read,v.__spread=__spread);var Fa=function(){var a=this;this.promise=new Promise(function(b,c){a.resolve=b;a.reject=c})};var Ga=1;function x(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];0>=Ga&&(e=(new Date).toISOString(),d=d.map(Ha),console.log.apply(console,[].concat(["Firestore (0.5.0) "+e+" ["+a+"]: "+b],na(d))))}function Ia(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];1>=Ga&&(d=(new Date).toISOString(),c=c.map(Ha),console.error.apply(console,[].concat(["Firestore (0.5.0) "+d+": "+a],na(c))))}
function Ha(a){if("string"===typeof a)return a;try{return JSON.stringify(a)}catch(b){return a}};function y(a){a="FIRESTORE (0.5.0) INTERNAL ASSERTION FAILED: "+a;Ia(a);throw Error(a);}function z(a,b){a||y(b)};var Ja,Ka=function(){Ja||y("Platform not set");return Ja};var A=function(a,b){var c=Error.call(this,b);this.message=c.message;"stack"in c&&(this.stack=c.stack);var d=this;this.code=a;this.message=b;this.name="FirebaseError";this.toString=function(){return d.name+": [code="+d.code+"]: "+d.message}};n(A,Error);function La(a,b){function c(){var a="This constructor is private.";b&&(a=a+" "+b);throw new A("invalid-argument",a);}c.prototype=a.prototype;for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c};function Ma(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function Na(a,b){for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=parseInt(c,10);isNaN(d)||b(d,a[c])}}function Oa(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function Pa(a){z(null!=a&&"object"===typeof a,"isEmpty() expects object parameter.");for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}
function Qa(a){z(a&&"object"===typeof a,"shallowCopy() expects object parameter.");var b={},c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b};function C(a,b,c){if(b.length!==c)throw new A("invalid-argument","Function "+a+"() requires "+Ra(c,"argument")+", but was called with "+Ra(b.length,"argument")+".");}function Sa(a,b,c){if(b.length<c)throw new A("invalid-argument","Function "+a+"() requires at least "+Ra(c,"argument")+", but was called with "+Ra(b.length,"argument")+".");}
function Ta(a,b,c,d){if(b.length<c||b.length>d)throw new A("invalid-argument","Function "+a+"() requires between "+c+" and "+(d+" arguments, but was called with ")+Ra(b.length,"argument")+".");}function D(a,b,c,d){Ua(a,b,Va(c)+" argument",d)}function Wa(a,b,c,d){void 0!==d&&D(a,b,c,d)}function Xa(a,b,c,d){void 0!==d&&Ua(a,b,c+" option",d)}
function Ua(a,b,c,d){if(typeof d!==b||"object"===b&&!Ya(d))throw d=Za(d),new A("invalid-argument","Function "+a+"() requires its "+c+" "+("to be of type "+b+", but it was: "+d));}function Ya(a){return"object"===typeof a&&null!==a&&Object.getPrototypeOf(a)===Object.prototype}
function Za(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"===typeof a)return 20<a.length&&(a=a.substring(0,20)+"..."),JSON.stringify(a);if("number"===typeof a||"boolean"===typeof a)return""+a;if("object"===typeof a){if(a instanceof Array)return"an array";a:{if(a.constructor&&(a=/function\s+([^\s(]+)\s*\(/.exec(a.constructor.toString()))&&1<a.length){a=a[1];break a}a=null}return a?"a custom "+a+" object":"an object"}return"function"===typeof a?"a function":y("Unknown wrong type: "+
typeof a)}function $a(a,b,c){if(void 0===c)throw new A("invalid-argument","Function "+a+"() requires a valid "+Va(b)+" argument, but it was undefined.");}function ab(a,b,c){Oa(b,function(b){if(0>c.indexOf(b))throw new A("invalid-argument","Unknown option '"+b+"' passed to function "+a+"(). Available options: "+c.join(", "));})}function bb(a,b,c){c=Za(c);return new A("invalid-argument","Function "+a+"() requires its "+Va(1)+" "+("argument to be a "+b+", but it was: "+c))}
function Va(a){switch(a){case 1:return"first";case 2:return"second";case 3:return"third";default:return a+"th"}}function Ra(a,b){return a+" "+b+(1===a?"":"s")};var cb=function(){for(var a="",b=0;20>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));z(20===a.length,"Invalid auto ID: "+a);return a};function E(a,b){return a<b?-1:a>b?1:0}function db(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!a[c].equals(b[c]))return!1;return!0};function eb(){if("undefined"===typeof Uint8Array)throw new A("unimplemented","Uint8Arrays are not available in this environment.");}function fb(){if(!Ka().base64Available)throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.");}
var gb=function(a){fb();this._binaryString=a},hb=function(a){C("Blob.fromBase64String",arguments,1);D("Blob.fromBase64String","string",1,a);fb();try{var b=Ka().atob(a);return new gb(b)}catch(c){throw new A("invalid-argument","Failed to construct Blob from Base64 string: "+c);}},ib=function(a){C("Blob.fromUint8Array",arguments,1);eb();if(!(a instanceof Uint8Array))throw bb("Blob.fromUint8Array","Uint8Array",a);var b=Array.prototype.map.call(a,function(a){return String.fromCharCode(a)}).join("");return new gb(b)};
g=gb.prototype;g.toBase64=function(){C("Blob.toBase64",arguments,0);fb();return Ka().btoa(this._binaryString)};g.toUint8Array=function(){C("Blob.toUint8Array",arguments,0);eb();for(var a=new Uint8Array(this._binaryString.length),b=0;b<this._binaryString.length;b++)a[b]=this._binaryString.charCodeAt(b);return a};g.toString=function(){return"Blob(base64: "+this.toBase64()+")"};g._equals=function(a){return this._binaryString===a._binaryString};g._compareTo=function(a){return E(this._binaryString,a._binaryString)};
var jb=La(gb,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead.");var kb=function(a){this.uid=a},lb=function(a){return null==a.uid?"anonymous-user":"uid:"+a.uid};kb.prototype.equals=function(a){return a.uid===this.uid};var mb=new kb(null),nb=new kb("google-credentials-uid"),ob=new kb("first-party-uid");var pb=function(a,b){this.user=b;this.type="OAuth";this.authHeaders={Authorization:"Bearer "+a}},rb=function(){this.userListener=null};rb.prototype.getToken=function(){return Promise.resolve(null)};rb.prototype.setUserChangeListener=function(a){z(!this.userListener,"Can only call setUserChangeListener() once.");this.userListener=a;a(mb)};rb.prototype.removeUserChangeListener=function(){z(null!==this.userListener,"removeUserChangeListener() when no listener registered");this.userListener=null};
var sb=function(a){var b=this;this.app=a;this.tokenListener=null;this.userCounter=0;this.userListener=null;this.tokenListener=function(){"function"!==typeof b.app.INTERNAL.getUid&&y("This version of the Firestore SDK requires at least version 3.7.0 of firebase.js.");var a=b.app.INTERNAL.getUid();z(null===a||"string"===typeof a,"Received invalid UID: "+a);a=new kb(a);b.currentUser&&a.equals(b.currentUser)||(b.currentUser=a,b.userCounter++,b.userListener&&b.userListener(b.currentUser))};this.userCounter=
0;this.app.INTERNAL.addAuthTokenListener(this.tokenListener)};sb.prototype.getToken=function(a){var b=this;z(null!=this.tokenListener,"getToken cannot be called after listener removed.");var c=this.userCounter;return this.app.INTERNAL.getToken(a).then(function(a){if(b.userCounter!==c)throw new A("aborted","getToken aborted due to uid change.");return a?(z("string"===typeof a.accessToken,"Invalid tokenData returned from getToken():"+a),new pb(a.accessToken,b.currentUser)):null})};
sb.prototype.setUserChangeListener=function(a){z(!this.userListener,"Can only call setUserChangeListener() once.");this.userListener=a;this.currentUser&&a(this.currentUser)};sb.prototype.removeUserChangeListener=function(){z(null!=this.tokenListener,"removeUserChangeListener() called twice");z(null!==this.userListener,"removeUserChangeListener() called when no listener registered");this.app.INTERNAL.removeAuthTokenListener(this.tokenListener);this.userListener=this.tokenListener=null};
var tb=function(a){this.authClient=a};tb.prototype.getToken=function(){var a=this;return new Promise(function(b,c){a.authClient.getAccessToken(function(a,e){a?c(a):b(new pb(e,nb))})})};tb.prototype.setUserChangeListener=function(a){a(nb)};tb.prototype.removeUserChangeListener=function(){};var ub=function(a,b){this.gapi=a;this.sessionIndex=b;this.type="FirstParty";this.user=ob;z(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")};
k.Object.defineProperties(ub.prototype,{authHeaders:{configurable:!0,enumerable:!0,get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}}}});var vb=function(a,b){this.gapi=a;this.sessionIndex=b;z(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")};vb.prototype.getToken=function(){return Promise.resolve(new ub(this.gapi,this.sessionIndex))};vb.prototype.setUserChangeListener=function(a){a(ob)};
vb.prototype.removeUserChangeListener=function(){};function wb(a){if(!a)return new rb;switch(a.type){case "google-auth":return new tb(a.client);case "gapi":return new vb(a.client,a.sessionIndex||"0");case "provider":return a.client;default:throw new A("invalid-argument","makeCredentialsProvider failed due to invalid credential type");}};var xb=function(a,b,c){this.init(a,b,c)};g=xb.prototype;g.init=function(a,b,c){void 0===b?b=0:b>a.length&&y("offset "+b+" out of range "+a.length);void 0===c?c=a.length-b:c>a.length-b&&y("length "+c+" out of range "+(a.length-b));this.segments=a;this.offset=b;this.len=c};g.construct=function(a,b,c){var d=Object.create(Object.getPrototypeOf(this));d.init(a,b,c);return d};g.equals=function(a){return 0===yb(this,a)};
g.child=function(a){var b=this.segments.slice(this.offset,this.limit());a instanceof xb?a.forEach(function(a){b.push(a)}):"string"===typeof a?b.push(a):y("Unknown parameter type for Path.child(): "+a);return this.construct(b)};g.limit=function(){return this.offset+this.length};
var zb=function(a,b){b=void 0===b?1:b;z(a.length>=b,"Can't call popFirst() with less segments");return a.construct(a.segments,a.offset+b,a.length-b)},Ab=function(a){z(!a.isEmpty(),"Can't call popLast() on empty path");return a.construct(a.segments,a.offset,a.length-1)},Bb=function(a){z(!a.isEmpty(),"Can't call firstSegment() on empty path");return a.segments[a.offset]},Cb=function(a){z(!a.isEmpty(),"Can't call lastSegment() on empty path");return a.segments[a.limit()-1]};
xb.prototype.get=function(a){z(a<this.length,"Index out of range");return this.segments[this.offset+a]};xb.prototype.isEmpty=function(){return 0===this.length};var Db=function(a,b){if(b.length<a.length)return!1;for(var c=0;c<a.length;c++)if(a.get(c)!==b.get(c))return!1;return!0};xb.prototype.forEach=function(a){for(var b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])};
var Eb=function(a){return a.segments.slice(a.offset,a.limit())},yb=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var e=a.get(d),f=b.get(d);if(e<f)return-1;if(e>f)return 1}return a.length<b.length?-1:a.length>b.length?1:0};k.Object.defineProperties(xb.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this.len}}});var Fb=function(a){xb.apply(this,arguments)};n(Fb,xb);Fb.prototype.canonicalString=function(){return Eb(this).join("/")};Fb.prototype.toString=function(){return this.canonicalString()};
var Gb=function(a){if(0<=a.indexOf("//"))throw new A("invalid-argument","Invalid path ("+a+"). Paths must not contain // in them.");a=a.split("/").filter(function(a){return 0<a.length});return new Fb(a)},Hb=new Fb([]),Ib=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Jb=function(a){xb.apply(this,arguments)};n(Jb,xb);Jb.prototype.canonicalString=function(){return Eb(this).map(function(a){a=a.replace("\\","\\\\").replace("`","\\`");Ib.test(a)||(a="`"+a+"`");return a}).join(".")};Jb.prototype.toString=function(){return this.canonicalString()};
var Kb=function(a){return 1===a.length&&"__name__"===a.get(0)},Lb=function(){return new Jb(["__name__"])},Mb=function(a){for(var b=[],c="",d=0,e=function(){if(0===c.length)throw new A("invalid-argument","Invalid field path ("+a+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");b.push(c);c=""},f=!1;d<a.length;){var h=a[d];if("\\"===h){if(d+1===a.length)throw new A("invalid-argument","Path has trailing escape character: "+a);h=a[d+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new A("invalid-argument",
"Path has invalid escape sequence: "+a);c+=h;d+=2}else"`"===h?f=!f:"."!==h||f?c+=h:e(),d++}e();if(f)throw new A("invalid-argument","Unterminated ` in path: "+a);return new Jb(b)},Nb=new Jb([]);var Ob=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];if(!(b instanceof Array)||1>b.length)throw new A("invalid-argument","Function FieldPath() requires its fieldNames argument to be an array with at least "+(Ra(1,"element")+"."));for(c=0;c<b.length;++c)if(D("FieldPath","string",c,b[c]),0===b[c].length)throw new A("invalid-argument","Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jb(b)},Pb=new Ob(Lb().canonicalString()),Qb=
/[~\*/\[\]]/;var Rb=function(a,b,c,d){this.databaseId=a;this.persistenceKey=b;this.host=c;this.ssl=d},Sb=function(a,b){this.projectId=a;this.database=b?b:"(default)"};Sb.prototype.equals=function(a){return a instanceof Sb&&a.projectId===this.projectId&&a.database===this.database};Sb.prototype.compareTo=function(a){return E(this.projectId,a.projectId)||E(this.database,a.database)};k.Object.defineProperties(Sb.prototype,{isDefaultDatabase:{configurable:!0,enumerable:!0,get:function(){return"(default)"===this.database}}});var F=function(a){this.path=a;z(0===a.length%2,"Invalid DocumentKey with an odd number of segments: "+Eb(a).join("/"))};F.prototype.equals=function(a){return null!==a&&0===yb(this.path,a.path)};F.prototype.toString=function(){return this.path.toString()};var Tb=function(a,b){return yb(a.path,b.path)},Ub=new F(new Fb([]));var Wb=function(a,b){this.comparator=a;this.root=b?b:Vb};g=Wb.prototype;g.insert=function(a,b){return new Wb(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,!1,null,null))};g.remove=function(a){return new Wb(this.comparator,this.root.remove(a,this.comparator).copy(null,null,!1,null,null))};g.get=function(a){for(var b=this.root;!b.isEmpty();){var c=this.comparator(a,b.key);if(0===c)return b.value;0>c?b=b.left:0<c&&(b=b.right)}return null};
g.indexOf=function(a){for(var b=0,c=this.root;!c.isEmpty();){var d=this.comparator(a,c.key);if(0===d)return b+c.left.size;0>d?c=c.left:(b+=c.left.size+1,c=c.right)}return-1};g.isEmpty=function(){return this.root.isEmpty()};g.minKey=function(){return this.root.minKey()};g.maxKey=function(){return this.root.maxKey()};g.inorderTraversal=function(a){return this.root.inorderTraversal(a)};g.forEach=function(a){this.inorderTraversal(function(b,c){a(b,c);return!1})};
var Yb=function(a){return new Xb(a.root,null,a.comparator)},Zb=function(a,b){return new Xb(a.root,b,a.comparator)};k.Object.defineProperties(Wb.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.root.size}}});
var Xb=function(a,b,c){this.resultGenerator=null;this.isReverse=!1;this.nodeStack=[];for(var d;!a.isEmpty();)if(d=b?c(a.key,b):1,0>d)a=this.isReverse?a.left:a.right;else if(0===d){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left},$b=function(a){z(0<a.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var b=a.nodeStack.pop();var c=a.resultGenerator?a.resultGenerator(b.key,b.value):{key:b.key,value:b.value};if(a.isReverse)for(b=b.left;!b.isEmpty();)a.nodeStack.push(b),
b=b.right;else for(b=b.right;!b.isEmpty();)a.nodeStack.push(b),b=b.left;return c},ac=function(a){return 0<a.nodeStack.length},bc=function(a,b,c,d,e){this.key=a;this.value=b;this.color=null!=c?c:!0;this.left=null!=d?d:Vb;this.right=null!=e?e:Vb;this.size=this.left.size+1+this.right.size};g=bc.prototype;g.copy=function(a,b,c,d,e){return new bc(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)};g.isEmpty=function(){return!1};
g.inorderTraversal=function(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)};g.min=function(){return this.left.isEmpty()?this:this.left.min()};g.minKey=function(){return this.min().key};g.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()};
g.insert=function(a,b,c){var d=this,e=c(a,d.key);d=0>e?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c));return cc(d)};var ec=function(a){if(a.left.isEmpty())return Vb;a.left.isRed()||a.left.left.isRed()||(a=dc(a));a=a.copy(null,null,null,ec(a.left),null);return cc(a)};
bc.prototype.remove=function(a,b){var c=this;if(0>b(a,c.key))c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=dc(c)),c=c.copy(null,null,null,c.left.remove(a,b),null);else{c.left.isRed()&&(c=fc(c));if(!(c.right.isEmpty()||c.right.isRed()||c.right.left.isRed())){var d=gc(c);d.left.left.isRed()&&(d=fc(d),d=gc(d));c=d}if(0===b(a,c.key)){if(c.right.isEmpty())return Vb;d=c.right.min();c=c.copy(d.key,d.value,null,null,ec(c.right))}c=c.copy(null,null,null,null,c.right.remove(a,b))}return cc(c)};
bc.prototype.isRed=function(){return this.color};
var cc=function(a){a.right.isRed()&&!a.left.isRed()&&(a=hc(a));a.left.isRed()&&a.left.left.isRed()&&(a=fc(a));a.left.isRed()&&a.right.isRed()&&(a=gc(a));return a},dc=function(a){a=gc(a);a.right.left.isRed()&&(a=a.copy(null,null,null,null,fc(a.right)),a=hc(a),a=gc(a));return a},hc=function(a){var b=a.copy(null,null,!0,null,a.right.left);return a.right.copy(null,null,a.color,b,null)},fc=function(a){var b=a.copy(null,null,!0,a.left.right,null);return a.left.copy(null,null,a.color,null,b)},gc=function(a){var b=
a.left.copy(null,null,!a.left.color,null,null),c=a.right.copy(null,null,!a.right.color,null,null);return a.copy(null,null,!a.color,b,c)};bc.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw y("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw y("Right child of ("+this.key+","+this.value+") is red");var a=this.left.check();if(a!==this.right.check())throw y("Black depths differ");return a+(this.isRed()?0:1)};var Vb=null,ic=function(){this.size=0};
g=ic.prototype;g.copy=function(){return this};g.insert=function(a,b){return new bc(a,b)};g.remove=function(){return this};g.isEmpty=function(){return!0};g.inorderTraversal=function(){return!1};g.minKey=function(){return null};g.maxKey=function(){return null};g.isRed=function(){return!1};g.check=function(){return 0};Vb=new ic;var jc=function(){this.changeMap=new Wb(Tb)};
jc.prototype.track=function(a){var b=a.doc.key,c=this.changeMap.get(b);c?0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,
{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):y("unsupported combination of changes: "+JSON.stringify(a)+" after "+JSON.stringify(c)):this.changeMap=this.changeMap.insert(b,a)};var kc=function(a){var b=[];a.changeMap.inorderTraversal(function(a,d){b.push(d)});return b};var G=function(a){this.comparator=a;this.data=new Wb(this.comparator)};g=G.prototype;g.has=function(a){return null!==this.data.get(a)};g.first=function(){return this.data.minKey()};g.last=function(){return this.data.maxKey()};g.indexOf=function(a){return this.data.indexOf(a)};g.forEach=function(a){this.data.inorderTraversal(function(b){a(b);return!1})};
var lc=function(a,b,c){for(var d=Zb(a.data,b[0]);ac(d);){var e=$b(d);if(0<=a.comparator(e.key,b[1]))break;c(e.key)}},mc=function(a,b,c){for(a=void 0!==c?Zb(a.data,c):Yb(a.data);ac(a)&&(c=$b(a),b(c.key)););},nc=function(a,b){a=Zb(a.data,b);return ac(a)?$b(a).key:null};G.prototype.add=function(a){return this.copy(this.data.remove(a).insert(a,!0))};G.prototype.delete=function(a){return this.has(a)?this.copy(this.data.remove(a)):this};G.prototype.isEmpty=function(){return this.data.isEmpty()};
var oc=function(a,b){var c=a;b.forEach(function(a){c=c.add(a)});return c};G.prototype.equals=function(a){if(!(a instanceof G)||this.size!==a.size)return!1;var b=Yb(this.data);for(a=Yb(a.data);ac(b);){var c=$b(b).key,d=$b(a).key;if(0!==this.comparator(c,d))return!1}return!0};G.prototype.toString=function(){var a=[];this.forEach(function(b){return a.push(b)});return"SortedSet("+a.toString()+")"};G.prototype.copy=function(a){var b=new G(this.comparator);b.data=a;return b};
k.Object.defineProperties(G.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.data.size}}});var pc=new Wb(Tb),qc=new Wb(Tb),rc=new Wb(Tb),H=new G(Tb);var sc=function(a){this.comparator=a?function(b,c){return a(b,c)||Tb(b.key,c.key)}:function(a,c){return Tb(a.key,c.key)};this.keyedMap=qc;this.sortedSet=new Wb(this.comparator)};g=sc.prototype;g.has=function(a){return null!=this.keyedMap.get(a)};g.get=function(a){return this.keyedMap.get(a)};g.first=function(){return this.sortedSet.minKey()};g.last=function(){return this.sortedSet.maxKey()};g.isEmpty=function(){return this.sortedSet.isEmpty()};
g.indexOf=function(a){return(a=this.keyedMap.get(a))?this.sortedSet.indexOf(a):-1};g.forEach=function(a){this.sortedSet.inorderTraversal(function(b){a(b);return!1})};g.add=function(a){var b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))};g.delete=function(a){var b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this};
g.equals=function(a){if(!(a instanceof sc)||this.size!==a.size)return!1;var b=Yb(this.sortedSet);for(a=Yb(a.sortedSet);ac(b);){var c=$b(b).key,d=$b(a).key;if(!c.equals(d))return!1}return!0};g.toString=function(){var a=[];this.forEach(function(b){a.push(b.toString())});return 0===a.length?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"};g.copy=function(a,b){var c=new sc;c.comparator=this.comparator;c.keyedMap=a;c.sortedSet=b;return c};
k.Object.defineProperties(sc.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.sortedSet.size}}});var tc=function(a){this.mapKeyFn=a;this.inner={}};g=tc.prototype;g.get=function(a){var b=this.mapKeyFn(a);b=this.inner[b];if(void 0!==b){b=m(b);for(var c=b.next();!c.done;c=b.next()){var d=m(c.value);c=d.next().value;d=d.next().value;if(c.equals(a))return d}}};g.has=function(a){return void 0!==this.get(a)};g.set=function(a,b){var c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d)this.inner[c]=[[a,b]];else{for(c=0;c<d.length;c++)if(d[c][0].equals(a)){d[c]=[a,b];return}d.push([a,b])}};
g.delete=function(a){var b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(var d=0;d<c.length;d++)if(c[d][0].equals(a))return 1===c.length?delete this.inner[b]:c.splice(d,1),!0;return!1};g.forEach=function(a){Oa(this.inner,function(b,c){c=m(c);for(var d=c.next();!d.done;d=c.next()){var e=m(d.value);d=e.next().value;e=e.next().value;a(d,e)}})};var uc=function(){this.listeners=[]},vc=function(a){this.syncEngine=a;this.queries=new tc(function(a){return a.canonicalId()});this.onlineState=0;this.syncEngine.subscribe(this.onChange.bind(this),this.onError.bind(this))};g=vc.prototype;
g.listen=function(a){var b=a.query,c=!1,d=this.queries.get(b);d||(c=!0,d=new uc,this.queries.set(b,d));d.listeners.push(a);a.onOnlineStateChanged(this.onlineState);d.viewSnap&&wc(a,d.viewSnap);return c?this.syncEngine.listen(b).then(function(a){return d.targetId=a}):Promise.resolve(d.targetId)};
g.unlisten=function(a){var b=a.query,c=!1,d=this.queries.get(b);d&&(a=d.listeners.indexOf(a),0<=a&&(d.listeners.splice(a,1),c=0===d.listeners.length));return c?(this.queries.delete(b),this.syncEngine.unlisten(b)):Promise.resolve()};g.onChange=function(a){a=m(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=this.queries.get(b.query);if(c){for(var d=m(c.listeners),e=d.next();!e.done;e=d.next())wc(e.value,b);c.viewSnap=b}}};
g.onError=function(a,b){var c=this.queries.get(a);if(c){c=m(c.listeners);for(var d=c.next();!d.done;d=c.next())d.value.onError(b)}this.queries.delete(a)};g.onOnlineStateChanged=function(a){this.onlineState=a;this.queries.forEach(function(b,c){c=m(c.listeners);for(var d=c.next();!d.done;d=c.next())d.value.onOnlineStateChanged(a)})};
var xc=function(a,b,c){this.query=a;this.queryObserver=b;this.raisedInitialEvent=!1;this.onlineState=0;this.options=c||{}},wc=function(a,b){z(0<b.docChanges.length||b.syncStateChanged,"We got a new snapshot with no changes?");if(!a.options.includeDocumentMetadataChanges){for(var c=[],d=m(b.docChanges),e=d.next();!e.done;e=d.next())e=e.value,3!==e.type&&c.push(e);b={query:b.query,docs:b.docs,oldDocs:b.oldDocs,docChanges:c,fromCache:b.fromCache,hasPendingWrites:b.hasPendingWrites,syncStateChanged:b.syncStateChanged}}a.raisedInitialEvent?
(0<b.docChanges.length?c=!0:(c=a.snap&&a.snap.hasPendingWrites!==b.hasPendingWrites,c=b.syncStateChanged||c?!0===a.options.includeQueryMetadataChanges:!1),c&&a.queryObserver.next(b)):yc(a,b,a.onlineState)&&zc(a,b);a.snap=b};xc.prototype.onError=function(a){this.queryObserver.error(a)};xc.prototype.onOnlineStateChanged=function(a){this.onlineState=a;this.snap&&!this.raisedInitialEvent&&yc(this,this.snap,a)&&zc(this,this.snap)};
var yc=function(a,b,c){z(!a.raisedInitialEvent,"Determining whether to raise first event but already had first event");return b.fromCache?a.options.waitForSyncWhenOnline&&2!==c?(z(b.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!b.docs.isEmpty()||2===c:!0},zc=function(a,b){z(!a.raisedInitialEvent,"Trying to raise initial events for second time");b={query:b.query,docs:b.docs,oldDocs:new sc(b.docs.comparator),docChanges:Ac(b),fromCache:b.fromCache,hasPendingWrites:b.hasPendingWrites,
syncStateChanged:!0};a.raisedInitialEvent=!0;a.queryObserver.next(b)},Ac=function(a){var b=[];a.docs.forEach(function(a){b.push({type:0,doc:a})});return b};var Bc=function(a){var b=this;this.catchCallback=this.nextCallback=null;this.result=void 0;this.error=null;this.callbackAttached=this.isDone=!1;a(function(a){b.isDone=!0;b.result=a;b.nextCallback&&b.nextCallback(a)},function(a){b.isDone=!0;b.error=a;b.catchCallback&&b.catchCallback(a)})};Bc.prototype.catch=function(a){return this.next(void 0,a)};
Bc.prototype.next=function(a,b){var c=this;this.callbackAttached&&y("Called next() or catch() twice for PersistencePromise");this.callbackAttached=!0;return this.isDone?this.error?Cc(b,this.error):Dc(a,this.result):new Bc(function(d,e){c.nextCallback=function(b){Dc(a,b).next(d,e)};c.catchCallback=function(a){Cc(b,a).next(d,e)}})};
var Ec=function(a){return new Promise(function(b,c){a.next(b,c)})},Gc=function(a){try{var b=a();return b instanceof Bc?b:I(b)}catch(c){return Fc(c)}},Dc=function(a,b){return a?Gc(function(){return a(b)}):I(b)},Cc=function(a,b){return a?Gc(function(){return a(b)}):Fc(b)},I=function(a){return new Bc(function(b){b(a)})},Fc=function(a){return new Bc(function(b,c){c(a)})},Hc=function(a){return a.reduce(function(a,c){return a.next(function(){return c})},I())};var Ic=function(){this.isEager=!0;this.sources=[];this.potentialGarbage=H};Ic.prototype.addGarbageSource=function(a){this.sources.push(a);a.setGarbageCollector(this)};Ic.prototype.removeGarbageSource=function(a){this.sources.splice(this.sources.indexOf(a),1);a.setGarbageCollector(null)};Ic.prototype.addPotentialGarbageKey=function(a){this.potentialGarbage=this.potentialGarbage.add(a)};
Ic.prototype.collectGarbage=function(a){var b=this,c=[],d=H;this.potentialGarbage.forEach(function(e){var f=Jc(b,a,e);c.push(f.next(function(a){a||(d=d.add(e));return I()}))});this.potentialGarbage=H;return Hc(c).next(function(){return d})};var Jc=function(a,b,c){var d=I(!1);return a.sources.map(function(a){return function(){return a.containsKey(b,c)}}).reduce(function(a,b){return a.next(function(a){return a?I(!0):b()})},d)};var Kc=function(a,b,c){this.query=a;this.addedKeys=b;this.removedKeys=c};var Lc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/),Mc=function(a,b){this.seconds=a;this.nanos=b;z(0<=b,"timestamp nanoseconds out of range: "+b);z(1E9>b,"timestamp nanoseconds out of range"+b);z(-62135596800<=a,"timestamp seconds out of range: "+a);z(253402300800>a,"timestamp seconds out of range"+a)},Nc=function(a){var b=Math.floor(a/1E3);return new Mc(b,1E6*(a-1E3*b))},Oc=function(a){return 1E3*a.seconds+a.nanos/1E6};
Mc.prototype.compareTo=function(a){return this.seconds===a.seconds?E(this.nanos,a.nanos):E(this.seconds,a.seconds)};Mc.prototype.equals=function(a){return a.seconds===this.seconds&&a.nanos===this.nanos};Mc.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanos="+this.nanos+")"};var Pc=function(a){this.timestamp=a};Pc.prototype.compareTo=function(a){return this.timestamp.compareTo(a.timestamp)};Pc.prototype.equals=function(a){return this.timestamp.equals(a.timestamp)};Pc.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"};Pc.prototype.toTimestamp=function(){return this.timestamp};var J=new Pc(new Mc(0,0));var Rc=function(a,b,c,d){c=void 0===c?J:c;d=void 0===d?Ka().emptyByteString:d;this.query=a;this.targetId=b;this.snapshotVersion=c;this.resumeToken=d};Rc.prototype.update=function(a){return new Rc(this.query,this.targetId,a.snapshotVersion,a.resumeToken)};Rc.prototype.equals=function(a){return this.targetId===a.targetId&&this.snapshotVersion.equals(a.snapshotVersion)&&this.resumeToken===a.resumeToken&&this.query.equals(a.query)};var Uc=function(){this.refsByKey=new G(Sc);this.refsByTarget=new G(Tc);this.garbageCollector=null};Uc.prototype.isEmpty=function(){return this.refsByKey.isEmpty()};
var Wc=function(a,b,c){b=new Vc(b,c);a.refsByKey=a.refsByKey.add(b);a.refsByTarget=a.refsByTarget.add(b)},Xc=function(a,b,c){b.forEach(function(b){return Wc(a,b,c)})},Zc=function(a,b,c){b.forEach(function(b){Yc(a,new Vc(b,c))})},$c=function(a,b){lc(a.refsByTarget,[new Vc(Ub,b),new Vc(Ub,b+1)],function(b){Yc(a,b)})},Yc=function(a,b){a.refsByKey=a.refsByKey.delete(b);a.refsByTarget=a.refsByTarget.delete(b);null!==a.garbageCollector&&a.garbageCollector.addPotentialGarbageKey(b.key)},ad=function(a,b){var c=
H;lc(a.refsByTarget,[new Vc(Ub,b),new Vc(Ub,b+1)],function(a){c=c.add(a.key)});return c};Uc.prototype.setGarbageCollector=function(a){this.garbageCollector=a};Uc.prototype.containsKey=function(a,b){a=nc(this.refsByKey,new Vc(b,0));return I(null!==a&&b.equals(a.key))};var Vc=function(a,b){this.key=a;this.targetOrBatchId=b},Sc=function(a,b){return Tb(a.key,b.key)||E(a.targetOrBatchId,b.targetOrBatchId)},Tc=function(a,b){return E(a.targetOrBatchId,b.targetOrBatchId)||Tb(a.key,b.key)};var K=function(a,b,c,d){this.key=a;this.version=b;this.data=c;this.hasLocalMutations=d.hasLocalMutations};K.prototype.field=function(a){return this.data.field(a)};K.prototype.value=function(){return this.data.value()};K.prototype.equals=function(a){return a instanceof K&&this.key.equals(a.key)&&this.version.equals(a.version)&&this.data.equals(a.data)&&this.hasLocalMutations===a.hasLocalMutations};
K.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", "+("{hasLocalMutations: "+this.hasLocalMutations+"})")};var bd=function(a,b){this.key=a;this.version=b};bd.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"};bd.prototype.equals=function(a){return a&&a.version.equals(this.version)&&a.key.equals(this.key)};var cd=function(a,b,c){this.snapshotVersion=a;this.targetChanges=b;this.documentUpdates=c},dd=function(a,b){a.documentUpdates=a.documentUpdates.insert(b.key,b)},ed=function(){this.docs=H};ed.prototype.add=function(a){this.docs=this.docs.add(a)};ed.prototype.delete=function(a){this.docs=this.docs.delete(a)};ed.prototype.equals=function(a){return null!==a&&this.docs.equals(a.docs)};k.Object.defineProperties(ed.prototype,{documents:{configurable:!0,enumerable:!0,get:function(){return this.docs}}});
var fd=function(){this.removedDocuments=this.addedDocuments=H},gd=function(a,b){var c=b;a.addedDocuments.forEach(function(a){return c=c.add(a)});a.removedDocuments.forEach(function(a){return c=c.delete(a)});return c};fd.prototype.add=function(a){this.addedDocuments=this.addedDocuments.add(a);this.removedDocuments=this.removedDocuments.delete(a)};fd.prototype.delete=function(a){this.addedDocuments=this.addedDocuments.delete(a);this.removedDocuments=this.removedDocuments.add(a)};
fd.prototype.equals=function(a){return null!==a&&this.addedDocuments.equals(a.addedDocuments)&&this.removedDocuments.equals(a.removedDocuments)};var hd=Number,id=hd.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),jd=hd.MAX_SAFE_INTEGER||Math.pow(2,53)-1,kd=hd.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};function ld(a){return null===a||void 0===a};var md=function(){};md.prototype.toString=function(){var a=this.value();return null===a?"null":a.toString()};var nd=function(a,b){z(a.typeOrder!==b.typeOrder,"Default compareTo should not be used for values of same type.");return E(a.typeOrder,b.typeOrder)},od=function(){this.typeOrder=0;this.internalValue=null};n(od,md);od.prototype.value=function(){return null};od.prototype.equals=function(a){return a instanceof od};od.prototype.compareTo=function(a){return a instanceof od?0:nd(this,a)};
var pd=new od,qd=function(a){this.internalValue=a;this.typeOrder=1};n(qd,md);qd.prototype.value=function(){return this.internalValue};qd.prototype.equals=function(a){return a instanceof qd&&this.internalValue===a.internalValue};qd.prototype.compareTo=function(a){return a instanceof qd?E(this,a):nd(this,a)};var rd=new qd(!0),sd=new qd(!1),td=function(a){this.internalValue=a;this.typeOrder=2};n(td,md);td.prototype.value=function(){return this.internalValue};
td.prototype.compareTo=function(a){if(a instanceof td){var b=this.internalValue;a=a.internalValue;b=b<a?-1:b>a?1:b===a?0:isNaN(b)?isNaN(a)?0:-1:1}else b=nd(this,a);return b};function ud(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}var vd=function(a){td.call(this,a)};n(vd,td);vd.prototype.equals=function(a){return a instanceof vd?ud(this.internalValue,a.internalValue):!1};var wd=function(a){td.call(this,a);this.internalValue=a};n(wd,td);
wd.prototype.equals=function(a){return a instanceof wd?ud(this.internalValue,a.internalValue):!1};var xd=new wd(NaN),yd=new wd(Infinity),zd=new wd(-Infinity),Ad=function(a){this.internalValue=a;this.typeOrder=4};n(Ad,md);Ad.prototype.value=function(){return this.internalValue};Ad.prototype.equals=function(a){return a instanceof Ad&&this.internalValue===a.internalValue};Ad.prototype.compareTo=function(a){return a instanceof Ad?E(this.internalValue,a.internalValue):nd(this,a)};
var Bd=function(a){this.internalValue=a;this.typeOrder=3};n(Bd,md);Bd.prototype.value=function(){return new Date(Oc(this.internalValue))};Bd.prototype.equals=function(a){return a instanceof Bd&&this.internalValue.equals(a.internalValue)};Bd.prototype.compareTo=function(a){return a instanceof Bd?this.internalValue.compareTo(a.internalValue):a instanceof Cd?-1:nd(this,a)};var Cd=function(a){this.localWriteTime=a;this.typeOrder=3};n(Cd,md);Cd.prototype.value=function(){return null};
Cd.prototype.equals=function(a){return a instanceof Cd&&this.localWriteTime.equals(a.localWriteTime)};Cd.prototype.compareTo=function(a){return a instanceof Cd?this.localWriteTime.compareTo(a.localWriteTime):a instanceof Bd?1:nd(this,a)};Cd.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"};var Dd=function(a){this.internalValue=a;this.typeOrder=5};n(Dd,md);Dd.prototype.value=function(){return this.internalValue};
Dd.prototype.equals=function(a){return a instanceof Dd&&this.internalValue._equals(a.internalValue)};Dd.prototype.compareTo=function(a){return a instanceof Dd?this.internalValue._compareTo(a.internalValue):nd(this,a)};var L=function(a,b){this.databaseId=a;this.key=b;this.typeOrder=6};n(L,md);L.prototype.value=function(){return this.key};L.prototype.equals=function(a){return a instanceof L?this.key.equals(a.key)&&this.databaseId.equals(a.databaseId):!1};
L.prototype.compareTo=function(a){if(a instanceof L){var b=this.databaseId.compareTo(a.databaseId);return 0!==b?b:Tb(this.key,a.key)}return nd(this,a)};var Ed=function(a){this.internalValue=a;this.typeOrder=7};n(Ed,md);Ed.prototype.value=function(){return this.internalValue};Ed.prototype.equals=function(a){return a instanceof Ed&&this.internalValue._equals(a.internalValue)};Ed.prototype.compareTo=function(a){return a instanceof Ed?this.internalValue._compareTo(a.internalValue):nd(this,a)};
var Fd=function(a){this.internalValue=a;this.typeOrder=9};n(Fd,md);g=Fd.prototype;g.value=function(){var a={};this.internalValue.inorderTraversal(function(b,c){a[b]=c.value()});return a};g.forEach=function(a){this.internalValue.inorderTraversal(a)};g.equals=function(a){if(a instanceof Fd){var b=Yb(this.internalValue);for(a=Yb(a.internalValue);ac(b)&&ac(a);){var c=$b(b),d=$b(a);if(c.key!==d.key||!c.value.equals(d.value))return!1}return!ac(b)&&!ac(a)}return!1};
g.compareTo=function(a){if(a instanceof Fd){var b=Yb(this.internalValue);for(a=Yb(a.internalValue);ac(b)&&ac(a);){var c=$b(b),d=$b(a);if(c=E(c.key,d.key)||c.value.compareTo(d.value))return c}return E(ac(b),ac(a))}return nd(this,a)};
g.set=function(a,b){z(!a.isEmpty(),"Cannot set field for empty path on ObjectValue");if(1===a.length)return a=Bb(a),new Fd(this.internalValue.insert(a,b));var c=this.child(Bb(a));c instanceof Fd||(c=Gd);b=c.set(zb(a),b);a=Bb(a);return new Fd(this.internalValue.insert(a,b))};
g.delete=function(a){z(!a.isEmpty(),"Cannot delete field for empty path on ObjectValue");if(1===a.length)return new Fd(this.internalValue.remove(Bb(a)));var b=this.child(Bb(a));return b instanceof Fd?(b=b.delete(zb(a)),new Fd(this.internalValue.insert(Bb(a),b))):this};g.contains=function(a){return void 0!==this.field(a)};g.field=function(a){z(!a.isEmpty(),"Can't get field of empty path");var b=this;a.forEach(function(a){b=b instanceof Fd?b.internalValue.get(a)||void 0:void 0});return b};
g.toString=function(){return JSON.stringify(this.value())};g.child=function(a){return this.internalValue.get(a)||void 0};var Gd=new Fd(new Wb(E)),Hd=function(a){this.internalValue=a;this.typeOrder=8};n(Hd,md);g=Hd.prototype;g.value=function(){return this.internalValue.map(function(a){return a.value()})};g.forEach=function(a){this.internalValue.forEach(a)};
g.equals=function(a){if(a instanceof Hd){if(this.internalValue.length!==a.internalValue.length)return!1;for(var b=0;b<this.internalValue.length;b++)if(!this.internalValue[b].equals(a.internalValue[b]))return!1;return!0}return!1};
g.compareTo=function(a){if(a instanceof Hd){for(var b=Math.min(this.internalValue.length,a.internalValue.length),c=0;c<b;c++){var d=this.internalValue[c].compareTo(a.internalValue[c]);if(d)return d}return E(this.internalValue.length,a.internalValue.length)}return nd(this,a)};g.toString=function(){return JSON.stringify(this.value())};var Jd=function(a,b,c,d,e,f){b=void 0===b?[]:b;c=void 0===c?[]:c;this.path=a;this.explicitOrderBy=b;this.filters=c;this.limit=void 0===d?null:d;this.startAt=void 0===e?null:e;this.endAt=void 0===f?null:f;this.memoizedOrderBy=this.memoizedCanonicalId=null;this.startAt&&Id(this,this.startAt);this.endAt&&Id(this,this.endAt)},Kd=function(a,b){return new Jd(a.path,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,b,a.endAt)},Ld=function(a,b){return new Jd(a.path,a.explicitOrderBy.slice(),a.filters.slice(),
a.limit,a.startAt,b)};g=Jd.prototype;g.canonicalId=function(){if(null===this.memoizedCanonicalId){var a=this.path.canonicalString();a+="|f:";for(var b=m(this.filters),c=b.next();!c.done;c=b.next())a+=c.value.canonicalId(),a+=",";a+="|ob:";b=m(this.orderBy);for(c=b.next();!c.done;c=b.next())a+=c.value.canonicalId(),a+=",";ld(this.limit)||(a=a+"|l:"+this.limit);this.startAt&&(a=a+"|lb:"+this.startAt.canonicalId());this.endAt&&(a=a+"|ub:"+this.endAt.canonicalId());this.memoizedCanonicalId=a}return this.memoizedCanonicalId};
g.toString=function(){var a="Query("+this.path.canonicalString();0<this.filters.length&&(a+=", filters: ["+this.filters.join(", ")+"]");ld(this.limit)||(a+=", limit: "+this.limit);0<this.explicitOrderBy.length&&(a+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]");this.startAt&&(a+=", startAt: "+this.startAt.canonicalId());this.endAt&&(a+=", endAt: "+this.endAt.canonicalId());return a+")"};
g.equals=function(a){if(this.limit!==a.limit||this.orderBy.length!==a.orderBy.length)return!1;for(var b=0;b<this.orderBy.length;b++)if(!this.orderBy[b].equals(a.orderBy[b]))return!1;if(this.filters.length!==a.filters.length)return!1;for(b=0;b<this.filters.length;b++)if(!this.filters[b].equals(a.filters[b]))return!1;return this.path.equals(a.path)&&(null!==this.startAt?this.startAt.equals(a.startAt):null===a.startAt)?null!==this.endAt?this.endAt.equals(a.endAt):null===a.endAt:!1};
g.docComparator=function(a,b){for(var c=!1,d=m(this.orderBy),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.compare(a,b);if(0!==f)return f;c=c||Kb(e.field)}z(c,"orderBy used that doesn't compare on key field");return 0};
g.matches=function(a){var b=a.key.path;if(b=0===this.path.length%2?this.path.equals(b):Db(this.path,b)&&this.path.length===b.length-1)a:{b=m(this.explicitOrderBy);for(var c=b.next();!c.done;c=b.next())if(c=c.value,!Kb(c.field)&&void 0===a.field(c.field)){b=!1;break a}b=!0}if(b)a:{b=m(this.filters);for(c=b.next();!c.done;c=b.next())if(!c.value.matches(a)){b=!1;break a}b=!0}b&&(b=this.startAt&&!Md(this.startAt,this.orderBy,a)||this.endAt&&Md(this.endAt,this.orderBy,a)?!1:!0);return b};
var Nd=function(a){return 0<a.explicitOrderBy.length?a.explicitOrderBy[0].field:null},Qd=function(a){a=m(a.filters);for(var b=a.next();!b.done;b=a.next())if(b=b.value,b instanceof Od&&b.op!==Pd)return b.field;return null},Rd=function(a){return 0===a.path.length%2&&0===a.filters.length},Id=function(a,b){z(b.position.length<=a.orderBy.length,"Bound is longer than orderBy")};
k.Object.defineProperties(Jd.prototype,{orderBy:{configurable:!0,enumerable:!0,get:function(){if(null===this.memoizedOrderBy){var a=Qd(this),b=Nd(this);if(null!==a&&null===b)Kb(a)?this.memoizedOrderBy=[Td]:this.memoizedOrderBy=[new Ud(a),Td];else{z(null===a||null!==b&&a.equals(b),"First orderBy should match inequality field.");this.memoizedOrderBy=[];a=!1;b=m(this.explicitOrderBy);for(var c=b.next();!c.done;c=b.next())c=c.value,this.memoizedOrderBy.push(c),Kb(c.field)&&(a=!0);a||this.memoizedOrderBy.push((0<
this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Vd)===Vd?Td:Wd)}}return this.memoizedOrderBy}}});var Xd=function(a){this.name=a},be=function(a){switch(a){case "<":return Yd;case "<=":return Zd;case "==":return Pd;case ">=":return $d;case ">":return ae;default:return y("Unknown relation: "+a)}};Xd.prototype.toString=function(){return this.name};Xd.prototype.equals=function(a){return this.name===a.name};
var Yd=new Xd("<"),Zd=new Xd("<="),Pd=new Xd("=="),ae=new Xd(">"),$d=new Xd(">="),Od=function(a,b,c){this.field=a;this.op=b;this.value=c};Od.prototype.matches=function(a){if(Kb(this.field))return z(this.value instanceof L,"Comparing on key, but filter value not a RefValue"),a=Tb(a.key,this.value.key),ce(this,a);a=a.field(this.field);return void 0!==a&&(this.value.typeOrder!==a.typeOrder?!1:ce(this,a.compareTo(this.value)))};
var ce=function(a,b){switch(a.op){case Yd:return 0>b;case Zd:return 0>=b;case Pd:return 0===b;case ae:return 0<b;case $d:return 0<=b;default:return y("Unknown relation op"+a.op)}};Od.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()};Od.prototype.equals=function(a){return a instanceof Od?this.op.equals(a.op)&&this.field.equals(a.field)&&this.value.equals(a.value):!1};
Od.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()};var de=function(a){this.field=a};de.prototype.matches=function(a){a=a.field(this.field);return void 0!==a&&null===a.value()};de.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"};de.prototype.toString=function(){return this.field.canonicalString()+" IS null"};de.prototype.equals=function(a){return a instanceof de?this.field.equals(a.field):!1};
var ee=function(a){this.field=a};ee.prototype.matches=function(a){a=a.field(this.field).value();return"number"===typeof a&&isNaN(a)};ee.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"};ee.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"};ee.prototype.equals=function(a){return a instanceof ee?this.field.equals(a.field):!1};var fe=function(a){this.name=a};fe.prototype.toString=function(){return this.name};
var Vd=new fe("asc"),ge=new fe("desc"),he=function(a,b){this.position=a;this.before=b};he.prototype.canonicalId=function(){for(var a=this.before?"b:":"a:",b=m(this.position),c=b.next();!c.done;c=b.next())a+=c.value.toString();return a};
var Md=function(a,b,c){z(a.position.length<=b.length,"Bound has more components than query's orderBy");for(var d=0,e=0;e<a.position.length;e++){var f=b[e];d=a.position[e];if(Kb(f.field))z(d instanceof L,"Bound has a non-key value where the key path is being used."),d=Tb(d.key,c.key);else{var h=c.field(f.field);z(void 0!==h,"Field should exist since document matched the orderBy already.");d=d.compareTo(h)}f.dir===ge&&(d*=-1);if(0!==d)break}return a.before?0>=d:0>d};
he.prototype.equals=function(a){if(null===a||this.before!==a.before||this.position.length!==a.position.length)return!1;for(;0<this.position.length;)return this.position[0].equals(a.position[0]);return!0};var Ud=function(a,b){this.field=a;void 0===b&&(b=Vd);this.dir=b;this.isKeyOrderBy=Kb(a)};
Ud.prototype.compare=function(a,b){if(this.isKeyOrderBy)b=Tb(a.key,b.key);else{var c=this.field;a=a.field(c);b=b.field(c);b=void 0!==a&&void 0!==b?a.compareTo(b):y("Trying to compare documents on fields that don't exist")}switch(this.dir){case Vd:return b;case ge:return-1*b;default:return y("Unknown direction: "+this.dir)}};Ud.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()};
Ud.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"};Ud.prototype.equals=function(a){return this.dir===a.dir&&this.field.equals(a.field)};var Td=new Ud(Lb(),Vd),Wd=new Ud(Lb(),ge);var ie=function(a,b){b=void 0===b?0:b;this.generatorId=a;var c=b>>1<<1;this.previousId=b-c>=a?c|this.generatorId:(c|this.generatorId)-2};ie.prototype.next=function(){return this.previousId+=2};var je=function(a){return new ie(0,void 0===a?0:a)};var ke=function(a){this.key=a},le=function(a){this.key=a},me=function(a,b){this.query=a;this.syncedDocuments=b;this.syncState=null;this.current=!1;this.mutatedKeys=this.limboDocuments=H;this.documentSet=new sc(a.docComparator.bind(a))},ne=function(a,b,c){var d=c?c.changeSet:new jc,e=c?c.documentSet:a.documentSet,f=c?c.mutatedKeys:a.mutatedKeys,h=e,l=!1,p=ld(a.query.limit)||e.size!==a.query.limit?null:e.last();b.inorderTraversal(function(b,c){var w=e.get(b);if(c=c instanceof K?c:null)z(b.equals(c.key),
"Mismatching keys found in document changes: "+b+" != "+c.key),c=a.query.matches(c)?c:null;c?(h=h.add(c),f=c.hasLocalMutations?f.add(b):f.delete(b)):(h=h.delete(b),f=f.delete(b));w&&c?(b=w.data.equals(c.data),b&&w.hasLocalMutations===c.hasLocalMutations||(b?d.track({type:3,doc:c}):d.track({type:2,doc:c}),p&&0<a.query.docComparator(c,p)&&(l=!0))):!w&&c?d.track({type:0,doc:c}):w&&!c&&(d.track({type:1,doc:w}),p&&(l=!0))});if(!ld(a.query.limit))for(;h.size>a.query.limit;)b=h.last(),h=h.delete(b.key),
d.track({type:1,doc:b});z(!l||!c,"View was refilled using docs that themselves needed refilling.");return{documentSet:h,changeSet:d,needsRefill:l,mutatedKeys:f}},qe=function(a,b,c){z(!b.needsRefill,"Cannot apply changes that need a refill");var d=a.documentSet;a.documentSet=b.documentSet;a.mutatedKeys=b.mutatedKeys;var e=kc(b.changeSet);e.sort(function(b,c){return oe(b.type,c.type)||a.query.docComparator(b.doc,c.doc)});c=pe(a,c);var f=0===a.limboDocuments.size&&a.current?1:0,h=f!==a.syncState;a.syncState=
f;return 0!==e.length||h?{snapshot:{query:a.query,docs:b.documentSet,oldDocs:d,docChanges:e,fromCache:0===f,syncStateChanged:h,hasPendingWrites:!b.mutatedKeys.isEmpty()},limboChanges:c}:{limboChanges:c}},pe=function(a,b){if(b){var c=b.mapping;c instanceof ed?a.syncedDocuments=c.documents:c instanceof fd&&(a.syncedDocuments=gd(c,a.syncedDocuments));switch(b.currentStatusUpdate){case 2:a.current=!0;break;case 1:a.current=!1;break;case 0:break;default:y("Unknown current status update: "+b.currentStatusUpdate)}}var d=
a.limboDocuments;a.limboDocuments=H;a.current&&a.documentSet.forEach(function(b){var c=b.key;a.syncedDocuments.has(c)||!a.documentSet.has(c)||a.documentSet.get(c).hasLocalMutations||(a.limboDocuments=a.limboDocuments.add(b.key))});var e=[];d.forEach(function(b){a.limboDocuments.has(b)||e.push(new le(b))});a.limboDocuments.forEach(function(a){d.has(a)||e.push(new ke(a))});return e};
function oe(a,b){var c=function(a){switch(a){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return y("Unknown ChangeType: "+a)}};return c(a)-c(b)};var re=function(a,b,c,d){this.query=a;this.targetId=b;this.resumeToken=c;this.view=d},se=function(a,b,c){this.localStore=a;this.remoteStore=b;this.currentUser=c;this.errorHandler=this.viewHandler=null;this.queryViewsByQuery=new tc(function(a){return a.canonicalId()});this.queryViewsByTarget={};this.limboTargetsByKey=new Wb(Tb);this.limboKeysByTarget={};this.limboDocumentRefs=new Uc;this.limboCollector=new Ic;this.mutationUserCallbacks={};this.targetIdGenerator=new ie(1)};g=se.prototype;
g.subscribe=function(a,b){z(null!==a&&null!==b,"View and error handlers cannot be null");z(null===this.viewHandler&&null===this.errorHandler,"SyncEngine already has a subscriber.");this.viewHandler=a;this.errorHandler=b;this.limboCollector.addGarbageSource(this.limboDocumentRefs)};
g.listen=function(a){var b=this;te(this,"listen()");z(!this.queryViewsByQuery.has(a),"We already listen to the query: "+a);return ue(this.localStore,a).then(function(c){return ve(b.localStore,a).then(function(d){return we(b.localStore,c.targetId).then(function(e){e=new me(a,e);var f=ne(e,d);f=qe(e,f);z(0===f.limboChanges.length,"View returned limbo docs before target ack from the server.");z(!!f.snapshot,"applyChanges for new view should always return a snapshot");e=new re(a,c.targetId,c.resumeToken,
e);b.queryViewsByQuery.set(a,e);b.queryViewsByTarget[c.targetId]=e;b.viewHandler([f.snapshot]);b.remoteStore.listen(c)})}).then(function(){return c.targetId})})};g.unlisten=function(a){var b=this;te(this,"unlisten()");var c=this.queryViewsByQuery.get(a);z(!!c,"Trying to unlisten on query not found:"+a);return xe(this.localStore,a).then(function(){b.remoteStore.unlisten(c.targetId);return ye(b,c).then(function(){return b.localStore.collectGarbage()})})};
g.write=function(a,b){var c=this;te(this,"write()");return ze(this.localStore,a).then(function(a){var d=c.mutationUserCallbacks[lb(c.currentUser)];d||(d=new Wb(E));d=d.insert(a.batchId,b);c.mutationUserCallbacks[lb(c.currentUser)]=d;return Ae(c,a.changes)}).then(function(){return Be(c.remoteStore)})};
g.runTransaction=function(a,b){var c=this;b=void 0===b?5:b;z(0<=b,"Got negative number of retries for transaction.");var d=new Ce(this.remoteStore.datastore);return function(){try{var b=a(d);return!ld(b)&&b.catch&&b.then?b.catch(function(a){return Promise.reject(a)}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(f){return Promise.reject(f)}}().then(function(e){return d.commit().then(function(){return e}).catch(function(d){return 0===b?Promise.reject(d):c.runTransaction(a,
b-1)})})};g.applyRemoteEvent=function(a){var b=this;te(this,"applyRemoteEvent()");Na(a.targetChanges,function(c,d){(c=b.limboKeysByTarget[c])&&2===d.currentStatusUpdate&&!a.documentUpdates.get(c)&&dd(a,new bd(c,a.snapshotVersion))});return this.localStore.applyRemoteEvent(a).then(function(c){return Ae(b,c,a)})};
var De=function(a,b,c){te(a,"rejectListens()");var d=a.limboKeysByTarget[b];if(d)return a.limboTargetsByKey=a.limboTargetsByKey.remove(d),delete a.limboKeysByTarget[b],b=new Wb(Tb),b=b.insert(d,new bd(d,J)),a.applyRemoteEvent(new cd(J,{},b));var e=a.queryViewsByTarget[b];z(!!e,"Unknown targetId: "+b);return xe(a.localStore,e.query).then(function(){return ye(a,e).then(function(){a.errorHandler(e.query,c)})})},Fe=function(a,b){te(a,"applySuccessfulWrite()");Ee(a,b.batch.batchId,null);return a.localStore.acknowledgeBatch(b).then(function(b){return Ae(a,
b)})},He=function(a,b,c){te(a,"rejectFailedWrite()");Ee(a,b,c);return Ge(a.localStore,b).then(function(b){return Ae(a,b)})},Ee=function(a,b,c){var d=a.mutationUserCallbacks[lb(a.currentUser)];if(d){var e=d.get(b);e&&(z(b===d.minKey(),"Mutation callbacks processed out-of-order?"),c?e.reject(c):e.resolve(),d=d.remove(b));a.mutationUserCallbacks[lb(a.currentUser)]=d}},ye=function(a,b){a.queryViewsByQuery.delete(b.query);delete a.queryViewsByTarget[b.targetId];$c(a.limboDocumentRefs,b.targetId);return Ie(a)},
Je=function(a,b,c){c=m(c);for(var d=c.next();!d.done;d=c.next()){var e=d.value;if(e instanceof ke){if(Wc(a.limboDocumentRefs,e.key,b),d=a,e=e.key,!d.limboTargetsByKey.get(e)){x("SyncEngine","New document in limbo: "+e);var f=d.targetIdGenerator.next(),h=new Jd(e.path);d.limboKeysByTarget[f]=e;d.remoteStore.listen(new Rc(h,f));d.limboTargetsByKey=d.limboTargetsByKey.insert(e,f)}}else e instanceof le?(x("SyncEngine","Document no longer in limbo: "+e.key),Yc(a.limboDocumentRefs,new Vc(e.key,b))):y("Unknown limbo change: "+
JSON.stringify(e))}return Ie(a)},Ie=function(a){return Ec(a.limboCollector.collectGarbage(null).next(function(b){b.forEach(function(b){var c=a.limboTargetsByKey.get(b);null!==c&&(a.remoteStore.unlisten(c),a.limboTargetsByKey=a.limboTargetsByKey.remove(b),delete a.limboKeysByTarget[c])})}))},Ae=function(a,b,c){var d=[],e=[],f=[];a.queryViewsByQuery.forEach(function(h,l){f.push(Promise.resolve().then(function(){var c=ne(l.view,b);return c.needsRefill?ve(a.localStore,l.query).then(function(a){return ne(l.view,
a,c)}):c}).then(function(b){var f=qe(l.view,b,c&&c.targetChanges[l.targetId]);return Je(a,l.targetId,f.limboChanges).then(function(){if(f.snapshot){d.push(f.snapshot);for(var a=f.snapshot,b=H,c=H,h=m(a.docChanges),l=h.next();!l.done;l=h.next())switch(l=l.value,l.type){case 0:b=b.add(l.doc.key);break;case 1:c=c.add(l.doc.key)}e.push(new Kc(a.query,b,c))}})}))});return Promise.all(f).then(function(){a.viewHandler(d);return Ke(a.localStore,e)}).then(function(){return a.localStore.collectGarbage()})},
te=function(a,b){z(null!==a.viewHandler&&null!==a.errorHandler,"Trying to call "+b+" before calling subscribe().")};se.prototype.handleUserChange=function(a){var b=this;this.currentUser=a;return this.localStore.handleUserChange(a).then(function(a){return Ae(b,a)}).then(function(){return b.remoteStore.handleUserChange(a)})};var Le=function(a,b,c){this.batchId=a;this.localWriteTime=b;this.mutations=c};
Le.prototype.applyToRemoteDocument=function(a,b,c){b&&z(b.key.equals(a),"applyToRemoteDocument: key "+a+" should match maybeDoc key\n        "+b.key);c=c.mutationResults;z(c.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+c.length+").");for(var d=0;d<this.mutations.length;d++){var e=this.mutations[d];e.key.equals(a)&&(b=e.applyToRemoteDocument(b,c[d]))}return b};
Le.prototype.applyToLocalView=function(a,b){b&&z(b.key.equals(a),"applyToLocalDocument: key "+a+" should match maybeDoc key\n        "+b.key);for(var c=0;c<this.mutations.length;c++){var d=this.mutations[c];d.key.equals(a)&&(b=d.applyToLocalView(b,this.localWriteTime))}return b};Le.prototype.keys=function(){for(var a=H,b=m(this.mutations),c=b.next();!c.done;c=b.next())a=a.add(c.value.key);return a};Le.prototype.equals=function(a){return this.batchId===a.batchId&&db(this.mutations,a.mutations)};
var Me=function(a,b,c,d,e){this.batch=a;this.commitVersion=b;this.mutationResults=c;this.streamToken=d;this.docVersions=e},Ne=function(a,b,c,d){z(a.mutations.length===c.length,"Mutations sent "+a.mutations.length+" must equal results received "+c.length);for(var e=rc,f=a.mutations,h=0;h<f.length;h++){var l=c[h].version;null===l&&(l=b);e=e.insert(f[h].key,l)}return new Me(a,b,c,d,e)};function Oe(a){for(var b="",c=0;c<a.length;c++){0<b.length&&(b+="\u0001\u0001");for(var d=a.get(c),e=d.length,f=0;f<e;f++){var h=d.charAt(f);switch(h){case "\x00":b+="\u0001\u0010";break;case "\u0001":b+="\u0001\u0011";break;default:b+=h}}}return b+"\u0001\u0001"}
function Pe(a){var b=a.length;z(2<=b,"Invalid path "+a);if(2===b)return z("\u0001"===a.charAt(0)&&"\u0001"===a.charAt(1),"Non-empty path "+a+" had length 2"),Hb;for(var c=b-2,d=[],e="",f=0;f<b;){var h=a.indexOf("\u0001",f);(0>h||h>c)&&y('Invalid encoded resource path: "'+a+'"');switch(a.charAt(h+1)){case "\u0001":f=a.substring(f,h);0!==e.length&&(f=e+=f,e="");d.push(f);break;case "\u0010":e+=a.substring(f,h);e+="\x00";break;case "\u0011":e+=a.substring(f,h+1);break;default:y('Invalid encoded resource path: "'+
a+'"')}f=h+2}return new Fb(d)};var Qe=function(a,b){this.seconds=a;this.nanos=b},Re=function(a){var b=Date.now();this.ownerId=a;this.leaseTimestampMs=b},Se=function(a){this.userId=a;this.lastAcknowledgedBatchId=-1;this.lastStreamToken=""},Te=function(a,b,c,d){this.userId=a;this.batchId=b;this.localWriteTimeMs=c;this.mutations=d},Ue=["userId","batchId"],Ve=function(a,b,c){return[a,Oe(b),c]},We=new function(){},Xe=function(a,b){this.path=a;this.readTime=b},Ye=function(a,b){this.noDocument=a;this.document=b},Ze=function(a,b,c,d,e){this.targetId=
a;this.canonicalId=b;this.readTime=c;this.resumeToken=d;this.query=e},$e=["canonicalId","targetId"],af=function(a,b){this.targetId=a;this.path=b},bf=["targetId","path"],cf=["path","targetId"],df=function(){var a=J.toTimestamp();this.highestTargetId=0;this.lastRemoteSnapshotVersion=a},ef="mutationQueues mutations documentMutations remoteDocuments targets owner targetGlobal targetDocuments".split(" ");var ff=function(a){this.db=a},hf=function(a){z(gf(),"IndexedDB not supported in current environment.");x("SimpleDb","Opening database:",a);return Ec(new Bc(function(b,c){var d=window.indexedDB.open(a,1);d.onsuccess=function(a){b(new ff(a.target.result))};d.onerror=function(a){c(a.target.error)};d.onupgradeneeded=function(b){x("SimpleDb",'Database "'+a+'" requires upgrade from version:',b.oldVersion);var c=b.target.result;b=b.oldVersion;z(0===b,"Unexpected upgrade from version "+b);c.createObjectStore("mutationQueues",
{keyPath:"userId"});c.createObjectStore("mutations",{keyPath:Ue});c.createObjectStore("targetDocuments",{keyPath:bf}).createIndex("documentTargetsIndex",cf,{unique:!0});c.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",$e,{unique:!0});c.createObjectStore("documentMutations");c.createObjectStore("remoteDocuments");c.createObjectStore("owner");c.createObjectStore("targetGlobal")}}))},gf=function(){if("undefined"===typeof window||null==window.indexedDB)return!1;var a=
window.navigator.userAgent;return 0<a.indexOf("MSIE ")||0<a.indexOf("Trident/")||0<a.indexOf("Edge/")?!1:!0};ff.prototype.runTransaction=function(a,b,c){var d=new jf(this.db,a,b),e=Ec(c(d).catch(function(a){d.abort();return Fc(a)}));return d.completionPromise.then(function(){return e})};ff.prototype.close=function(){this.db.close()};var kf=function(a){this.dbCursor=a;this.shouldStop=!1;this.nextKey=null};kf.prototype.done=function(){this.shouldStop=!0};kf.prototype.delete=function(){return lf(this.dbCursor.delete())};
k.Object.defineProperties(kf.prototype,{isDone:{configurable:!0,enumerable:!0,get:function(){return this.shouldStop}},skipToKey:{configurable:!0,enumerable:!0,get:function(){return this.nextKey}},cursor:{configurable:!0,enumerable:!0,set:function(a){this.dbCursor=a}}});var jf=function(a,b,c){var d=this;this.aborted=!1;this.transaction=a.transaction(c,b);this.completionPromise=new Promise(function(a,b){d.transaction.onabort=d.transaction.oncomplete=function(){a()};d.transaction.onerror=function(a){b(a.target.error)}})};
jf.prototype.abort=function(){this.aborted||(x("SimpleDb","Aborting transaction."),this.aborted=!0,this.transaction.abort())};jf.prototype.store=function(a){var b=this.transaction.objectStore(a);z(!!b,"Object store not part of transaction: "+a);return new mf(b)};var mf=function(a){this.store=a};mf.prototype.put=function(a,b){void 0!==b?(x("SimpleDb","PUT",this.store.name,a,b),a=this.store.put(b,a)):(x("SimpleDb","PUT",this.store.name,"<auto-key>",a),a=this.store.put(a));return lf(a)};
mf.prototype.get=function(a){var b=this,c=this.store.get(a);return lf(c).next(function(c){void 0===c&&(c=null);x("SimpleDb","GET",b.store.name,a,c);return c})};mf.prototype.delete=function(a){x("SimpleDb","DELETE",this.store.name,a);a=this.store.delete(a);return lf(a)};
var of=function(a,b){a=a.cursor(a.options(b,void 0));var c=[];return nf(a,function(a,b){c.push(b)}).next(function(){return c})},pf=function(a,b,c){if(c)var d=b;else d={},c=b;a=a.cursor(d);return nf(a,c)},nf=function(a,b){var c=[];return(new Bc(function(d,e){a.onerror=function(a){e(a.target.error)};a.onsuccess=function(a){if(a=a.target.result){var e=new kf(a),f=b(a.primaryKey,a.value,e);f instanceof Bc&&c.push(f);e.isDone?d():null===e.skipToKey?a.continue():a.continue(e.skipToKey)}else d()}})).next(function(){return Hc(c)})};
mf.prototype.options=function(a,b){var c=void 0;void 0!==a&&("string"===typeof a?c=a:(z(void 0===b,"3rd argument must not be defined if 2nd is a range."),b=a));return{index:c,range:b}};mf.prototype.cursor=function(a){var b="next";a.reverse&&(b="prev");if(a.index){var c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}return this.store.openCursor(a.range,b)};
function lf(a){return new Bc(function(b,c){a.onsuccess=function(a){b(a.target.result)};a.onerror=function(a){c(a.target.error)}})};var qf=function(a,b){this.userId=a;this.serializer=b;this.garbageCollector=null};
qf.prototype.start=function(a){var b=this;return rf(a).next(function(c){b.nextBatchId=c;return M(a,"mutationQueues").get(b.userId)}).next(function(c){c||(c=new Se(b.userId));b.metadata=c;return b.metadata.lastAcknowledgedBatchId>=b.nextBatchId?b.checkEmpty(a).next(function(c){z(c,"Reset nextBatchID is only possible when the queue is empty");b.metadata.lastAcknowledgedBatchId=-1;return M(a,"mutationQueues").put(b.metadata)}):I()})};
var rf=function(a){var b=-1;return pf(M(a,"mutations"),{reverse:!0},function(a,d,e){var c=m(a);a=c.next().value;c.next().value>b&&(b=d.batchId);""===a?e.done():(d=a.length-1,e.nextKey=[0===a.length?"":"\x00"===a.charAt(d)?a.substring(0,d):a.substring(0,d)+String.fromCharCode(a.charCodeAt(d)-1)])}).next(function(){return b+1})};g=qf.prototype;
g.checkEmpty=function(a){var b=!0,c=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pf(M(a,"mutations"),{range:c},function(a,c,f){b=!1;f.done()}).next(function(){return b})};g.getHighestAcknowledgedBatchId=function(){return I(this.metadata.lastAcknowledgedBatchId)};
g.acknowledgeBatch=function(a,b,c){b=b.batchId;z(b>this.metadata.lastAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");this.metadata.lastAcknowledgedBatchId=b;this.metadata.lastStreamToken=sf(c);return M(a,"mutationQueues").put(this.metadata)};g.getLastStreamToken=function(){return I(this.metadata.lastStreamToken)};g.setLastStreamToken=function(a,b){this.metadata.lastStreamToken=sf(b);return M(a,"mutationQueues").put(this.metadata)};
g.addMutationBatch=function(a,b,c){var d=this,e=this.nextBatchId;this.nextBatchId++;var f=new Le(e,b,c);b=tf(this.serializer,this.userId,f);return M(a,"mutations").put(b).next(function(){for(var b=m(c),f=b.next();!f.done;f=b.next())f=f.value,Oe(f.key.path),f=Ve(d.userId,f.key.path,e),M(a,"documentMutations").put(f,We);return Hc([])}).next(function(){return f})};
g.lookupMutationBatch=function(a,b){var c=this;return M(a,"mutations").get([this.userId,b]).next(function(a){return a?uf(c.serializer,a):null})};g.getNextMutationBatchAfterBatchId=function(a,b){var c=this,d=IDBKeyRange.lowerBound([this.userId,b+1]),e=null;return pf(M(a,"mutations"),{range:d},function(a,d,l){d.userId===c.userId&&(z(d.batchId>b,"Should have found mutation after "+b),e=uf(c.serializer,d));l.done()}).next(function(){return e})};
g.getAllMutationBatches=function(a){var b=this,c=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return of(M(a,"mutations"),c).next(function(a){return a.map(function(a){return uf(b.serializer,a)})})};g.getAllMutationBatchesThroughBatchId=function(a,b){var c=this;b=IDBKeyRange.bound([this.userId,-1],[this.userId,b]);return of(M(a,"mutations"),b).next(function(a){return a.map(function(a){return uf(c.serializer,a)})})};
g.getAllMutationBatchesAffectingDocumentKey=function(a,b){var c=this,d=[this.userId,Oe(b.path)];d=IDBKeyRange.lowerBound(d);var e=[];return pf(M(a,"documentMutations"),{range:d},function(d,h,l){var f=m(d),w=f.next().value,B=f.next().value;f=f.next().value;B=Pe(B);if(w===c.userId&&b.path.equals(B)){var qb=[c.userId,f];return M(a,"mutations").get(qb).next(function(a){null===a&&y("Dangling document-mutation reference found: "+d+" which points to "+qb);e.push(uf(c.serializer,a))})}l.done()}).next(function(){return e})};
g.getAllMutationBatchesAffectingQuery=function(a,b){var c=this;z(!Rd(b),"Document queries shouldn't go down this path");var d=b.path,e=d.length+1;b=[this.userId,Oe(d)];b=IDBKeyRange.lowerBound(b);var f=new G(E);return pf(M(a,"documentMutations"),{range:b},function(a,b,p){var h=m(a);a=h.next().value;var l=h.next().value;h=h.next().value;l=Pe(l);a===c.userId&&Db(d,l)?l.length===e&&(f=f.add(h)):p.done()}).next(function(){var b=[],d=[];f.forEach(function(e){var f=[c.userId,e];d.push(M(a,"mutations").get(f).next(function(a){null===
a&&y("Dangling document-mutation reference found, which points to "+f);b.push(uf(c.serializer,a))}))});return Hc(d).next(function(){return b})})};
g.removeMutationBatches=function(a,b){var c=M(a,"mutations");a=M(a,"documentMutations");var d=[],e={};b=m(b);for(var f=b.next();!f.done;e={numDeleted:e.numDeleted,batch:e.batch},f=b.next()){e.batch=f.value;f=IDBKeyRange.only([this.userId,e.batch.batchId]);e.numDeleted=0;f=pf(c,{range:f},function(a){return function(b,c,d){a.numDeleted++;return d.delete()}}(e));d.push(f.next(function(a){return function(){z(1===a.numDeleted,"Dangling document-mutation reference found: Missing batch "+a.batch.batchId)}}(e)));
f=m(e.batch.mutations);for(var h=f.next();!h.done;h=f.next()){h=h.value;var l=Ve(this.userId,h.key.path,e.batch.batchId);d.push(a.delete(l));null!==this.garbageCollector&&this.garbageCollector.addPotentialGarbageKey(h.key)}}return Hc(d)};
g.performConsistencyCheck=function(a){var b=this;return this.checkEmpty(a).next(function(c){if(!c)return I();c=IDBKeyRange.lowerBound([b.userId]);var d=[];return pf(M(a,"documentMutations"),{range:c},function(a,c,h){a[0]!==b.userId?h.done():(a=Pe(a[1]),d.push(a))}).next(function(){z(0===d.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+d.map(function(a){return a.canonicalString()}))})})};g.setGarbageCollector=function(a){this.garbageCollector=a};
g.containsKey=function(a,b){var c=this;b=[this.userId,Oe(b.path)];var d=b[1];b=IDBKeyRange.lowerBound(b);var e=!1;return pf(M(a,"documentMutations"),{range:b,keysOnly:!0},function(a,b,l){a=m(a);var f=a.next().value,h=a.next().value;a.next();f===c.userId&&h===d&&(e=!0);l.done()}).next(function(){return e})};function sf(a){z("string"===typeof a,"Persisting non-string stream token not supported.");return a}function M(a,b){return a instanceof jf?a.store(b):y("Invalid transaction object provided!")};var vf=function(a){this.serializer=a;this.lastRemoteSnapshotVersion=J;this.metadata=new df;this.garbageCollector=null};g=vf.prototype;g.start=function(a){var b=this;return wf(a,"targetGlobal").get("targetGlobalKey").next(function(a){null!==a&&(b.metadata=a,a=a.lastRemoteSnapshotVersion,b.lastRemoteSnapshotVersion=new Pc(new Mc(a.seconds,a.nanos)));return I()})};g.getHighestTargetId=function(){return this.metadata.highestTargetId};g.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion};
g.setLastRemoteSnapshotVersion=function(a,b){this.lastRemoteSnapshotVersion=b;this.metadata.lastRemoteSnapshotVersion=b.toTimestamp();return wf(a,"targetGlobal").put("targetGlobalKey",this.metadata)};g.addQueryData=function(a,b){var c=this,d=b.targetId;b=wf(a,"targets").put(xf(this.serializer,b));return d>this.metadata.highestTargetId?(this.metadata.highestTargetId=d,b.next(function(){return wf(a,"targetGlobal").put("targetGlobalKey",c.metadata)})):b};
g.removeQueryData=function(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(function(){wf(a,"targets").delete(b.targetId)})};
g.getQueryData=function(a,b){var c=this,d=b.canonicalId();d=IDBKeyRange.bound([d,Number.NEGATIVE_INFINITY],[d,Number.POSITIVE_INFINITY]);var e=null;return pf(wf(a,"targets"),{range:d,index:"queryTargetsIndex"},function(a,d,l){var f=c.serializer;a=new Mc(d.readTime.seconds,d.readTime.nanos);a=new Pc(a);if(void 0!==d.query.documents){f=d.query;var h=f.documents.length;z(1===h,"DocumentsTarget contained other than 1 document: "+h);f=new Jd(yf(f.documents[0]))}else{f=f.remoteSerializer;var B=d.query;
h=yf(B.parent);B=B.structuredQuery;var qb=B.from?B.from.length:0;0<qb&&(z(1===qb,"StructuredQuery.from with more than one collection is not supported."),h=h.child(B.from[0].collectionId));qb=[];B.where&&(qb=zf(f,B.where));var Sd=[];B.orderBy&&(Sd=Af(B.orderBy));var rh=null;B.limit&&(rh=B.limit);var sh=null;B.startAt&&(sh=Bf(f,B.startAt));var Qc=null;B.endAt&&(Qc=Bf(f,B.endAt));f=new Jd(h,Sd,qb,rh,sh,Qc)}d=new Rc(f,d.targetId,a,d.resumeToken);b.equals(d.query)&&(e=d,l.done())}).next(function(){return e})};
g.addMatchingKeys=function(a,b,c){var d=[],e=wf(a,"targetDocuments");b.forEach(function(a){a=Oe(a.path);d.push(e.put(new af(c,a)))});return Hc(d)};g.removeMatchingKeys=function(a,b,c){var d=this,e=[],f=wf(a,"targetDocuments");b.forEach(function(a){var b=Oe(a.path);e.push(f.delete([c,b]));null!==d.garbageCollector&&d.garbageCollector.addPotentialGarbageKey(a)});return Hc(e)};
g.removeMatchingKeysForTargetId=function(a,b){var c=wf(a,"targetDocuments"),d=IDBKeyRange.bound([b],[b+1],!1,!0);return Cf(this,a,d).next(function(){return c.delete(d)})};var Cf=function(a,b,c){b=wf(b,"targetDocuments");return null!==a.garbageCollector&&a.garbageCollector.isEager?pf(b,{range:c,keysOnly:!0},function(b){b=Pe(b[1]);b=new F(b);z(null!==a.garbageCollector,"GarbageCollector for query cache set to null during key removal.");a.garbageCollector.addPotentialGarbageKey(b)}):I()};
vf.prototype.getMatchingKeysForTargetId=function(a,b){b=IDBKeyRange.bound([b],[b+1],!1,!0);a=wf(a,"targetDocuments");var c=H;return pf(a,{range:b,keysOnly:!0},function(a){a=Pe(a[1]);a=new F(a);c=c.add(a)}).next(function(){return c})};vf.prototype.setGarbageCollector=function(a){this.garbageCollector=a};
vf.prototype.containsKey=function(a,b){z(null!==a,"Persistence Transaction cannot be null for query cache containsKey");b=Oe(b.path);b=IDBKeyRange.bound([b],[b+"\x00"],!1,!0);var c=0;return pf(wf(a,"targetDocuments"),{index:"documentTargetsIndex",keysOnly:!0,range:b},function(a,b,f){c++;f.done()}).next(function(){return 0<c})};function wf(a,b){return a instanceof jf?a.store(b):y("Invalid transaction object provided!")};var Df=function(a){this.serializer=a};Df.prototype.addEntry=function(a,b){return Ef(a).put(Eb(b.key.path),Ff(this.serializer,b))};Df.prototype.removeEntry=function(a,b){return Ef(a).delete(Eb(b.path))};Df.prototype.getEntry=function(a,b){var c=this;return Ef(a).get(Eb(b.path)).next(function(a){return a?Gf(c.serializer,a):null})};
Df.prototype.getDocumentsMatchingQuery=function(a,b){var c=this,d=qc,e=Eb(b.path);e=IDBKeyRange.lowerBound(e);return pf(Ef(a),{range:e},function(a,e,l){a=Gf(c.serializer,e);Db(b.path,a.key.path)?a instanceof K&&b.matches(a)&&(d=d.insert(a.key,a)):l.done()}).next(function(){return d})};function Ef(a){return a instanceof jf?a.store("remoteDocuments"):y("Invalid transaction object provided!")};var Hf=function(a){this.remoteSerializer=a},Gf=function(a,b){return b.document?(a=a.remoteSerializer,b=b.document,new K(If(a,b.name),Jf(b.updateTime),Kf(a,b.fields||{}),{hasLocalMutations:!1})):b.noDocument?(a=new F(new Fb(b.noDocument.path.slice())),b=b.noDocument.readTime,b=new Mc(b.seconds,b.nanos),new bd(a,new Pc(b))):y("Unexpected DbRemoteDocument")},Ff=function(a,b){if(b instanceof K)return a=a.remoteSerializer,z(!b.hasLocalMutations,"Can't serialize documents with mutations."),b={name:Lf(a.databaseId,
b.key.path),fields:Mf(a,b.data),updateTime:a.toTimestamp(b.version.toTimestamp())},new Ye(null,b);a=Eb(b.key.path);b=b.version.toTimestamp();return new Ye(new Xe(a,new Qe(b.seconds,b.nanos)),null)},tf=function(a,b,c){var d=c.mutations.map(function(b){return Nf(a.remoteSerializer,b)});return new Te(b,c.batchId,Oc(c.localWriteTime),d)},uf=function(a,b){var c=b.mutations.map(function(b){return Of(a.remoteSerializer,b)}),d=Nc(b.localWriteTimeMs);return new Le(b.batchId,d,c)},xf=function(a,b){var c=b.snapshotVersion.toTimestamp();
c=new Qe(c.seconds,c.nanos);a=Rd(b.query)?{documents:[Pf(a.remoteSerializer,b.query.path)]}:Qf(a.remoteSerializer,b.query);z("string"===typeof b.resumeToken,"Persisting non-string resume token not supported.");var d=b.resumeToken;return new Ze(b.targetId,b.query.canonicalId(),c,d,a)};var Rf=function(a,b){this.ownerId=cb();this.dbName=a+"main";this.serializer=new Hf(b);this.localStoragePrefix=a};g=Rf.prototype;
g.start=function(){var a=this;if(!gf())return this.persistenceError=new A("unimplemented","This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled."),Promise.reject(this.persistenceError);z(!this.started,"IndexedDbPersistence double-started!");this.started=!0;return hf(this.dbName).then(function(b){a.simpleDb=b}).then(function(){return Sf(a)}).then(function(){Tf(a);Uf(a)})};
g.shutdown=function(){var a=this;z(this.started,"IndexedDbPersistence shutdown without start!");this.started=!1;this.windowUnloadHandler&&(window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null);this.ownerLeaseRefreshHandle&&(clearInterval(this.ownerLeaseRefreshHandle),this.ownerLeaseRefreshHandle=null);return Vf(this).then(function(){a.simpleDb.close()})};
g.getMutationQueue=function(a){var b=this.serializer;z(""!==a.uid,"UserID must not be an empty string.");return new qf(null==a.uid?"":a.uid,b)};g.getQueryCache=function(){return new vf(this.serializer)};g.getRemoteDocumentCache=function(){return new Df(this.serializer)};
g.runTransaction=function(a,b){var c=this;if(this.persistenceError)return Promise.reject(this.persistenceError);x("IndexedDbPersistence","Starting transaction:",a);return this.simpleDb.runTransaction("readwrite",ef,function(a){return Wf(c,a).next(function(){return b(a)})})};
var Sf=function(a){return a.simpleDb.runTransaction("readwrite",["owner"],function(b){var c=b.store("owner");return c.get("owner").next(function(b){var d=Date.now();if(null===b||b.leaseTimestampMs<d-5E3)var f=!1;else if(b.leaseTimestampMs>d)Ia("Persistence owner-lease is in the future. Discarding.",b),f=!1;else{d=b.ownerId;try{var h=window.localStorage.getItem(Xf(a));x("IndexedDbPersistence","Zombied ownerID from LocalStorage:",h);f=h}catch(l){Ia("IndexedDbPersistence","Failed to get zombie owner id.",
l),f=null}f=d===f?!1:!0}if(f)return x("IndexedDbPersistence","Valid owner already. Failing. Current owner:",b),a.persistenceError=new A("failed-precondition","There is another tab open with offline persistence enabled. Only one such tab is allowed at a time. The other tab must be closed or persistence must be disabled."),Fc(a.persistenceError);f=new Re(a.ownerId);x("IndexedDbPersistence","No valid owner. Acquiring owner lease. Current owner:",b,"New owner:",f);return c.put("owner",f)})})},Vf=function(a){return a.simpleDb.runTransaction("readwrite",
["owner"],function(b){var c=b.store("owner");return c.get("owner").next(function(b){return null!==b&&b.ownerId===a.ownerId?(x("IndexedDbPersistence","Releasing owner lease."),c.delete("owner")):I()})})},Wf=function(a,b){return b.store("owner").get("owner").next(function(b){return null===b||b.ownerId!==a.ownerId?(a.persistenceError=new A("failed-precondition","There is another tab open with offline persistence enabled. Only one such tab is allowed at a time. The other tab must be closed or persistence must be disabled."),
Fc(a.persistenceError)):I()})},Tf=function(a){a.ownerLeaseRefreshHandle=setInterval(function(){a.runTransaction("Refresh owner timestamp",function(b){return b.store("owner").put("owner",new Re(a.ownerId))}).catch(function(b){Ia(b);a.ownerLeaseRefreshHandle&&(clearInterval(a.ownerLeaseRefreshHandle),a.ownerLeaseRefreshHandle=null)})},4E3)},Uf=function(a){a.windowUnloadHandler=function(){var b=a.ownerId;try{null===b?window.localStorage.removeItem(Xf(a)):window.localStorage.setItem(Xf(a),b)}catch(c){Ia("IndexedDbPersistence",
"Failed to set zombie owner id.",c)}a.shutdown()};window.addEventListener("unload",a.windowUnloadHandler)},Xf=function(a){return a.localStoragePrefix+"zombiedOwnerId"};var Yf=function(a,b){this.remoteDocumentCache=a;this.mutationQueue=b},$f=function(a,b,c){return a.remoteDocumentCache.getEntry(b,c).next(function(d){return Zf(a,b,c,d)})},ag=function(a,b,c){var d=[],e=pc;c.forEach(function(c){d.push($f(a,b,c).next(function(a){a||(a=new bd(c,J));e=e.insert(c,a)}))});return Hc(d).next(function(){return e})};Yf.prototype.getDocumentsMatchingQuery=function(a,b){return 0===b.path.length%2?bg(this,a,b.path):cg(this,a,b)};
var bg=function(a,b,c){return $f(a,b,new F(c)).next(function(a){var b=qc;a instanceof K&&(b=b.insert(a.key,a));return b})},cg=function(a,b,c){var d;return a.remoteDocumentCache.getDocumentsMatchingQuery(b,c).next(function(c){return dg(a,b,c)}).next(function(e){d=e;return a.mutationQueue.getAllMutationBatchesAffectingQuery(b,c)}).next(function(c){var e=H;c=m(c);for(var h=c.next();!h.done;h=c.next()){h=m(h.value.mutations);for(var l=h.next();!l.done;l=h.next())l=l.value,d.get(l.key)||(e=e.add(l.key))}var p=
[];e.forEach(function(c){p.push($f(a,b,c).next(function(a){a instanceof K&&(d=d.insert(a.key,a))}))});return Hc(p)}).next(function(){d.forEach(function(a,b){c.matches(b)||(d=d.remove(a))});return d})},Zf=function(a,b,c,d){return a.mutationQueue.getAllMutationBatchesAffectingDocumentKey(b,c).next(function(a){a=m(a);for(var b=a.next();!b.done;b=a.next())d=b.value.applyToLocalView(c,d);return d})},dg=function(a,b,c){var d=[];c.forEach(function(e,f){d.push(Zf(a,b,e,f).next(function(a){a instanceof bd?
c=c.remove(a.key):a instanceof K?c=c.insert(a.key,a):y("Unknown MaybeDocument: "+a)}))});return Hc(d).next(function(){return c})};var eg=function(a){this.remoteDocumentCache=a;this.changes=pc};eg.prototype.addEntry=function(a){this.changes=fg(this).insert(a.key,a)};eg.prototype.getEntry=function(a,b){var c=fg(this).get(b);return c?I(c):this.remoteDocumentCache.getEntry(a,b)};eg.prototype.apply=function(a){var b=this,c=[];fg(this).forEach(function(d,e){c.push(b.remoteDocumentCache.addEntry(a,e))});this.changes=null;return Hc(c)};var fg=function(a){z(null!==a.changes,"Changes have already been applied.");return a.changes};var gg=function(a,b,c){this.persistence=a;this.garbageCollector=c;this.localViewReferences=new Uc;this.targetIds={};this.targetIdGenerator=je();this.heldBatchResults=[];this.mutationQueue=a.getMutationQueue(b);this.remoteDocuments=a.getRemoteDocumentCache();this.queryCache=a.getQueryCache();this.localDocuments=new Yf(this.remoteDocuments,this.mutationQueue);this.garbageCollector.addGarbageSource(this.localViewReferences);this.garbageCollector.addGarbageSource(this.queryCache);this.garbageCollector.addGarbageSource(this.mutationQueue)};
gg.prototype.start=function(){var a=this;return this.persistence.runTransaction("Start LocalStore",function(b){return hg(a,b).next(function(){return ig(a,b)})})};
gg.prototype.handleUserChange=function(a){var b=this;return this.persistence.runTransaction("Handle user change",function(c){var d;return b.mutationQueue.getAllMutationBatches(c).next(function(e){d=e;b.garbageCollector.removeGarbageSource(b.mutationQueue);b.mutationQueue=b.persistence.getMutationQueue(a);b.garbageCollector.addGarbageSource(b.mutationQueue);return hg(b,c)}).next(function(){b.localDocuments=new Yf(b.remoteDocuments,b.mutationQueue);return b.mutationQueue.getAllMutationBatches(c)}).next(function(a){var e=
H;a=m([d,a]);for(var h=a.next();!h.done;h=a.next()){h=m(h.value);for(var l=h.next();!l.done;l=h.next()){l=m(l.value.mutations);for(var p=l.next();!p.done;p=l.next())e=e.add(p.value.key)}}return ag(b.localDocuments,c,e)})})};
var ig=function(a,b){return a.queryCache.start(b).next(function(){a.targetIdGenerator=je(a.queryCache.getHighestTargetId())})},hg=function(a,b){return a.mutationQueue.start(b).next(function(){a.heldBatchResults=[];return a.mutationQueue.getHighestAcknowledgedBatchId(b)}).next(function(c){return-1!==c?a.mutationQueue.getAllMutationBatchesThroughBatchId(b,c):I([])}).next(function(c){return 0<c.length?a.mutationQueue.removeMutationBatches(b,c):I()})},ze=function(a,b){return a.persistence.runTransaction("Locally write mutations",
function(c){var d,e=Nc(Date.now());return a.mutationQueue.addMutationBatch(c,e,b).next(function(b){d=b;b=d.keys();return ag(a.localDocuments,c,b)}).next(function(a){return{batchId:d.batchId,changes:a}})})};
gg.prototype.acknowledgeBatch=function(a){var b=this;return this.persistence.runTransaction("Acknowledge batch",function(c){var d;return b.mutationQueue.acknowledgeBatch(c,a.batch,a.streamToken).next(function(){if(!(0>=a.commitVersion.compareTo(b.queryCache.getLastRemoteSnapshotVersion())||Pa(b.targetIds))||0<b.heldBatchResults.length)return b.heldBatchResults.push(a),d=H,I();var e=new eg(b.remoteDocuments);return jg(b,c,[a],e).next(function(a){d=a;return e.apply(c)})}).next(function(){return b.mutationQueue.performConsistencyCheck(c)}).next(function(){return ag(b.localDocuments,
c,d)})})};
var Ge=function(a,b){return a.persistence.runTransaction("Reject batch",function(c){var d,e;return a.mutationQueue.lookupMutationBatch(c,b).next(function(e){z(null!=e,"Attempt to reject nonexistent batch!");d=e;return a.mutationQueue.getHighestAcknowledgedBatchId(c).next(function(a){z(b>a,"Acknowledged batches can't be rejected.");return d})}).next(function(){return a.removeMutationBatches(c,[d])}).next(function(b){e=b;return a.mutationQueue.performConsistencyCheck(c)}).next(function(){return ag(a.localDocuments,c,
e)})})};gg.prototype.getLastStreamToken=function(){var a=this;return this.persistence.runTransaction("Get last stream token",function(b){return a.mutationQueue.getLastStreamToken(b)})};gg.prototype.setLastStreamToken=function(a){var b=this;return this.persistence.runTransaction("Set last stream token",function(c){return b.mutationQueue.setLastStreamToken(c,a)})};gg.prototype.getLastRemoteSnapshotVersion=function(){return this.queryCache.getLastRemoteSnapshotVersion()};
gg.prototype.applyRemoteEvent=function(a){var b=this,c=new eg(this.remoteDocuments);return this.persistence.runTransaction("Apply remote event",function(d){var e=[];Na(a.targetChanges,function(a,c){var f=b.targetIds[a];if(f){var h=c.mapping;if(h)if(h instanceof ed)e.push(b.queryCache.removeMatchingKeysForTargetId(d,a).next(function(){return b.queryCache.addMatchingKeys(d,h.documents,a)}));else if(h instanceof fd)e.push(b.queryCache.removeMatchingKeys(d,h.removedDocuments,a).next(function(){return b.queryCache.addMatchingKeys(d,
h.addedDocuments,a)}));else return y("Unknown mapping type: "+JSON.stringify(h));var l=c.resumeToken;0<l.length&&(f=f.update({resumeToken:l,snapshotVersion:c.snapshotVersion}),b.targetIds[a]=f,e.push(b.queryCache.addQueryData(d,f)))}});var f=H;a.documentUpdates.forEach(function(a,h){f=f.add(a);e.push(c.getEntry(d,a).next(function(d){null==d||h.version.equals(J)||0<=h.version.compareTo(d.version)?c.addEntry(h):x("LocalStore","Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",
h.version);b.garbageCollector.addPotentialGarbageKey(a)}))});var h=b.queryCache.getLastRemoteSnapshotVersion(),l=a.snapshotVersion;l.equals(J)||(z(0<=l.compareTo(h),"Watch stream reverted to previous snapshot?? "+l+" < "+h),e.push(b.queryCache.setLastRemoteSnapshotVersion(d,l)));var p;return Hc(e).next(function(){return kg(b,d,c)}).next(function(a){p=a;return c.apply(d)}).next(function(){return ag(b.localDocuments,d,oc(f,p))})})};
var Ke=function(a,b){return a.persistence.runTransaction("Notify local view changes",function(c){for(var d=[],e={},f=m(b),h=f.next();!h.done;e={view:e.view},h=f.next())e.view=h.value,d.push(a.queryCache.getQueryData(c,e.view.query).next(function(b){return function(c){z(null!==c,"Local view changes contain unallocated query.");c=c.targetId;Xc(a.localViewReferences,b.view.addedKeys,c);Zc(a.localViewReferences,b.view.removedKeys,c)}}(e)));return Hc(d)})},lg=function(a,b){return a.persistence.runTransaction("Get next mutation batch",
function(c){void 0===b&&(b=-1);return a.mutationQueue.getNextMutationBatchAfterBatchId(c,b)})},ue=function(a,b){return a.persistence.runTransaction("Allocate query",function(c){var d;return a.queryCache.getQueryData(c,b).next(function(e){if(e)return d=e,I();e=a.targetIdGenerator.next();d=new Rc(b,e);return a.queryCache.addQueryData(c,d)}).next(function(){z(!a.targetIds[d.targetId],"Tried to allocate an already allocated query: "+b);return a.targetIds[d.targetId]=d})})},xe=function(a,b){return a.persistence.runTransaction("Release query",
function(c){return a.queryCache.getQueryData(c,b).next(function(d){z(null!=d,"Tried to release nonexistent query: "+b);$c(a.localViewReferences,d.targetId);delete a.targetIds[d.targetId];return a.garbageCollector.isEager?a.queryCache.removeQueryData(c,d):I()}).next(function(){if(Pa(a.targetIds)){var b=new eg(a.remoteDocuments);return kg(a,c,b).next(function(){b.apply(c)})}return I()})})},ve=function(a,b){return a.persistence.runTransaction("Execute query",function(c){return a.localDocuments.getDocumentsMatchingQuery(c,
b)})},we=function(a,b){return a.persistence.runTransaction("Remote document keys",function(c){return a.queryCache.getMatchingKeysForTargetId(c,b)})};gg.prototype.collectGarbage=function(){var a=this;return this.persistence.runTransaction("Garbage collection",function(b){return a.garbageCollector.collectGarbage(b).next(function(c){var d=[];c.forEach(function(c){d.push(a.remoteDocuments.removeEntry(b,c))});return Hc(d)})})};
var kg=function(a,b,c){for(var d=[],e=m(a.heldBatchResults),f=e.next();!f.done;f=e.next()){f=f.value;var h=a;if(!(0>=f.commitVersion.compareTo(h.queryCache.getLastRemoteSnapshotVersion())||Pa(h.targetIds)))break;d.push(f)}if(0===d.length)return I(H);a.heldBatchResults.splice(0,d.length);return jg(a,b,d,c)},jg=function(a,b,c,d){for(var e=I(),f={},h=m(c),l=h.next();!l.done;f={batchResult:f.batchResult},l=h.next())f.batchResult=l.value,e=e.next(function(a){return function(){return mg(b,a.batchResult,
d)}}(f));return e.next(function(){return a.removeMutationBatches(b,c.map(function(a){return a.batch}))})};gg.prototype.removeMutationBatches=function(a,b){for(var c=H,d=m(b),e=d.next();!e.done;e=d.next()){e=m(e.value.mutations);for(var f=e.next();!f.done;f=e.next())c=c.add(f.value.key)}return this.mutationQueue.removeMutationBatches(a,b).next(function(){return c})};
var mg=function(a,b,c){var d=b.batch,e=d.keys(),f=I();e.forEach(function(e){f=f.next(function(){return c.getEntry(a,e)}).next(function(a){var f=a,h=b.docVersions.get(e);z(null!==h,"ackVersions should contain every doc in the write.");if(!f||0>f.version.compareTo(h))(f=d.applyToRemoteDocument(e,f,b))?c.addEntry(f):z(!a,"Mutation batch "+d+" applied to document "+a+" resulted in null")})});return f};var ng=function(){this.mutationQueue=[];this.nextBatchId=1;this.highestAcknowledgedBatchId=-1;this.lastStreamToken=Ka().emptyByteString;this.garbageCollector=null;this.batchesByDocumentKey=new G(Sc)};g=ng.prototype;g.start=function(){0===this.mutationQueue.length&&(this.nextBatchId=1,this.highestAcknowledgedBatchId=-1);z(this.highestAcknowledgedBatchId<this.nextBatchId,"highestAcknowledgedBatchId must be less than the nextBatchId");return I()};g.checkEmpty=function(){return I(0===this.mutationQueue.length)};
g.getHighestAcknowledgedBatchId=function(){return I(this.highestAcknowledgedBatchId)};g.acknowledgeBatch=function(a,b,c){a=b.batchId;z(a>this.highestAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");b=og(this,a,"acknowledged");b=this.mutationQueue[b];z(a===b.batchId,"Queue ordering failure: expected batch "+a+", got batch "+b.batchId);z(0!==b.mutations.length,"Can't acknowledge a previously removed batch");this.highestAcknowledgedBatchId=a;this.lastStreamToken=c;return I()};
g.getLastStreamToken=function(){return I(this.lastStreamToken)};g.setLastStreamToken=function(a,b){this.lastStreamToken=b;return I()};
g.addMutationBatch=function(a,b,c){z(0!==c.length,"Mutation batches should not be empty");a=this.nextBatchId;this.nextBatchId++;0<this.mutationQueue.length&&z(this.mutationQueue[this.mutationQueue.length-1].batchId<a,"Mutation batchIDs must be monotonically increasing order");b=new Le(a,b,c);this.mutationQueue.push(b);c=m(c);for(var d=c.next();!d.done;d=c.next())this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Vc(d.value.key,a));return I(b)};
g.lookupMutationBatch=function(a,b){return I(pg(this,b))};g.getNextMutationBatchAfterBatchId=function(a,b){a=this.mutationQueue.length;b=Math.max(b+1,this.highestAcknowledgedBatchId);b=qg(this,b);for(b=0>b?0:b;b<a;b++){var c=this.mutationQueue[b];if(0!==c.mutations.length)return I(c)}return I(null)};g.getAllMutationBatches=function(){return I(rg(this,this.mutationQueue.length))};
g.getAllMutationBatchesThroughBatchId=function(a,b){a=this.mutationQueue.length;b=qg(this,b);0>b?b=0:b>=a?b=a:b++;return I(rg(this,b))};g.getAllMutationBatchesAffectingDocumentKey=function(a,b){var c=this,d=[];lc(this.batchesByDocumentKey,[new Vc(b,0),new Vc(b,Number.POSITIVE_INFINITY)],function(a){z(b.equals(a.key),"Should only iterate over a single key's batches");a=pg(c,a.targetOrBatchId);z(null!==a,"Batches in the index must exist in the main table");d.push(a)});return I(d)};
g.getAllMutationBatchesAffectingQuery=function(a,b){var c=this,d=b.path,e=d.length+1;a=d;0===a.length%2||(a=a.child(""));a=new Vc(new F(a),0);var f=new G(E);mc(this.batchesByDocumentKey,function(a){var b=a.key.path;return Db(d,b)?(b.length===e&&(f=f.add(a.targetOrBatchId)),!0):!1},a);var h=[];f.forEach(function(a){a=pg(c,a);null!==a&&h.push(a)});return I(h)};
g.removeMutationBatches=function(a,b){var c=b.length;z(0<c,"Should not remove mutations when none exist.");a=b[0].batchId;var d=this.mutationQueue.length,e=og(this,a,"removed");z(this.mutationQueue[e].batchId===a,"Removed batches must exist in the queue");var f=1;for(a=e+1;f<c&&a<d;){var h=this.mutationQueue[a];0!==h.mutations.length&&(z(h.batchId===b[f].batchId,"Removed batches must be contiguous in the queue"),f++);a++}if(0===e){for(;a<d&&0===this.mutationQueue[a].mutations.length;a++);this.mutationQueue.splice(e,
a-e)}else for(c=e;c<a;c++)d=this.mutationQueue[c],this.mutationQueue[c]=new Le(d.batchId,d.localWriteTime,[]);a=this.batchesByDocumentKey;b=m(b);for(c=b.next();!c.done;c=b.next())for(d=c.value,c=d.batchId,d=m(d.mutations),e=d.next();!e.done;e=d.next())e=e.value.key,null!==this.garbageCollector&&this.garbageCollector.addPotentialGarbageKey(e),a=a.delete(new Vc(e,c));this.batchesByDocumentKey=a;return I()};g.setGarbageCollector=function(a){this.garbageCollector=a};
g.containsKey=function(a,b){a=nc(this.batchesByDocumentKey,new Vc(b,0));return I(b.equals(a&&a.key))};g.performConsistencyCheck=function(){0===this.mutationQueue.length&&z(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty.");return I()};
var rg=function(a,b){for(var c=[],d=0;d<b;d++){var e=a.mutationQueue[d];0===e.mutations.length||c.push(e)}return c},og=function(a,b,c){b=qg(a,b);z(0<=b&&b<a.mutationQueue.length,"Batches must exist to be "+c);return b},qg=function(a,b){return 0===a.mutationQueue.length?0:b-a.mutationQueue[0].batchId},pg=function(a,b){var c=qg(a,b);if(0>c||c>=a.mutationQueue.length)return null;a=a.mutationQueue[c];z(a.batchId===b,"If found batch must match");return 0===a.mutations.length?null:a};var sg=function(){this.queries=new tc(function(a){return a.canonicalId()});this.lastRemoteSnapshotVersion=J;this.highestTargetId=0;this.references=new Uc};g=sg.prototype;g.start=function(){return I()};g.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion};g.getHighestTargetId=function(){return this.highestTargetId};g.setLastRemoteSnapshotVersion=function(a,b){this.lastRemoteSnapshotVersion=b;return I()};
g.addQueryData=function(a,b){this.queries.set(b.query,b);a=b.targetId;a>this.highestTargetId&&(this.highestTargetId=a);return I()};g.removeQueryData=function(a,b){this.queries.delete(b.query);$c(this.references,b.targetId);return I()};g.getQueryData=function(a,b){a=this.queries.get(b)||null;return I(a)};g.addMatchingKeys=function(a,b,c){Xc(this.references,b,c);return I()};g.removeMatchingKeys=function(a,b,c){Zc(this.references,b,c);return I()};
g.removeMatchingKeysForTargetId=function(a,b){$c(this.references,b);return I()};g.getMatchingKeysForTargetId=function(a,b){a=ad(this.references,b);return I(a)};g.setGarbageCollector=function(a){this.references.setGarbageCollector(a)};g.containsKey=function(a,b){return this.references.containsKey(a,b)};var tg=function(){this.docs=pc};tg.prototype.addEntry=function(a,b){this.docs=this.docs.insert(b.key,b);return I()};tg.prototype.removeEntry=function(a,b){this.docs=this.docs.remove(b);return I()};tg.prototype.getEntry=function(a,b){return I(this.docs.get(b))};tg.prototype.getDocumentsMatchingQuery=function(a,b){a=qc;var c=new F(b.path.child(""));for(c=Zb(this.docs,c);ac(c);){var d=$b(c),e=d.value;if(!Db(b.path,d.key.path))break;e instanceof K&&b.matches(e)&&(a=a.insert(e.key,e))}return I(a)};var ug=function(){this.mutationQueues={};this.remoteDocumentCache=new tg;this.queryCache=new sg;this.started=!1};g=ug.prototype;g.start=function(){z(!this.started,"MemoryPersistence double-started!");this.started=!0;return Promise.resolve()};g.shutdown=function(){z(this.started,"MemoryPersistence shutdown without start!");this.started=!1;return Promise.resolve()};g.getMutationQueue=function(a){var b=this.mutationQueues[lb(a)];b||(b=new ng,this.mutationQueues[lb(a)]=b);return b};g.getQueryCache=function(){return this.queryCache};
g.getRemoteDocumentCache=function(){return this.remoteDocumentCache};g.runTransaction=function(a,b){x("MemoryPersistence","Starting transaction:",a);return Ec(b(new vg))};var vg=function(){};var wg=function(){this.isEager=!1};wg.prototype.addGarbageSource=function(){};wg.prototype.removeGarbageSource=function(){};wg.prototype.addPotentialGarbageKey=function(){};wg.prototype.collectGarbage=function(){return I(H)};var xg=function(a,b,c){this.initialDelayMs=a;this.backoffFactor=b;this.maxDelayMs=c;this.reset()};xg.prototype.reset=function(){this.currentBaseMs=0};
var yg=function(a){var b=new Fa,c=a.currentBaseMs+(Math.random()-.5)*a.currentBaseMs;0<a.currentBaseMs&&x("ExponentialBackoff","Backing off for "+c+" ms "+("(base delay: "+a.currentBaseMs+" ms)"));setTimeout(function(){b.resolve()},c);a.currentBaseMs*=a.backoffFactor;a.currentBaseMs<a.initialDelayMs&&(a.currentBaseMs=a.initialDelayMs);a.currentBaseMs>a.maxDelayMs&&(a.currentBaseMs=a.maxDelayMs);return b.promise};var zg=function(a,b,c,d,e){this.queue=a;this.connection=b;this.credentialsProvider=c;this.listener=this.stream=null;this.backoff=new xg(e?e:1E3,1.5,6E4);this.state=0;this.listener=d},Ag=function(a){return 4===a.state||1===a.state||2===a.state};zg.prototype.start=function(){3===this.state?Bg(this):(z(0===this.state,"Already started"),this.auth())};zg.prototype.stop=function(){this.state=5;this.listener=null;null!==this.stream&&(this.stream.close(),this.stream=null)};
var Cg=function(a){z(!Ag(a),"Can only inhibit backoff in a stopped state");a.state=0;a.backoff.reset()};zg.prototype.auth=function(){var a=this;z(0===this.state,"Must be in initial state to auth");this.state=1;this.credentialsProvider.getToken(!1).then(function(b){Dg(a,b)},function(b){Eg(a.queue,function(){return 5!==a.state?Fg(a,new A("unknown","Fetching auth token failed: "+b.message)):Promise.resolve()})})};
var Dg=function(a,b){if(5!==a.state){z(1===a.state,"Trying to start stream in a non-auth state");var c=function(b){Eg(a.queue,function(){return 5!==a.state?b():Promise.resolve()})};null!==a.listener&&(a.stream=a.startRpc(b),a.stream.onOpen(function(){c(function(){z(1===a.state,"Expected stream to be in state auth, but was "+a.state);a.state=2;return a.listener.onOpen()})}),a.stream.onClose(function(b){c(function(){return Fg(a,b)})}),a.stream.onMessage(function(b){c(function(){return a.onMessage(b)})}))}},
Bg=function(a){z(3===a.state,"Should only perform backoff in an error case");a.state=4;yg(a.backoff).then(function(){Eg(a.queue,function(){if(5===a.state)return Promise.resolve();a.state=0;a.start();z(Ag(a),"PersistentStream should have started");return Promise.resolve()})})},Fg=function(a,b){z(Ag(a),"Can't handle server close on non-started stream");x("PersistentStream","close with error: "+b);a.stream=null;a.state=3;if(b&&"resource-exhausted"===b.code){x("PersistentStream","Using maximum backoff delay to prevent overloading the backend.");
var c=a.backoff;c.currentBaseMs=c.maxDelayMs}return a.listener.onClose(b)},Gg=function(a,b,c,d,e,f,h){zg.call(this,b,c,d,f,h);this.databaseInfo=a;this.serializer=e};n(Gg,zg);Gg.prototype.startRpc=function(a){return Hg(this.connection,"Listen",a)};
Gg.prototype.onMessage=function(a){this.backoff.reset();var b=this.serializer;var c=a.change_type;if(N(a,c,"targetChange")){O(a.targetChange,"targetChange");c=a.targetChange.targetChangeType||"NO_CHANGE";c="NO_CHANGE"===c?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:y("Got unexpected TargetChange.state: "+c);var d=a.targetChange.targetIds||[];b=a.targetChange.resumeToken||b.emptyByteString();var e=a.targetChange.cause,f;if(f=e)f=void 0===e.code?"unknown":Ig(e.code),f=new A(f,e.message||
"");b=new Jg(c,d,b,f||null)}else N(a,c,"documentChange")?(O(a.documentChange,"documentChange"),O(a.documentChange.document,"documentChange.name"),O(a.documentChange.document.name,"documentChange.document.name"),O(a.documentChange.document.updateTime,"documentChange.document.updateTime"),c=a.documentChange,d=If(b,c.document.name),e=Jf(c.document.updateTime),b=Kf(b,c.document.fields||{}),b=new K(d,e,b,{hasLocalMutations:!1}),b=new Kg(c.targetIds||[],c.removedTargetIds||[],b.key,b)):N(a,c,"documentDelete")?
(O(a.documentDelete,"documentDelete"),O(a.documentDelete.document,"documentDelete.document"),c=a.documentDelete,b=If(b,c.document),d=c.readTime?Jf(c.readTime):J,b=new bd(b,d),b=new Kg([],c.removedTargetIds||[],b.key,b)):N(a,c,"documentRemove")?(O(a.documentRemove,"documentRemove"),O(a.documentRemove.document,"documentRemove"),c=a.documentRemove,b=If(b,c.document),b=new Kg([],c.removedTargetIds||[],b,null)):N(a,c,"filter")?(O(a.filter,"filter"),O(a.filter.targetId,"filter.targetId"),b=a.filter,b=new Lg(b.targetId,
new Mg(b.count||0))):b=y("Unknown change type "+JSON.stringify(a));N(a,a.response_type,"targetChange")?(a=a.targetChange,a=a.targetIds&&a.targetIds.length||!a.readTime?J:Jf(a.readTime)):a=J;return this.listener.onWatchChange(b,a)};
Gg.prototype.watch=function(a){var b={};b.database=this.serializer.encodedDatabaseId;var c=this.serializer,d=a.query;c=Rd(d)?{documents:{documents:[Pf(c,d.path)]}}:{query:Qf(c,d)};c.targetId=a.targetId;0<a.resumeToken.length&&(c.resumeToken=a.resumeToken);b.addTarget=c;this.stream.send(b)};Gg.prototype.unwatch=function(a){var b={};b.database=this.serializer.encodedDatabaseId;b.removeTarget=a;this.stream.send(b)};
var Ng=function(a,b,c,d,e,f,h){zg.call(this,b,c,d,f,h);this.databaseInfo=a;this.serializer=e;this.handshakeComplete_=!1};n(Ng,zg);Ng.prototype.start=function(){this.handshakeComplete_=!1;zg.prototype.start.call(this)};Ng.prototype.startRpc=function(a){return Hg(this.connection,"Write",a)};
Ng.prototype.onMessage=function(a){z(!!a.streamToken,"Got a write response without a stream token");this.lastStreamToken=a.streamToken;if(this.handshakeComplete_){this.backoff.reset();var b=Og(this.serializer,a.writeResults);a=Jf(a.commitTime);return this.listener.onMutationResult(a,b)}z(!a.writeResults||0===a.writeResults.length,"Got mutation results for handshake");this.handshakeComplete_=!0;return this.listener.onHandshakeComplete()};
var Pg=function(a,b){z(2===a.state,"Writing mutations requires an opened stream");z(a.handshakeComplete_,"Handshake must be complete before writing mutations");z(0<a.lastStreamToken.length,"Trying to write mutation without a token");b={streamToken:a.lastStreamToken,writes:b.map(function(b){return Nf(a.serializer,b)})};a.stream.send(b)};k.Object.defineProperties(Ng.prototype,{handshakeComplete:{configurable:!0,enumerable:!0,get:function(){return this.handshakeComplete_}}});var Qg=function(a,b,c,d,e,f){this.databaseInfo=a;this.queue=b;this.connection=c;this.credentials=d;this.serializer=e;this.initialBackoffDelay=f},Rg=function(a,b){return new Ng(a.databaseInfo,a.queue,a.connection,a.credentials,a.serializer,b,a.initialBackoffDelay)},Sg=function(a,b){return new Gg(a.databaseInfo,a.queue,a.connection,a.credentials,a.serializer,b,a.initialBackoffDelay)};
Qg.prototype.commit=function(a){var b=this;a={writes:a.map(function(a){return Nf(b.serializer,a)})};return Tg(this,"commit",a).then(function(a){return Og(b.serializer,a.writeResults)})};
Qg.prototype.lookup=function(a){var b=this,c={documents:a.map(function(a){return Lf(b.serializer.databaseId,a.path)})};return Tg(this,"batchGet",c).then(function(c){var d=pc;c.forEach(function(a){var c=b.serializer,e=a.result_type;if(N(a,e,"found")){z(!!a.found,"Tried to deserialize a found document from a missing document.");O(a.found.name,"doc.found.name");O(a.found.updateTime,"doc.found.updateTime");e=If(c,a.found.name);var f=Jf(a.found.updateTime);a=Kf(c,a.found.fields||{});a=new K(e,f,a,{hasLocalMutations:!1})}else N(a,
e,"missing")?(z(!!a.missing,"Tried to deserialize a missing document from a found document."),z(!!a.readTime,"Tried to deserialize a missing document without a read time."),c=If(c,a.missing),a=Jf(a.readTime),a=new bd(c,a)):a=y("invalid batch get response: "+JSON.stringify(a));d=d.insert(a.key,a)});var f=[];a.forEach(function(a){var b=d.get(a);z(!!b,"Missing entity in write response for "+a);f.push(b)});return f})};
var Tg=function(a,b,c){return a.credentials.getToken(!1).then(function(d){return Ug(a.connection,b,c,d)})};var Vg=function(a){this.fields=a};Vg.prototype.equals=function(a){return db(this.fields,a.fields)};var Wg=function(){};Wg.prototype.equals=function(a){return a instanceof Wg};var Xg=new Wg,Yg=function(a,b){this.field=a;this.transform=b};Yg.prototype.equals=function(a){return this.field.equals(a.field)&&this.transform.equals(a.transform)};
var Zg=function(a,b){this.version=a;this.transformResults=b},$g=function(a,b){this.updateTime=a;this.exists=b;z(void 0===a||void 0===b,'Precondition can specify "exists" or "updateTime" but not both')},ah=function(a){return new $g(void 0,a)},bh=function(a,b){if(void 0!==a.updateTime)return b instanceof K&&b.version.equals(a.updateTime);if(void 0!==a.exists)return a.exists?b instanceof K:null===b||b instanceof bd;z(a.isNone,"Precondition should be empty");return!0};
$g.prototype.equals=function(a){var b=this.updateTime,c=a.updateTime;return(b?!(!c||!b.equals(c)):b===c)&&this.exists===a.exists};k.Object.defineProperties($g.prototype,{isNone:{configurable:!0,enumerable:!0,get:function(){return void 0===this.updateTime&&void 0===this.exists}}});
var ch=new $g,dh=function(){},eh=function(a,b){null!=b&&z(b.key.equals(a.key),"Can only apply a mutation to a document with the same key")},fh=function(a){return a instanceof K?a.version:J},gh=function(a,b,c){this.key=a;this.value=b;this.precondition=c;this.type=0};n(gh,dh);gh.prototype.applyToRemoteDocument=function(a,b){eh(this,a);z(null==b.transformResults,"Transform results received by SetMutation.");return new K(this.key,fh(a),this.value,{hasLocalMutations:!1})};
gh.prototype.applyToLocalView=function(a){eh(this,a);return bh(this.precondition,a)?new K(this.key,fh(a),this.value,{hasLocalMutations:!0}):a};gh.prototype.equals=function(a){return a instanceof gh&&this.key.equals(a.key)&&this.value.equals(a.value)&&this.precondition.equals(a.precondition)};var hh=function(a,b,c,d){this.key=a;this.data=b;this.fieldMask=c;this.precondition=d;this.type=1};n(hh,dh);
hh.prototype.applyToRemoteDocument=function(a,b){eh(this,a);z(null==b.transformResults,"Transform results received by PatchMutation.");if(!bh(this.precondition,a))return a;b=fh(a);a=ih(this,a instanceof K?a.data:Gd);return new K(this.key,b,a,{hasLocalMutations:!1})};hh.prototype.applyToLocalView=function(a){eh(this,a);if(!bh(this.precondition,a))return a;var b=fh(a);a=ih(this,a instanceof K?a.data:Gd);return new K(this.key,b,a,{hasLocalMutations:!0})};
hh.prototype.equals=function(a){return a instanceof hh&&this.key.equals(a.key)&&this.fieldMask.equals(a.fieldMask)&&this.precondition.equals(a.precondition)};var ih=function(a,b){for(var c=m(a.fieldMask.fields),d=c.next();!d.done;d=c.next()){d=d.value;var e=a.data.field(d);b=void 0!==e?b.set(d,e):b.delete(d)}return b},jh=function(a,b){this.key=a;this.fieldTransforms=b;this.type=2;this.precondition=ah(!0)};n(jh,dh);
jh.prototype.applyToRemoteDocument=function(a,b){eh(this,a);z(null!=b.transformResults,"Transform results missing for TransformMutation.");b=b.transformResults;if(!bh(this.precondition,a))return a;a=kh(this,a);b=lh(this,a.data,b);return new K(this.key,a.version,b,{hasLocalMutations:!1})};
jh.prototype.applyToLocalView=function(a,b){eh(this,a);if(!bh(this.precondition,a))return a;a=kh(this,a);a:{for(var c=[],d=m(this.fieldTransforms),e=d.next();!e.done;e=d.next())if(e=e.value.transform,e instanceof Wg)c.push(new Cd(b));else{b=y("Encountered unknown transform: "+e);break a}b=c}b=lh(this,a.data,b);return new K(this.key,a.version,b,{hasLocalMutations:!0})};jh.prototype.equals=function(a){return a instanceof jh&&this.key.equals(a.key)&&db(this.fieldTransforms,a.fieldTransforms)&&this.precondition.equals(a.precondition)};
var kh=function(a,b){z(b instanceof K,"Unknown MaybeDocument type "+b);z(b.key.equals(a.key),"Can only transform a document with the same key");return b},lh=function(a,b,c){z(c.length===a.fieldTransforms.length,"TransformResults length mismatch.");for(var d=0;d<a.fieldTransforms.length;d++){var e=a.fieldTransforms[d],f=e.transform;e=e.field;if(f instanceof Wg)b=b.set(e,c[d]);else return y("Encountered unknown transform: "+f)}return b},mh=function(a,b){this.key=a;this.precondition=b;this.type=3};
n(mh,dh);mh.prototype.applyToRemoteDocument=function(a,b){eh(this,a);z(null==b.transformResults,"Transform results received by DeleteMutation.");return new bd(this.key,J)};mh.prototype.applyToLocalView=function(a){eh(this,a);if(!bh(this.precondition,a))return a;a&&z(a.key.equals(this.key),"Can only apply mutation to document with same key");return new bd(this.key,J)};mh.prototype.equals=function(a){return a instanceof mh&&this.key.equals(a.key)&&this.precondition.equals(a.precondition)};var Ce=function(a){this.datastore=a;this.readVersions=rc;this.mutations=[];this.committed=!1};
Ce.prototype.lookup=function(a){var b=this;return this.committed?Promise.reject("Transaction has already completed."):0<this.mutations.length?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(a).then(function(a){a.forEach(function(a){var c=a.version;a instanceof bd&&(c=J);var d=b.readVersions.get(a.key);if(null!==d){if(!c.equals(d))throw new A("aborted","Document version changed between two reads.");}else b.readVersions=b.readVersions.insert(a.key,c)});return a})};
Ce.prototype.write=function(a){if(this.committed)throw new A("failed-precondition","Transaction has already completed.");this.mutations=this.mutations.concat(a)};Ce.prototype.precondition=function(a){return(a=this.readVersions.get(a))?new $g(a):ch};var nh=function(a,b){if((a=a.readVersions.get(b))&&a.equals(J))throw new A("failed-precondition","Can't update a document that doesn't exist.");return a?new $g(a):ah(!0)};Ce.prototype.set=function(a,b){this.write(b.toMutations(a,this.precondition(a)))};
Ce.prototype.update=function(a,b){this.write(b.toMutations(a,nh(this,a)))};Ce.prototype.delete=function(a){this.write([new mh(a,this.precondition(a))]);this.readVersions=this.readVersions.insert(a,J)};Ce.prototype.commit=function(){var a=this,b=this.readVersions;this.mutations.forEach(function(a){b=b.remove(a.key)});return b.isEmpty()?this.datastore.commit(this.mutations).then(function(){a.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))};var oh={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,UNAUTHENTICATED:16,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,0:"OK",1:"CANCELLED",2:"UNKNOWN",3:"INVALID_ARGUMENT",4:"DEADLINE_EXCEEDED",5:"NOT_FOUND",6:"ALREADY_EXISTS",7:"PERMISSION_DENIED",16:"UNAUTHENTICATED",8:"RESOURCE_EXHAUSTED",9:"FAILED_PRECONDITION",10:"ABORTED",11:"OUT_OF_RANGE",12:"UNIMPLEMENTED",
13:"INTERNAL",14:"UNAVAILABLE",15:"DATA_LOSS"};
function ph(a){switch(a){case "ok":return y("Treated status OK as error");case "cancelled":case "unknown":case "deadline-exceeded":case "resource-exhausted":case "internal":case "unavailable":case "unauthenticated":return!1;case "invalid-argument":case "not-found":case "already-exists":case "permission-denied":case "failed-precondition":case "aborted":case "out-of-range":case "unimplemented":case "data-loss":return!0;default:return y("Unknown status code: "+a)}}
function Ig(a){switch(a){case 0:return"ok";case 1:return"cancelled";case 2:return"unknown";case 4:return"deadline-exceeded";case 8:return"resource-exhausted";case 13:return"internal";case 14:return"unavailable";case 16:return"unauthenticated";case 3:return"invalid-argument";case 5:return"not-found";case 6:return"already-exists";case 7:return"permission-denied";case 9:return"failed-precondition";case 10:return"aborted";case 11:return"out-of-range";case 12:return"unimplemented";case 15:return"data-loss";
default:return y("Unknown status code: "+a)}}
function qh(a){switch(a){case 200:return"ok";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 416:return"out-of-range";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"unknown";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded";default:return 200<=a&&300>a?"ok":400<=a&&500>a?"failed-precondition":500<=a&&600>a?"internal":
"unknown"}};var Kg=function(a,b,c,d){this.updatedTargetIds=a;this.removedTargetIds=b;this.key=c;this.newDoc=d},Lg=function(a,b){this.targetId=a;this.existenceFilter=b},Jg=function(a,b,c,d){c=void 0===c?Ka().emptyByteString:c;this.state=a;this.targetIds=b;this.resumeToken=c;this.cause=void 0===d?null:d},th=function(a,b,c){this.snapshotVersion=a;this.listenTargets=b;this.existenceFilters={};this.targetChanges={};this.documentUpdates=pc;this.frozen=!1;this.pendingTargetResponses=Qa(c)};
th.prototype.add=function(a){z(!this.frozen,"Trying to modify frozen WatchChangeAggregator.");if(a instanceof Kg){for(var b=!1,c=m(a.updatedTargetIds),d=c.next();!d.done;d=c.next())d=d.value,uh(this,d)&&(vh(this,d).mapping.add(a.key),b=!0);c=m(a.removedTargetIds);for(d=c.next();!d.done;d=c.next())d=d.value,uh(this,d)&&(vh(this,d).mapping.delete(a.key),b=!0);a.newDoc&&b&&(this.documentUpdates=this.documentUpdates.insert(a.key,a.newDoc))}else a instanceof Jg?wh(this,a):a instanceof Lg?uh(this,a.targetId)&&
(this.existenceFilters[a.targetId]=a.existenceFilter):y("Unknown watch change: "+a)};
var xh=function(a,b){z(!a.frozen,"Trying to modify frozen WatchChangeAggregator.");b.forEach(function(b){return a.add(b)})},yh=function(a){var b=a.targetChanges;Na(a.targetChanges,function(c){uh(a,c)||delete b[c]});a.frozen=!0;return new cd(a.snapshotVersion,b,a.documentUpdates)},vh=function(a,b){var c=a.targetChanges[b];c||(c={currentStatusUpdate:0,snapshotVersion:a.snapshotVersion,mapping:new fd,resumeToken:Ka().emptyByteString},a.targetChanges[b]=c);return c},uh=function(a,b){return!Ma(a.pendingTargetResponses,
b)&&Ma(a.listenTargets,b)},wh=function(a,b){b.targetIds.forEach(function(c){var d=vh(a,c);switch(b.state){case 0:uh(a,c)&&zh(d,b.resumeToken);break;case 1:Ah(a,c);Ma(a.pendingTargetResponses,c)||(d.mapping=new fd,d.currentStatusUpdate=0,delete a.existenceFilters[c]);zh(d,b.resumeToken);break;case 2:Ah(a,c);z(!b.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:uh(a,c)&&(d.currentStatusUpdate=2,zh(d,b.resumeToken));break;case 4:uh(a,c)&&(d.mapping=new ed,zh(d,b.resumeToken));
break;default:y("Unknown target watch change state: "+b.state)}})},Ah=function(a,b){var c=(a.pendingTargetResponses[b]||0)-1;0===c?delete a.pendingTargetResponses[b]:a.pendingTargetResponses[b]=c};function zh(a,b){0<b.length&&(a.resumeToken=b)};var Bh=function(a,b,c,d,e){this.databaseInfo=a;this.asyncQueue=b;this.localStore=c;this.datastore=d;this.onlineStateHandler=e;this.pendingWrites=[];this.lastBatchSeen=-1;this.listenTargets={};this.pendingTargetResponses={};this.accumulatedWatchChanges=[];this.watchStreamOnlineState=0};Bh.prototype.start=function(){var a=this;return Ch(this).then(function(){return Be(a)})};
var Dh=function(a,b){var c=a.watchStreamOnlineState!==b;a.watchStreamOnlineState=b;if(c)a.onlineStateHandler(b)},Ch=function(a){a.watchStream=Sg(a.datastore,{onOpen:a.onWatchStreamOpen.bind(a),onClose:a.onWatchStreamClose.bind(a),onWatchChange:a.onWatchStreamChange.bind(a)});a.writeStream=Rg(a.datastore,{onOpen:a.onWriteStreamOpen.bind(a),onClose:a.onWriteStreamClose.bind(a),onHandshakeComplete:a.onWriteHandshakeComplete.bind(a),onMutationResult:a.onMutationResult.bind(a)});return a.localStore.getLastStreamToken().then(function(b){a.writeStream.lastStreamToken=
b})};Bh.prototype.shutdown=function(){x("RemoteStore","RemoteStore shutting down.");this.accumulatedWatchChanges=[];this.pendingTargetResponses={};this.writeStream.stop();this.watchStream.stop();return Promise.resolve(void 0)};Bh.prototype.listen=function(a){z(!Ma(this.listenTargets,a.targetId),"listen called with duplicate targetId!");this.listenTargets[a.targetId]=a;2===this.watchStream.state?Eh(this,a):Ag(this.watchStream)||Fh(this)};
Bh.prototype.unlisten=function(a){z(Ma(this.listenTargets,a),"unlisten called without assigned target ID!");delete this.listenTargets[a];2===this.watchStream.state&&(Gh(this,a),this.watchStream.unwatch(a))};
var Eh=function(a,b){Gh(a,b.targetId);a.watchStream.watch(b)},Gh=function(a,b){a.pendingTargetResponses[b]=(a.pendingTargetResponses[b]||0)+1},Fh=function(a){z(!Ag(a.watchStream),"Can't restart started watch stream");z(!Pa(a.listenTargets),"Tried to start watch stream even though it should not be started");a.watchStream.start()};Bh.prototype.onWatchStreamOpen=function(){var a=this;Na(this.listenTargets,function(b,c){Eh(a,c)});return Promise.resolve()};
Bh.prototype.onWatchStreamClose=function(){this.accumulatedWatchChanges=[];this.pendingTargetResponses={};Pa(this.listenTargets)?Dh(this,0):(1===this.watchStreamOnlineState?Dh(this,0):Dh(this,2),Fh(this));return Promise.resolve()};
Bh.prototype.onWatchStreamChange=function(a,b){Dh(this,1);if(a instanceof Jg&&2===a.state&&a.cause)return Hh(this,a);this.accumulatedWatchChanges.push(a);return!b.equals(J)&&0<=b.compareTo(this.localStore.getLastRemoteSnapshotVersion())?(a=this.accumulatedWatchChanges,this.accumulatedWatchChanges=[],Ih(this,b,a)):Promise.resolve()};
var Ih=function(a,b,c){var d=new th(b,a.listenTargets,a.pendingTargetResponses);xh(d,c);var e=yh(d);a.pendingTargetResponses=d.pendingTargetResponses;var f=[];Na(d.existenceFilters,function(c,d){var h=a.listenTargets[c];if(h){var l=h.query;Rd(l)?0===d.count?(h=new F(l.path),dd(e,new bd(h,b))):z(1===d.count,"Single document existence filter with count: "+d.count):(h=we(a.localStore,c).then(function(b){if(e.targetChanges[c]){var f=e.targetChanges[c].mapping;null!==f&&(f instanceof fd?b=gd(f,b):(z(f instanceof
ed,"Expected either reset or update mapping but got something else: "+f),b=f.documents))}b.size!==d.count&&(e.targetChanges[c]={mapping:new ed,snapshotVersion:J,currentStatusUpdate:1,resumeToken:Ka().emptyByteString},b=new Rc(l,c),a.listenTargets[c]=b,Gh(a,c),a.watchStream.unwatch(c),Eh(a,b))}),f.push(h))}});return Promise.all(f).then(function(){Na(e.targetChanges,function(b,c){if(0<c.resumeToken.length){var d=a.listenTargets[b];d&&(a.listenTargets[b]=d.update({resumeToken:c.resumeToken,snapshotVersion:c.snapshotVersion}))}});
return a.syncEngine.applyRemoteEvent(e)})},Hh=function(a,b){z(!!b.cause,"Handling target error without a cause");var c=b.cause,d=Promise.resolve();b.targetIds.forEach(function(b){d=d.then(function(){return Ma(a.listenTargets,b)?(delete a.listenTargets[b],De(a.syncEngine,b,c)):Promise.resolve()})});return d},Be=function(a){return 10>a.pendingWrites.length?lg(a.localStore,a.lastBatchSeen).then(function(b){if(null===b)return Promise.resolve();a.commit(b);return Be(a)}):Promise.resolve()};
Bh.prototype.commit=function(a){z(10>this.pendingWrites.length,"commit called when batches can't be written");this.lastBatchSeen=a.batchId;this.pendingWrites.push(a);Ag(this.writeStream)?this.writeStream.handshakeComplete&&Pg(this.writeStream,a.mutations):Jh(this)};var Jh=function(a){z(!Ag(a.writeStream),"Can't restart started write stream");a.writeStream.start()};
Bh.prototype.onWriteStreamOpen=function(){var a=this.writeStream;z(2===a.state,"Writing handshake requires an opened stream");z(!a.handshakeComplete_,"Handshake already completed");var b={};b.database=a.serializer.encodedDatabaseId;a.stream.send(b);return Promise.resolve()};
Bh.prototype.onWriteHandshakeComplete=function(){var a=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var b=m(a.pendingWrites),c=b.next();!c.done;c=b.next())Pg(a.writeStream,c.value.mutations)})};Bh.prototype.onMutationResult=function(a,b){var c=this;z(0<this.pendingWrites.length,"Got result for empty pending writes");var d=this.pendingWrites.shift();a=Ne(d,a,b,this.writeStream.lastStreamToken);return Fe(this.syncEngine,a).then(function(){return Be(c)})};
Bh.prototype.onWriteStreamClose=function(a){var b=this;return 0<this.pendingWrites.length?(z(!!a,"We have pending writes, but the write stream closed without an error"),(this.writeStream.handshakeComplete?Kh(this,a):Lh(this,a)).then(function(){0<b.pendingWrites.length&&!Ag(b.writeStream)&&Jh(b)})):Promise.resolve()};
var Lh=function(a,b){return ph(b.code)||"aborted"===b.code?(x("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",a.writeStream.lastStreamToken),a.writeStream.lastStreamToken=Ka().emptyByteString,a.localStore.setLastStreamToken(Ka().emptyByteString)):Promise.resolve()},Kh=function(a,b){if(ph(b.code)){var c=a.pendingWrites.shift();Cg(a.writeStream);return He(a.syncEngine,c.batchId,b).then(function(){return Be(a)})}return Promise.resolve()};
Bh.prototype.handleUserChange=function(a){var b=this;x("RemoteStore","RemoteStore changing users: uid=",a.uid);this.lastBatchSeen=-1;this.pendingWrites=[];this.watchStream.stop();this.writeStream.stop();this.accumulatedWatchChanges=[];this.pendingTargetResponses={};return Ch(this).then(function(){!Pa(b.listenTargets)&&Fh(b);return Be(b)}).then(function(){Dh(b,0)})};var Mh=function(a,b){C("GeoPoint",arguments,2);D("GeoPoint","number",1,a);D("GeoPoint","number",2,b);if(!isFinite(a)||-90>a||90<a)throw new A("invalid-argument","Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||-180>b||180<b)throw new A("invalid-argument","Longitude must be a number between -180 and 180, but was: "+b);this._lat=a;this._long=b};Mh.prototype._equals=function(a){return this._lat===a._lat&&this._long===a._long};
Mh.prototype._compareTo=function(a){return E(this._lat,a._lat)||E(this._long,a._long)};k.Object.defineProperties(Mh.prototype,{latitude:{configurable:!0,enumerable:!0,get:function(){return this._lat}},longitude:{configurable:!0,enumerable:!0,get:function(){return this._long}}});var Mg=function(a){this.count=a};Mg.prototype.equals=function(a){return a&&a.count===this.count};var Nh={};Nh[Vd.name]="ASCENDING";Nh[ge.name]="DESCENDING";var Oh={};Oh[Yd.name]="LESS_THAN";Oh[Zd.name]="LESS_THAN_OR_EQUAL";Oh[ae.name]="GREATER_THAN";Oh[$d.name]="GREATER_THAN_OR_EQUAL";Oh[Pd.name]="EQUAL";function O(a,b){z(!ld(a),b+" is missing")}function Ph(a){return"number"===typeof a?a:"string"===typeof a?parseInt(a,10):y("can't parse "+a)}var Qh=function(a,b){this.databaseId=a;this.options=b};Qh.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)};
Qh.prototype.toTimestamp=function(a){return{seconds:a.seconds,nanos:a.nanos}};
var Rh=function(a){if("string"===typeof a){var b=0,c=Lc.exec(a);z(!!c,"invalid timestamp: "+a);c[1]&&(b=c[1],b=(b+"000000000").substr(0,9),b=parseInt(b,10));return new Mc(Math.floor((new Date(a)).getTime()/1E3),b)}z(!!a,"Cannot deserialize null or undefined timestamp.");b=Ph(a.seconds||"0");return new Mc(b,a.nanos||0)},Sh=function(a,b){if("string"===typeof b)return z(a.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),hb(b);z(!a.options.useProto3Json,
"Expected bytes to be passed in as string, but got something else instead.");return ib(b)},Jf=function(a){z(!!a,"Trying to deserialize version that isn't set");return new Pc(Rh(a))},Lf=function(a,b){return(new Fb(["projects",a.projectId,"databases",a.database])).child("documents").child(b).canonicalString()},Th=function(a){a=Gb(a);z(4<=a.length&&"projects"===a.get(0)&&"databases"===a.get(2),"Tried to deserialize invalid key "+a.toString());return a},If=function(a,b){b=Th(b);z(b.get(1)===a.databaseId.projectId,
"Tried to deserialize key from different project: "+b.get(1)+" vs "+a.databaseId.projectId);z(!b.get(3)&&!a.databaseId.database||b.get(3)===a.databaseId.database,"Tried to deserialize key from different database: "+b.get(3)+" vs "+a.databaseId.database);return new F(Uh(b))},Pf=function(a,b){return 0===b.length?a.encodedDatabaseId:Lf(a.databaseId,b)},yf=function(a){a=Th(a);return 4===a.length?Hb:Uh(a)},Uh=function(a){z(4<a.length&&"documents"===a.get(4),"tried to deserialize invalid key "+a.toString());
return zb(a,5)},Wh=function(a,b){if(b instanceof od)return{nullValue:"NULL_VALUE"};if(b instanceof qd)return{booleanValue:b.value()};if(b instanceof vd)return{integerValue:""+b.value()};if(b instanceof wd){var c=b.value();if(a.options.useProto3Json){if(isNaN(c))return{doubleValue:"NaN"};if(Infinity===c)return{doubleValue:"Infinity"};if(-Infinity===c)return{doubleValue:"-Infinity"}}return{doubleValue:b.value()}}b instanceof Ad?a={stringValue:b.value()}:b instanceof Fd?a={mapValue:{fields:Mf(a,b)}}:
b instanceof Hd?a={arrayValue:Vh(a,b)}:b instanceof Bd?a={timestampValue:a.toTimestamp(b.internalValue)}:b instanceof Ed?a={geoPointValue:{latitude:b.value().latitude,longitude:b.value().longitude}}:b instanceof Dd?(b=b.value(),a={bytesValue:a.options.useProto3Json?b.toBase64():b.toUint8Array()}):a=b instanceof L?{referenceValue:Lf(b.databaseId,b.key.path)}:y("Unknown FieldValue "+JSON.stringify(b));return a},Xh=function(a,b){var c=b.value_type;if(N(b,c,"nullValue"))return pd;if(N(b,c,"booleanValue"))return b.booleanValue?
rd:sd;if(N(b,c,"integerValue"))return new vd(Ph(b.integerValue));if(N(b,c,"doubleValue")){if(a.options.useProto3Json){if("NaN"===b.doubleValue)return xd;if("Infinity"===b.doubleValue)return yd;if("-Infinity"===b.doubleValue)return zd}return new wd(b.doubleValue)}return N(b,c,"stringValue")?new Ad(b.stringValue):N(b,c,"mapValue")?Kf(a,b.mapValue.fields||{}):N(b,c,"arrayValue")?(O(b.arrayValue,"arrayValue"),new Hd((b.arrayValue.values||[]).map(function(b){return Xh(a,b)}))):N(b,c,"timestampValue")?
(O(b.timestampValue,"timestampValue"),new Bd(Rh(b.timestampValue))):N(b,c,"geoPointValue")?(O(b.geoPointValue,"geoPointValue"),new Ed(new Mh(b.geoPointValue.latitude||0,b.geoPointValue.longitude||0))):N(b,c,"bytesValue")?(O(b.bytesValue,"bytesValue"),b=Sh(a,b.bytesValue),new Dd(b)):N(b,c,"referenceValue")?(O(b.referenceValue,"referenceValue"),c=Th(b.referenceValue),b=new Sb(c.get(1),c.get(3)),c=new F(Uh(c)),new L(b,c)):y("Unknown Value proto "+JSON.stringify(b))},Yh=function(a,b,c){return{name:Lf(a.databaseId,
b.path),fields:Mf(a,c)}},Mf=function(a,b){var c={};b.forEach(function(b,e){c[b]=Wh(a,e)});return c},Kf=function(a,b){var c=Gd;Oa(b,function(b,e){c=c.set(new Jb([b]),Xh(a,e))});return c},Vh=function(a,b){var c=[];b.forEach(function(b){c.push(Wh(a,b))});return{values:c}},Nf=function(a,b){if(b instanceof gh)var c={update:Yh(a,b.key,b.value)};else if(b instanceof mh)c={delete:Lf(a.databaseId,b.key.path)};else if(b instanceof hh)c={update:Yh(a,b.key,b.data),updateMask:Zh(b.fieldMask)};else if(b instanceof
jh)c={transform:{document:Lf(a.databaseId,b.key.path),fieldTransforms:b.fieldTransforms.map(function(a){z(a.transform instanceof Wg,"Unknown transform: "+a.transform);return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"}})}};else return y("Unknown mutation type "+b.type);b.precondition.isNone||(c.currentDocument=$h(a,b.precondition));return c},Of=function(a,b){var c=b.currentDocument?ai(b.currentDocument):ch;if(b.update){O(b.update.name,"name");var d=If(a,b.update.name);a=Kf(a,
b.update.fields||{});return b.updateMask?(b=bi(b.updateMask),new hh(d,a,b,c)):new gh(d,a,c)}return b.delete?(b=If(a,b.delete),new mh(b,c)):b.transform?(d=If(a,b.transform.document),b=b.transform.fieldTransforms.map(function(a){z("REQUEST_TIME"===a.setToServerValue,"Unknown transform proto: "+JSON.stringify(a));a=Mb(a.fieldPath);return new Yg(a,Xg)}),z(!0===c.exists,'Transforms only support precondition "exists == true"'),new jh(d,b)):y("unknown mutation proto: "+JSON.stringify(b))},$h=function(a,
b){z(!b.isNone,"Can't serialize an empty precondition");return void 0!==b.updateTime?{updateTime:a.toTimestamp(b.updateTime.toTimestamp())}:void 0!==b.exists?{exists:b.exists}:y("Unknown precondition")},ai=function(a){return void 0!==a.updateTime?new $g(Jf(a.updateTime)):void 0!==a.exists?ah(a.exists):ch},ci=function(a,b){var c=b.updateTime?Jf(b.updateTime):null,d=null;b.transformResults&&(d=b.transformResults.map(function(b){return Xh(a,b)}));return new Zg(c,d)},Og=function(a,b){return(b||[]).map(function(b){return ci(a,
b)})},Qf=function(a,b){var c={structuredQuery:{}};if(b.path.isEmpty())c.parent=Pf(a,Hb);else{var d=b.path;z(0!==d.length%2,"Document queries with filters are not supported.");c.parent=Pf(a,Ab(d));c.structuredQuery.from=[{collectionId:Cb(d)}]}if(d=di(a,b.filters))c.structuredQuery.where=d;if(d=ei(b.orderBy))c.structuredQuery.orderBy=d;d=b.limit;d=ld(d)?void 0:d;void 0!==d&&(c.structuredQuery.limit=d);b.startAt&&(c.structuredQuery.startAt=fi(a,b.startAt));b.endAt&&(c.structuredQuery.endAt=fi(a,b.endAt));
return c},di=function(a,b){if(0!==b.length)return b=b.map(function(b){return b instanceof Od?b instanceof Od?{fieldFilter:{field:gi(b.field),op:Oh[b.op.name],value:Wh(a,b.value)}}:y("Unrecognized filter: "+JSON.stringify(b)):b instanceof ee?{unaryFilter:{field:gi(b.field),op:"IS_NAN"}}:b instanceof de?{unaryFilter:{field:gi(b.field),op:"IS_NULL"}}:y("Unrecognized filter: "+JSON.stringify(b))}),1===b.length?b[0]:{compositeFilter:{op:"AND",filters:b}}},zf=function(a,b){return b?void 0!==b.unaryFilter?
[hi(b)]:void 0!==b.fieldFilter?[ii(a,b)]:void 0!==b.compositeFilter?b.compositeFilter.filters.map(function(b){return zf(a,b)}).reduce(function(a,b){return a.concat(b)}):y("Unknown filter: "+JSON.stringify(b)):[]},ei=function(a){if(0!==a.length)return a.map(function(a){return{field:gi(a.field),direction:Nh[a.dir.name]}})},Af=function(a){return a.map(function(a){var b=Mb(a.field.fieldPath);a:{switch(a.direction){case "ASCENDING":a=Vd;break a;case "DESCENDING":a=ge;break a}a=void 0}return new Ud(b,a)})},
fi=function(a,b){return{before:b.before,values:b.position.map(function(b){return Wh(a,b)})}},Bf=function(a,b){var c=!!b.before;b=b.values.map(function(b){return Xh(a,b)});return new he(b,c)},ji=function(a){switch(a){case "EQUAL":return Pd;case "GREATER_THAN":return ae;case "GREATER_THAN_OR_EQUAL":return $d;case "LESS_THAN":return Yd;case "LESS_THAN_OR_EQUAL":return Zd;case "OPERATOR_UNSPECIFIED":return y("Unspecified relation");default:return y("Unknown relation")}},gi=function(a){return{fieldPath:a.canonicalString()}},
ii=function(a,b){return new Od(Mb(b.fieldFilter.field.fieldPath),ji(b.fieldFilter.op),Xh(a,b.fieldFilter.value))},hi=function(a){switch(a.unaryFilter.op){case "IS_NAN":return a=Mb(a.unaryFilter.field.fieldPath),new ee(a);case "IS_NULL":return a=Mb(a.unaryFilter.field.fieldPath),new de(a);case "OPERATOR_UNSPECIFIED":return y("Unspecified filter");default:return y("Unknown filter")}},Zh=function(a){return{fieldPaths:a.fields.map(function(a){return a.canonicalString()})}},bi=function(a){a=(a.fieldPaths||
[]).map(function(a){return Mb(a)});return new Vg(a)};k.Object.defineProperties(Qh.prototype,{encodedDatabaseId:{configurable:!0,enumerable:!0,get:function(){return(new Fb(["projects",this.databaseId.projectId,"databases",this.databaseId.database])).canonicalString()}}});function N(a,b,c){return b===c||!b&&c in a};var ki=function(a,b,c,d){this.platform=a;this.databaseInfo=b;this.credentials=c;this.asyncQueue=d};ki.prototype.start=function(a){var b=this,c=new Fa,d=new Fa,e=!1;this.credentials.setUserChangeListener(function(f){e?Eg(b.asyncQueue,function(){return b.handleUserChange(f)}):(e=!0,li(b,a,d).then(function(){return mi(b,f)}).then(c.resolve,c.reject))});Eg(this.asyncQueue,function(){return c.promise});return d.promise};
var li=function(a,b,c){if(b)return ni(a).then(c.resolve).catch(function(b){c.reject(b);if("failed-precondition"!==b.code&&"unimplemented"!==b.code)return Promise.reject(b);console.warn("Error enabling offline storage. Falling back to storage disabled: "+b);return oi(a)});c.resolve();return oi(a)},ni=function(a){a.garbageCollector=new wg;var b=a.databaseInfo,c=b.databaseId.projectId;b.databaseId.isDefaultDatabase||(c+="."+b.databaseId.database);a.persistence=new Rf("firestore/"+b.persistenceKey+"/"+
c+"/",new Qh(a.databaseInfo.databaseId,{useProto3Json:!0}));return a.persistence.start()},oi=function(a){a.garbageCollector=new Ic;a.persistence=new ug;return a.persistence.start()},mi=function(a,b){return Promise.resolve(new pi(a.databaseInfo)).then(function(c){a.localStore=new gg(a.persistence,b,a.garbageCollector);a.remoteStore=new Bh(a.databaseInfo,a.asyncQueue,a.localStore,new Qg(a.databaseInfo,a.asyncQueue,c,a.credentials,new Qh(a.databaseInfo.databaseId,{useProto3Json:!0})),function(b){a.eventMgr.onOnlineStateChanged(b)});
a.syncEngine=new se(a.localStore,a.remoteStore,b);a.remoteStore.syncEngine=a.syncEngine;a.eventMgr=new vc(a.syncEngine);return a.localStore.start()}).then(function(){return a.remoteStore.start()})};g=ki.prototype;g.handleUserChange=function(a){z(this.asyncQueue.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.");x("FirestoreClient","User Changed: "+a.uid);return this.syncEngine.handleUserChange(a)};
g.shutdown=function(){var a=this;return Eg(this.asyncQueue,function(){a.credentials.removeUserChangeListener();return a.remoteStore.shutdown()}).then(function(){return a.persistence.shutdown()})};g.listen=function(a,b,c){var d=this,e=new xc(a,b,c);Eg(this.asyncQueue,function(){return d.eventMgr.listen(e)});return e};g.unlisten=function(a){var b=this;Eg(this.asyncQueue,function(){return b.eventMgr.unlisten(a)})};
g.write=function(a){var b=this,c=new Fa;Eg(this.asyncQueue,function(){return b.syncEngine.write(a,c)});return c.promise};g.databaseId=function(){return this.databaseInfo.databaseId};g.transaction=function(a){var b=this;return Eg(this.asyncQueue,function(){return Promise.resolve()}).then(function(){return b.syncEngine.runTransaction(a)})};var qi=function(a){this.observer=a;this.muted=!1};qi.prototype.next=function(a){ri(this,this.observer.next,a)};qi.prototype.error=function(a){ri(this,this.observer.error,a)};var ri=function(a,b,c){a.muted||setTimeout(function(){a.muted||b(c)},0)};var si=function(){this.tail=Promise.resolve();this.delayedOpCount=0;this.operationInProgress=!1},Eg=function(a,b){a.failure&&y("AsyncQueue is already failed: "+a.failure.message);return ti(a,b)},ti=function(a,b){a.tail=a.tail.then(function(){a.operationInProgress=!0;return b().catch(function(b){a.failure=b;a.operationInProgress=!1;Ia("INTERNAL UNHANDLED ERROR: ",b.stack||b.message);throw b;}).then(function(){a.operationInProgress=!1})});return a.tail};
si.prototype.drain=function(){z(0===this.delayedOpCount,"draining doesn't handle delayed ops.");return Eg(this,function(){return Promise.resolve(void 0)})};function ui(a){if("object"!==typeof a||null===a)return!1;for(var b=m(["next","error","complete"]),c=b.next();!c.done;c=b.next())if(c=c.value,c in a&&"function"===typeof a[c])return!0;return!1};var vi=function(){},wi=function(){};n(wi,vi);var xi=new wi,yi=function(){};n(yi,vi);var zi=new yi,Ai=La(vi,"Use FieldValue.<field>() instead.");var Bi=/^__.*__$/,Ci=function(a,b,c){this.data=a;this.fieldMask=b;this.fieldTransforms=c};Ci.prototype.toMutations=function(a,b){var c=[];null!==this.fieldMask?c.push(new hh(a,this.data,this.fieldMask,b)):c.push(new gh(a,this.data,b));0<this.fieldTransforms.length&&c.push(new jh(a,this.fieldTransforms));return c};var Di=function(a,b,c){this.data=a;this.fieldMask=b;this.fieldTransforms=c};
Di.prototype.toMutations=function(a,b){b=[new hh(a,this.data,this.fieldMask,b)];0<this.fieldTransforms.length&&b.push(new jh(a,this.fieldTransforms));return b};
var Fi=function(a,b,c,d){this.dataSource=a;this.methodName=b;this.path=c;void 0===d&&Ei(this);this.fieldTransforms=d||[]},Hi=function(a,b){var c="number"===typeof b?null:null==a.path?null:a.path.child(b);a=new Fi(a.dataSource,a.methodName,c,a.fieldTransforms);"string"===typeof b?Gi(a,b):"object"===typeof b&&b instanceof Jb&&Ei(a);return a},Ii=function(a,b){var c=null===a.path||a.path.isEmpty()?"":" (found in field "+a.path.toString()+")";return new A("invalid-argument","Function "+a.methodName+"() called with invalid data. "+
b+c)},Ei=function(a){if(null!==a.path)for(var b=0;b<a.path.length;b++)Gi(a,a.path.get(b))},Gi=function(a,b){if((0===a.dataSource||1===a.dataSource)&&Bi.test(b))throw Ii(a,"Document fields cannot begin and end with __");},Ji=function(a,b){this.databaseId=a;this.key=b},Ki=function(a){this.preConverter=a},Oi=function(a,b,c,d){var e=new Fi(0,b,Nb);Li("Data must be an object, but it was:",e,c);var f=void 0!==d.merge&&d.merge?[]:null,h=Gd;Oa(c,function(b,c){b=(new Ob(b))._internalPath;var d=Hi(e,b);c=Mi(a,
c,d);if(c=Ni(a,c,d))h=h.set(b,c),null!==f&&f.push(b)});return new Ci(h,null!==f?new Vg(f):null,e.fieldTransforms)},Qi=function(a,b,c){var d=new Fi(1,b,Nb);Li("Data must be an object, but it was:",d,c);var e=[],f=Gd;Oa(c,function(c,l){c=Pi(b,c);var h=Hi(d,c);l=Mi(a,l,h);l instanceof wi?e.push(c):(l=Ni(a,l,h),null!=l&&(e.push(c),f=f.set(c,l)))});return new Di(f,new Vg(e),d.fieldTransforms)},Si=function(a,b,c,d,e){var f=new Fi(1,b,Nb);c=[Ri(b,c)];d=[d];if(0!==e.length%2)throw new A("invalid-argument",
"Function "+b+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<e.length;h+=2)c.push(Ri(b,e[h])),d.push(e[h+1]);b=[];e=Gd;for(h=0;h<c.length;++h){var l=c[h],p=Hi(f,l),w=Mi(a,d[h],p);w instanceof wi?b.push(l):(p=Ni(a,w,p),null!=p&&(b.push(l),e=e.set(l,p)))}return new Di(e,new Vg(b),f.fieldTransforms)},Ti=function(a,b,c){b=new Fi(2,b,Nb);a=Ni(a,c,b);z(null!=a,"Parsed data should not be null.");z(0===b.fieldTransforms.length,"Field transforms should have been disallowed.");
return a},Mi=function(a,b,c){try{return a.preConverter(b)}catch(d){throw Ii(c,d instanceof Error?d.message:d.toString());}},Ni=function(a,b,c){b=Mi(a,b,c);if(b instanceof Array){if(!c.path)throw Ii(c,"Nested arrays are not supported");var d=[],e=0;b=m(b);for(var f=b.next();!f.done;f=b.next())f=Ni(a,f.value,Hi(c,e)),null==f&&(f=pd),d.push(f),e++;return new Hd(d)}return Ui(b)?(Li("Unsupported field value:",c,b),Vi(a,b,c)):Wi(b,c)},Vi=function(a,b,c){var d=new Wb(E);Oa(b,function(b,f){f=Ni(a,f,Hi(c,
b));null!=f&&(d=d.insert(b,f))});return new Fd(d)},Wi=function(a,b){if(null===a)return pd;if("number"===typeof a)return kd(a)&&a<=jd&&a>=id?new vd(a):new wd(a);if("boolean"===typeof a)return a?rd:sd;if("string"===typeof a)return new Ad(a);if(a instanceof Date)return new Bd(Nc(a.getTime()));if(a instanceof Mh)return new Ed(a);if(a instanceof gb)return new Dd(a);if(a instanceof Ji)return new L(a.databaseId,a.key);if(a instanceof vi){if(a instanceof wi){if(1!==b.dataSource)throw Ii(b,"FieldValue.delete() can only be used with update()");
z(null==b.path||0<b.path.length,"FieldValue.delete() at the top level should have already been handled.");throw Ii(b,"FieldValue.delete() can only appear at the top level of your update data");}if(a instanceof yi){if(0!==b.dataSource&&1!==b.dataSource)throw Ii(b,"FieldValue.serverTimestamp() can only be used with set() and update()");if(null===b.path)throw Ii(b,"FieldValue.serverTimestamp() is not currently supported inside arrays");b.fieldTransforms.push(new Yg(b.path,Xg));return null}return y("Unknown FieldValue type: "+
a)}throw Ii(b,"Unsupported field value: "+Za(a));};function Ui(a){return"object"===typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof Mh)&&!(a instanceof gb)&&!(a instanceof Ji)&&!(a instanceof vi)}function Li(a,b,c){if(!Ui(c)||!Ya(c)){c=Za(c);if("an object"===c)throw Ii(b,a+" a custom object");throw Ii(b,a+" "+c);}}
function Ri(a,b){if(b instanceof Ob)return b._internalPath;if("string"===typeof b)return Pi(a,b);throw new A("invalid-argument","Function "+a+"() called with invalid data. Field path arguments must be of type string or FieldPath.");}
function Pi(a,b){try{if(0<=b.search(Qb))throw new A("invalid-argument","Invalid field path ("+b+"). Paths must not contain '~', '*', '/', '[', or ']'");try{var c=new (Function.prototype.bind.apply(Ob,[null].concat(na(b.split(".")))))}catch(d){throw new A("invalid-argument","Invalid field path ("+b+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");}return c._internalPath}catch(d){throw new A("invalid-argument","Function "+a+"() called with invalid data. "+(d instanceof Error?
d.message:d.toString()));}};var Xi=function(a){if(void 0===a.host){if(void 0!==a.ssl)throw new A("invalid-argument","Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com";this.ssl=!0}else{Ua("settings","string","host option",a.host);this.host=a.host;Xa("settings","boolean","ssl",a.ssl);var b=a.ssl;this.ssl=void 0!==b?b:!0}ab("settings",a,["host","ssl","credentials"]);Xa("settings","object","credentials",a.credentials);this.credentials=a.credentials};
Xi.prototype.equals=function(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials};
var Yi=function(){},P=function(a){var b=this;this.INTERNAL={"delete":function(){return b._firestoreClient?b._firestoreClient.shutdown():Promise.resolve()}};if("undefined"===typeof Promise)throw Error("Promises are not available. Firestore will not work.");var c=new Yi;if("object"===typeof a.options)c.firebaseApp=a,c.databaseId=Zi(a),c.persistenceKey=c.firebaseApp.name,c.credentials=new sb(a);else{if(!a.projectId)throw new A("invalid-argument","Must provide projectId");c.databaseId=new Sb(a.projectId,
a.database);c.persistenceKey="[DEFAULT]";c.credentials=new rb}c.settings=new Xi({});this._config=c};
P.prototype.settings=function(a){C("Firestore.settings",arguments,1);D("Firestore.settings","object",1,a);if(Ma(a,"persistence"))throw new A("invalid-argument",'"persistence" is now specified with a separate call to firestore.enablePersistence().');var b=new Xi(a);if(this._firestoreClient&&!this._config.settings.equals(b))throw new A("failed-precondition","Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=
b;void 0!==b.credentials&&(this._config.credentials=wb(b.credentials))};P.prototype.enablePersistence=function(){if(this._firestoreClient)throw new A("failed-precondition","Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return $i(this,!0)};
var aj=function(a){a._firestoreClient||$i(a,!1);return a._firestoreClient},$i=function(a,b){z(!!a._config.settings.host,"FirestoreSettings.host cannot be falsey");z(!a._firestoreClient,"configureClient() called multiple times");var c=new Rb(a._config.databaseId,a._config.persistenceKey,a._config.settings.host,a._config.settings.ssl);a._dataConverter=new Ki(function(b){if(b instanceof Q){var c=a._config.databaseId,d=b.firestore._config.databaseId;if(!d.equals(c))throw new A("invalid-argument","Document reference is for database "+
(d.projectId+"/"+d.database+" but should be ")+("for database "+c.projectId+"/"+c.database));return new Ji(a._config.databaseId,b._key)}return b});a._firestoreClient=new ki(Ka(),c,a._config.credentials,new si);return a._firestoreClient.start(b)},Zi=function(a){a=a.options;if(!Ma(a,"projectId")){if(Ma(a,"firestoreId"))throw new A("invalid-argument",'"firestoreId" is now specified as "projectId" in firebase.initializeApp.');throw new A("invalid-argument",'"projectId" not provided in firebase.initializeApp.');
}if(Ma(a,"firestoreOptions"))throw new A("invalid-argument",'"firestoreOptions" values are now specified with Firestore.settings()');a=a.projectId;if(!a||"string"!==typeof a)throw new A("invalid-argument","projectId must be a string in firebase.app.App.options");return new Sb(a)};
P.prototype.collection=function(a){C("Firestore.collection",arguments,1);D("Firestore.collection","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty collection path to collection()");aj(this);return new bj(Gb(a),this)};P.prototype.doc=function(a){C("Firestore.doc",arguments,1);D("Firestore.doc","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty document path to doc()");aj(this);return cj(Gb(a),this)};
P.prototype.runTransaction=function(a){var b=this;C("Firestore.runTransaction",arguments,1);D("Firestore.runTransaction","function",1,a);return aj(this).transaction(function(c){return a(new dj(b,c))})};P.prototype.batch=function(){aj(this);return new ej(this)};
k.Object.defineProperties(P.prototype,{_databaseId:{configurable:!0,enumerable:!0,get:function(){return this._config.databaseId}},app:{configurable:!0,enumerable:!0,get:function(){if(!this._config.firebaseApp)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp}}});var dj=function(a,b){this._firestore=a;this._transaction=b};
dj.prototype.get=function(a){var b=this;C("Transaction.get",arguments,1);var c=fj("Transaction.get",a,this._firestore);return this._transaction.lookup([c._key]).then(function(a){if(!a||1!==a.length)return y("Mismatch in docs returned from document lookup.");a=a[0];return a instanceof bd?new gj(b._firestore,c._key,null,!1):new gj(b._firestore,c._key,a,!1)})};
dj.prototype.set=function(a,b,c){Ta("Transaction.set",arguments,2,3);var d=fj("Transaction.set",a,this._firestore);c=hj("Transaction.set",c);var e=Oi(this._firestore._dataConverter,"Transaction.set",b,c);this._transaction.set(d._key,e);return this};
dj.prototype.update=function(a,b,c,d){for(var e=[],f=3;f<arguments.length;++f)e[f-3]=arguments[f];"string"===typeof b||b instanceof Ob?(Sa("Transaction.update",arguments,3),f=fj("Transaction.update",a,this._firestore),e=Si(this._firestore._dataConverter,"Transaction.update",b,c,e)):(C("Transaction.update",arguments,2),f=fj("Transaction.update",a,this._firestore),e=Qi(this._firestore._dataConverter,"Transaction.update",b));this._transaction.update(f._key,e);return this};
dj.prototype.delete=function(a){C("Transaction.delete",arguments,1);var b=fj("Transaction.delete",a,this._firestore);this._transaction.delete(b._key);return this};var ej=function(a){this._firestore=a;this._mutations=[];this._committed=!1};
ej.prototype.set=function(a,b,c){Ta("WriteBatch.set",arguments,2,3);ij(this);var d=fj("WriteBatch.set",a,this._firestore);c=hj("WriteBatch.set",c);var e=Oi(this._firestore._dataConverter,"WriteBatch.set",b,c);this._mutations=this._mutations.concat(e.toMutations(d._key,ch));return this};
ej.prototype.update=function(a,b,c,d){for(var e=[],f=3;f<arguments.length;++f)e[f-3]=arguments[f];ij(this);"string"===typeof b||b instanceof Ob?(Sa("WriteBatch.update",arguments,3),f=fj("WriteBatch.update",a,this._firestore),e=Si(this._firestore._dataConverter,"WriteBatch.update",b,c,e)):(C("WriteBatch.update",arguments,2),f=fj("WriteBatch.update",a,this._firestore),e=Qi(this._firestore._dataConverter,"WriteBatch.update",b));this._mutations=this._mutations.concat(e.toMutations(f._key,ah(!0)));return this};
ej.prototype.delete=function(a){C("WriteBatch.delete",arguments,1);ij(this);var b=fj("WriteBatch.delete",a,this._firestore);this._mutations=this._mutations.concat(new mh(b._key,ch));return this};ej.prototype.commit=function(){ij(this);this._committed=!0;return 0<this._mutations.length?aj(this._firestore).write(this._mutations):Promise.resolve()};
var ij=function(a){if(a._committed)throw new A("failed-precondition","A write batch can no longer be used after commit() has been called.");},Q=function(a,b){this._key=a;this.firestore=b;this._firestoreClient=aj(this.firestore)},cj=function(a,b){if(0!==a.length%2)throw new A("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+(a.canonicalString()+" has "+a.length));return new Q(new F(a),b)};g=Q.prototype;
g.collection=function(a){C("DocumentReference.collection",arguments,1);D("DocumentReference.collection","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty collection name to collection()");var b=Gb(a);return new bj(this._key.path.child(b),this.firestore)};
g.set=function(a,b){Ta("DocumentReference.set",arguments,1,2);b=hj("DocumentReference.set",b);var c=Oi(this.firestore._dataConverter,"DocumentReference.set",a,b);return this._firestoreClient.write(c.toMutations(this._key,ch))};
g.update=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];"string"===typeof a||a instanceof Ob?(Sa("DocumentReference.update",arguments,2),d=Si(this.firestore._dataConverter,"DocumentReference.update",a,b,d)):(C("DocumentReference.update",arguments,1),d=Qi(this.firestore._dataConverter,"DocumentReference.update",a));return this._firestoreClient.write(d.toMutations(this._key,ah(!0)))};
g.delete=function(){C("DocumentReference.delete",arguments,0);return this._firestoreClient.write([new mh(this._key,ch)])};
g.onSnapshot=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Ta("DocumentReference.onSnapshot",arguments,1,4);var d={includeMetadataChanges:!1};c=0;"object"!==typeof b[c]||ui(b[c])||(d=b[c],ab("DocumentReference.onSnapshot",d,["includeMetadataChanges"]),Xa("DocumentReference.onSnapshot","boolean","includeMetadataChanges",d.includeMetadataChanges),c++);d={includeDocumentMetadataChanges:d.includeMetadataChanges,includeQueryMetadataChanges:d.includeMetadataChanges};ui(b[c])?b=
b[c]:(D("DocumentReference.onSnapshot","function",c,b[c]),Wa("DocumentReference.onSnapshot","function",c+1,b[c+1]),Wa("DocumentReference.onSnapshot","function",c+2,b[c+2]),b={next:b[c],error:b[c+1],complete:b[c+2]});return this.onSnapshotInternal(d,b)};
g.onSnapshotInternal=function(a,b){var c=this,d=function(a){console.error("Uncaught Error in onSnapshot:",a)};b.error&&(d=b.error.bind(b));var e=new qi({next:function(a){if(b.next){z(1>=a.docs.size,"Too many documents returned on a document query");var d=a.docs.get(c._key);b.next(new gj(c.firestore,c._key,d,a.fromCache))}},error:d}),f=this._firestoreClient.listen(new Jd(this._key.path),e,a);return function(){e.muted=!0;c._firestoreClient.unlisten(f)}};
g.get=function(){var a=this;C("DocumentReference.get",arguments,0);return new Promise(function(b,c){var d=a.onSnapshotInternal({includeQueryMetadataChanges:!0,includeDocumentMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(a){d();!a.exists&&a.metadata.fromCache?c(new A("aborted","Failed to get document because the client is offline.")):b(a)},error:c})})};
k.Object.defineProperties(Q.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return Cb(this._key.path)}},parent:{configurable:!0,enumerable:!0,get:function(){return new bj(Ab(this._key.path),this.firestore)}},path:{configurable:!0,enumerable:!0,get:function(){return this._key.path.canonicalString()}}});var gj=function(a,b,c,d){this._firestore=a;this._key=b;this._document=c;this._fromCache=d};
gj.prototype.data=function(){C("DocumentSnapshot.data",arguments,0);if(!this._document)throw new A("not-found","This document doesn't exist. Check doc.exists to make sure the document exists before calling doc.data().");return jj(this,this._document.data)};
gj.prototype.get=function(a){C("DocumentSnapshot.get",arguments,1);if(!this._document)throw new A("not-found","This document doesn't exist. Check doc.exists to make sure the document exists before calling doc.get().");var b=this._document.data.field(Ri("DocumentSnapshot.get",a));return void 0===b?void 0:kj(this,b)};
var jj=function(a,b){var c={};b.forEach(function(b,e){c[b]=kj(a,e)});return c},kj=function(a,b){if(b instanceof Fd)return jj(a,b);if(b instanceof Hd)return lj(a,b);if(b instanceof L){var c=b.value(),d=aj(a._firestore).databaseId();b.databaseId.equals(d)||Ia("Document "+a._key.path+" contains a document reference within a different database ("+(b.databaseId.projectId+"/"+b.databaseId.database+") which is not ")+"supported. It will be treated as a reference in the current "+("database ("+d.projectId+
"/"+d.database+") ")+"instead.");return new Q(c,a._firestore)}return b.value()},lj=function(a,b){return b.internalValue.map(function(b){return kj(a,b)})};
k.Object.defineProperties(gj.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return Cb(this._key.path)}},ref:{configurable:!0,enumerable:!0,get:function(){return new Q(this._key,this._firestore)}},exists:{configurable:!0,enumerable:!0,get:function(){return null!==this._document}},metadata:{configurable:!0,enumerable:!0,get:function(){return{hasPendingWrites:null!==this._document&&this._document.hasLocalMutations,fromCache:this._fromCache}}}});
var R=function(a,b){this._query=a;this.firestore=b};g=R.prototype;
g.where=function(a,b,c){C("Query.where",arguments,3);D("Query.where","string",2,b);$a("Query.where",3,c);var d=Ri("Query.where",a);if(Kb(d))if("string"===typeof c){if(-1!==c.indexOf("/"))throw new A("invalid-argument","Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it contains a slash.");if(""===c)throw new A("invalid-argument","Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");var e=
this._query.path.child(new Fb([c]));z(0===e.length%2,"Path should be a document key");var f=new L(this.firestore._databaseId,new F(e))}else if(c instanceof Q)f=new L(this.firestore._databaseId,c._key);else throw new A("invalid-argument","Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+(Za(c)+"."));else f=Ti(this.firestore._dataConverter,"Query.where",c);e=be(b);if(f.equals(pd)){if(e!==Pd)throw new A("invalid-argument",
"Invalid query. You can only perform equals comparisons on null.");d=new de(d)}else if(f.equals(xd)){if(e!==Pd)throw new A("invalid-argument","Invalid query. You can only perform equals comparisons on NaN.");d=new ee(d)}else d=new Od(d,e,f);if(d instanceof Od&&d.op!==Pd){e=Qd(this._query);if(null!==e&&!e.equals(d.field))throw new A("invalid-argument","Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have"+(" inequality filters on '"+e.toString()+
"'")+(" and '"+d.field.toString()+"'"));e=Nd(this._query);null!==e&&mj(d.field,e)}e=this._query;z(null==Qd(e)||!(d instanceof Od)||d.op===Pd||d.field.equals(Qd(e)),"Query must only have one inequality field.");z(0!==e.path.length%2,"No filtering allowed for document query");d=e.filters.concat([d]);d=new Jd(e.path,e.explicitOrderBy.slice(),d,e.limit,e.startAt,e.endAt);return new R(d,this.firestore)};
g.orderBy=function(a,b){Ta("Query.orderBy",arguments,1,2);Wa("Query.orderBy","string",2,b);if(void 0===b||"asc"===b)var c=Vd;else if("desc"===b)c=ge;else throw new A("invalid-argument","Function Query.orderBy() has unknown direction '"+b+"', expected 'asc' or 'desc'.");if(null!==this._query.startAt)throw new A("invalid-argument","Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new A("invalid-argument","Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");
var d=Ri("Query.orderBy",a);c=new Ud(d,c);null===Nd(this._query)&&(d=Qd(this._query),null!==d&&mj(d,c.field));d=this._query;z(0!==d.path.length%2,"No ordering allowed for document query");z(!d.startAt&&!d.endAt,"Bounds must be set after orderBy");c=new Jd(d.path,d.explicitOrderBy.concat([c]),d.filters.slice(),d.limit,d.startAt,d.endAt);return new R(c,this.firestore)};
g.limit=function(a){C("Query.limit",arguments,1);D("Query.limit","number",1,a);if(0>=a)throw new A("invalid-argument","Invalid Query. Query limit ("+a+") is invalid. Limit must be positive.");var b=this._query;var c=a;b=new Jd(b.path,b.explicitOrderBy.slice(),b.filters.slice(),c,b.startAt,b.endAt);return new R(b,this.firestore)};
g.startAt=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.startAt",arguments,1);c=nj(this,"Query.startAt",a,c,!0);return new R(Kd(this._query,c),this.firestore)};g.startAfter=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.startAfter",arguments,1);c=nj(this,"Query.startAfter",a,c,!1);return new R(Kd(this._query,c),this.firestore)};
g.endBefore=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.endBefore",arguments,1);c=nj(this,"Query.endBefore",a,c,!0);return new R(Ld(this._query,c),this.firestore)};g.endAt=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.endAt",arguments,1);c=nj(this,"Query.endAt",a,c,!1);return new R(Ld(this._query,c),this.firestore)};
var nj=function(a,b,c,d,e){$a(b,1,c);if(c instanceof gj){if(0<d.length)throw new A("invalid-argument","Too many arguments provided to "+b+"().");if(!c.exists)throw new A("not-found","Can't use a DocumentSnapshot that doesn't exist for "+(b+"()."));b=c._document;c=[];d=m(a._query.orderBy);for(var f=d.next();!f.done;f=d.next())if(f=f.value,Kb(f.field))c.push(new L(a.firestore._databaseId,b.key));else{var h=b.field(f.field);if(void 0!==h)c.push(h);else throw a=f.field.canonicalString(),new A("invalid-argument",
"Invalid query. You are trying to start or end a query using a "+("document for which the field '"+a+"' (used as the ")+"orderBy) does not exist.");}return new he(c,e)}c=[c].concat(d);d=a._query.explicitOrderBy;if(c.length>d.length)throw new A("invalid-argument","Too many arguments provided to "+b+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");f=[];for(h=0;h<c.length;h++){var l=c[h];if(Kb(d[h].field)){if("string"!==typeof l)throw new A("invalid-argument",
"Invalid query. Expected a string for document ID in "+(b+"(), but got a "+typeof l));if(-1!==l.indexOf("/"))throw new A("invalid-argument","Invalid query. Document ID '"+l+"' contains a slash in "+(b+"()"));l=new F(a._query.path.child(l));f.push(new L(a.firestore._databaseId,l))}else l=Ti(a.firestore._dataConverter,b,l),f.push(l)}return new he(f,e)};
R.prototype.onSnapshot=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Ta("Query.onSnapshot",arguments,1,4);c={};var d=0;"object"!==typeof b[d]||ui(b[d])||(c=b[d],ab("Query.onSnapshot",c,["includeQueryMetadataChanges","includeDocumentMetadataChanges"]),Xa("Query.onSnapshot","boolean","includeDocumentMetadataChanges",c.includeDocumentMetadataChanges),Xa("Query.onSnapshot","boolean","includeQueryMetadataChanges",c.includeQueryMetadataChanges),d++);ui(b[d])?b=b[d]:(D("Query.onSnapshot",
"function",d,b[d]),Wa("Query.onSnapshot","function",d+1,b[d+1]),Wa("Query.onSnapshot","function",d+2,b[d+2]),b={next:b[d],error:b[d+1],complete:b[d+2]});return this.onSnapshotInternal(c,b)};
R.prototype.onSnapshotInternal=function(a,b){var c=this,d=function(a){console.error("Uncaught Error in onSnapshot:",a)};b.error&&(d=b.error.bind(b));var e=new qi({next:function(a){b.next&&b.next(new oj(c.firestore,c._query,a))},error:d}),f=aj(this.firestore),h=f.listen(this._query,e,a);return function(){e.muted=!0;f.unlisten(h)}};
R.prototype.get=function(){var a=this;C("Query.get",arguments,0);return new Promise(function(b,c){var d=a.onSnapshotInternal({includeDocumentMetadataChanges:!1,includeQueryMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(a){d();b(a)},error:c})})};
var mj=function(a,b){if(!b.equals(a))throw new A("invalid-argument","Invalid query. You have a where filter with an inequality "+("(<, <=, >, or >=) on field '"+a.toString()+"' ")+("and so you must also use '"+a.toString()+"' ")+"as your first Query.orderBy(), but your first Query.orderBy() "+("is on field '"+b.toString()+"' instead."));},oj=function(a,b,c){this._firestore=a;this._originalQuery=b;this._snapshot=c;this._cachedChanges=null;this.metadata={fromCache:c.fromCache,hasPendingWrites:c.hasPendingWrites}};
oj.prototype.forEach=function(a,b){var c=this;Ta("QuerySnapshot.forEach",arguments,1,2);D("QuerySnapshot.forEach","function",1,a);this._snapshot.docs.forEach(function(d){a.call(b,new gj(c._firestore,d.key,d,c.metadata.fromCache))})};
k.Object.defineProperties(oj.prototype,{docs:{configurable:!0,enumerable:!0,get:function(){var a=[];this.forEach(function(b){return a.push(b)});return a}},empty:{configurable:!0,enumerable:!0,get:function(){return this._snapshot.docs.isEmpty()}},size:{configurable:!0,enumerable:!0,get:function(){return this._snapshot.docs.size}},query:{configurable:!0,enumerable:!0,get:function(){return new R(this._originalQuery,this._firestore)}},docChanges:{configurable:!0,enumerable:!0,get:function(){this._cachedChanges||
(this._cachedChanges=pj(this._firestore,this._snapshot));return this._cachedChanges}}});var bj=function(a,b){R.call(this,new Jd(a),b);if(1!==a.length%2)throw new A("invalid-argument","Invalid collection reference. Collection references must have an odd number of segments, but "+(a.canonicalString()+" has "+a.length));};n(bj,R);
bj.prototype.doc=function(a){Ta("CollectionReference.doc",arguments,0,1);Wa("CollectionReference.doc","string",1,a);void 0===a&&(a=cb());if("string"!==typeof a||""===a)throw new A("invalid-argument","Document path must be a non-empty string");var b=Gb(a);return cj(this._query.path.child(b),this.firestore)};bj.prototype.add=function(a){C("CollectionReference.add",arguments,1);D("CollectionReference.add","object",1,a);var b=this.doc();return b.set(a).then(function(){return b})};
k.Object.defineProperties(bj.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return Cb(this._query.path)}},parent:{configurable:!0,enumerable:!0,get:function(){var a=Ab(this._query.path);return a.isEmpty()?null:new Q(new F(a),this.firestore)}},path:{configurable:!0,enumerable:!0,get:function(){return this._query.path.canonicalString()}}});function hj(a,b){if(void 0===b)return{merge:!1};ab(a,b,["merge"]);Xa(a,"boolean","merge",b.merge);return b}
function fj(a,b,c){if(b instanceof Q){if(b.firestore!==c)throw new A("invalid-argument","Provided document reference is from a different Firestore instance.");return b}throw bb(a,"DocumentReference",b);}
function pj(a,b){if(b.oldDocs.isEmpty()){var c,d=0;return b.docChanges.map(function(e){var f=new gj(a,e.doc.key,e.doc,b.fromCache);z(0===e.type,"Invalid event type for first snapshot");z(!c||0>b.query.docComparator(c,e.doc),"Got added events in wrong order");c=e.doc;return{type:"added",doc:f,oldIndex:-1,newIndex:d++}})}var e=b.oldDocs;return b.docChanges.map(function(c){var d=new gj(a,c.doc.key,c.doc,b.fromCache),f=-1,p=-1;0!==c.type&&(f=e.indexOf(c.doc.key),z(0<=f,"Index for document not found"),
e=e.delete(c.doc.key));1!==c.type&&(e=e.add(c.doc),p=e.indexOf(c.doc.key));return{type:qj(c.type),doc:d,oldIndex:f,newIndex:p}})}function qj(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return y("Unknown change type: "+a)}}
var rj=La(P,"Use firebase.firestore() instead."),sj=La(dj,"Use firebase.firestore().runTransaction() instead."),tj=La(ej,"Use firebase.firestore().batch() instead."),uj=La(Q,"Use firebase.firestore().doc() instead."),vj=La(gj),wj=La(R),xj=La(oj),yj=La(bj,"Use firebase.firestore().collection() instead.");P.prototype.settings=P.prototype.settings;P.prototype.collection=P.prototype.collection;P.prototype.doc=P.prototype.doc;P.prototype.runTransaction=P.prototype.runTransaction;P.prototype.batch=P.prototype.batch;P.prototype.INTERNAL=P.prototype.INTERNAL;dj.get=dj.prototype.get;dj.set=dj.prototype.set;dj.update=dj.prototype.update;dj["delete"]=dj.prototype.delete;ej.set=ej.prototype.set;ej.update=ej.prototype.update;ej["delete"]=ej.prototype.delete;ej.commit=ej.prototype.commit;
Q.prototype.collection=Q.prototype.collection;Q.prototype.set=Q.prototype.set;Q.prototype.update=Q.prototype.update;Q.prototype["delete"]=Q.prototype.delete;Q.prototype.onSnapshot=Q.prototype.onSnapshot;Q.prototype.get=Q.prototype.get;gj.prototype.data=gj.prototype.data;gj.prototype.get=gj.prototype.get;R.prototype.where=R.prototype.where;R.prototype.orderBy=R.prototype.orderBy;R.prototype.limit=R.prototype.limit;R.prototype.startAt=R.prototype.startAt;R.prototype.startAfter=R.prototype.startAfter;
R.prototype.endBefore=R.prototype.endBefore;R.prototype.endAt=R.prototype.endAt;R.prototype.onSnapshot=R.prototype.onSnapshot;R.prototype.get=R.prototype.get;bj.prototype.doc=bj.prototype.doc;bj.prototype.add=bj.prototype.add;oj.prototype.forEach=oj.prototype.forEach;Ai.serverTimestamp=function(){return zi};Ai["delete"]=function(){return xi};jb.fromUint8Array=ib;jb.fromBase64String=hb;jb.prototype.toUint8Array=gb.prototype.toUint8Array;jb.prototype.toBase64=gb.prototype.toBase64;Ob.documentId=function(){return Pb};var zj={Firestore:rj,GeoPoint:Mh,Blob:jb,Transaction:sj,WriteBatch:tj,DocumentReference:uj,DocumentSnapshot:vj,Query:wj,QuerySnapshot:xj,CollectionReference:yj,FieldPath:Ob,FieldValue:Ai,setLogLevel:function(a){C("Firestore.setLogLevel",arguments,1);D("Firestore.setLogLevel","string",1,a);switch(a){case "debug":Ga=0;break;case "error":Ga=1;break;case "silent":Ga=2;break;default:throw new A("invalid-argument","Invalid log level: "+a);}}};
function Aj(){firebase.INTERNAL.registerService("firestore",function(a){return new P(a)},Qa(zj))};var Bj=function(a){this.wrappedOnMessage=this.wrappedOnClose=this.wrappedOnOpen=null;this.sendFn=a.sendFn;this.closeFn=a.closeFn};g=Bj.prototype;g.onOpen=function(a){z(!this.wrappedOnOpen,"Called onOpen on stream twice!");this.wrappedOnOpen=a};g.onClose=function(a){z(!this.wrappedOnClose,"Called onClose on stream twice!");this.wrappedOnClose=a};g.onMessage=function(a){z(!this.wrappedOnMessage,"Called onMessage on stream twice!");this.wrappedOnMessage=a};g.close=function(){this.closeFn()};g.send=function(a){this.sendFn(a)};
var Cj=function(a,b){z(null!==a.wrappedOnClose,"Cannot call onClose because no callback was set");a.wrappedOnClose(b)};var Dj=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Dj);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))};u(Dj,Error);Dj.prototype.name="CustomError";var Ej=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")},Fj=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Gj=function(a,b){return a<b?-1:a>b?1:0};var Hj=function(a,b){b.unshift(a);Dj.call(this,Ej.apply(null,b));b.shift()};u(Hj,Dj);Hj.prototype.name="AssertionError";
var Ij=function(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var f=d}else a&&(e+=": "+a,f=b);throw new Hj(""+e,f||[]);},S=function(a,b,c){a||Ij("",null,b,Array.prototype.slice.call(arguments,2))},Jj=function(a,b){throw new Hj("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));},Kj=function(a,b,c){sa(a)||Ij("Expected number but got %s: %s.",[ua(a),a],b,Array.prototype.slice.call(arguments,2));return a};var Lj=Array.prototype.indexOf?function(a,b,c){S(null!=a.length);return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(r(a))return r(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Mj=Array.prototype.lastIndexOf?function(a,b,c){S(null!=a.length);return Array.prototype.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(r(a))return r(b)&&1==
b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1},Nj=Array.prototype.forEach?function(a,b,c){S(null!=a.length);Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=r(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Oj=Array.prototype.some?function(a,b,c){S(null!=a.length);return Array.prototype.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=r(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},Pj=Array.prototype.every?
function(a,b,c){S(null!=a.length);return Array.prototype.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=r(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},Rj=function(a){a:{var b=Qj;for(var c=a.length,d=r(a)?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:r(a)?a.charAt(b):a[b]},Sj=function(a){if(!va(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0},Uj=function(a,b){b=Lj(a,b);var c;(c=0<=b)&&Tj(a,b);return c},
Tj=function(a,b){S(null!=a.length);Array.prototype.splice.call(a,b,1)},Vj=function(a){return Array.prototype.concat.apply([],arguments)},Wj=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};var Xj;a:{var Yj=q.navigator;if(Yj){var Zj=Yj.userAgent;if(Zj){Xj=Zj;break a}}Xj=""}var T=function(a){return-1!=Xj.indexOf(a)};var ak=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},bk=function(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1},ck=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b},dk=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b},ek=function(a){var b={},c;for(c in a)b[c]=a[c];return b},fk="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),gk=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=
d[c];for(var f=0;f<fk.length;f++)c=fk[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var hk=function(){return T("iPhone")&&!T("iPod")&&!T("iPad")};var ik=function(a){ik[" "](a);return a};ik[" "]=ta;var kk=function(a,b){var c=jk;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)};var lk=T("Opera"),mk=T("Trident")||T("MSIE"),nk=T("Edge"),ok=T("Gecko")&&!(-1!=Xj.toLowerCase().indexOf("webkit")&&!T("Edge"))&&!(T("Trident")||T("MSIE"))&&!T("Edge"),pk=-1!=Xj.toLowerCase().indexOf("webkit")&&!T("Edge");pk&&T("Mobile");T("Macintosh");T("Windows");T("Linux")||T("CrOS");var qk=q.navigator||null;qk&&(qk.appVersion||"").indexOf("X11");T("Android");hk();T("iPad");T("iPod");hk()||T("iPad")||T("iPod");var rk=function(){var a=q.document;return a?a.documentMode:void 0},sk;
a:{var tk="",uk=function(){var a=Xj;if(ok)return/rv\:([^\);]+)(\)|;)/.exec(a);if(nk)return/Edge\/([\d\.]+)/.exec(a);if(mk)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(pk)return/WebKit\/(\S+)/.exec(a);if(lk)return/(?:Version)[ \/]?(\S+)/.exec(a)}();uk&&(tk=uk?uk[1]:"");if(mk){var vk=rk();if(null!=vk&&vk>parseFloat(tk)){sk=String(vk);break a}}sk=tk}
var wk=sk,jk={},xk=function(a){return kk(a,function(){for(var b=0,c=Fj(String(wk)).split("."),d=Fj(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var h=c[f]||"",l=d[f]||"";do{h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];l=/(\d*)(\D*)(.*)/.exec(l)||["","","",""];if(0==h[0].length&&0==l[0].length)break;b=Gj(0==h[1].length?0:parseInt(h[1],10),0==l[1].length?0:parseInt(l[1],10))||Gj(0==h[2].length,0==l[2].length)||Gj(h[2],l[2]);h=h[3];l=l[3]}while(0==b)}return 0<=b})},yk;var zk=q.document;
yk=zk&&mk?rk()||("CSS1Compat"==zk.compatMode?parseInt(wk,10):5):void 0;var Ak=Object.freeze||function(a){return a};var Bk=function(){this.disposed_=this.disposed_;this.onDisposeCallbacks_=this.onDisposeCallbacks_};Bk.prototype.disposed_=!1;Bk.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())};Bk.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()};var Ck=!mk||9<=Number(yk),Dk=mk&&!xk("9");!pk||xk("528");ok&&xk("1.9b")||mk&&xk("8")||lk&&xk("9.5")||pk&&xk("528");ok&&!xk("8")||mk&&xk("9");var Ek=function(){if(!q.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});q.addEventListener("test",ta,b);q.removeEventListener("test",ta,b);return a}();var U=function(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.propagationStopped_=!1;this.returnValue_=!0};U.prototype.stopPropagation=function(){this.propagationStopped_=!0};U.prototype.preventDefault=function(){this.defaultPrevented=!0;this.returnValue_=!1};var Fk=function(a,b){U.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.event_=null;a&&this.init(a,b)};u(Fk,U);var Gk=Ak({2:"touch",3:"pen",4:"mouse"});
Fk.prototype.init=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(ok){a:{try{ik(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.offsetX=pk||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=pk||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,
this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=
r(a.pointerType)?a.pointerType:Gk[a.pointerType]||"";this.state=a.state;this.event_=a;a.defaultPrevented&&this.preventDefault()};Fk.prototype.stopPropagation=function(){Fk.superClass_.stopPropagation.call(this);this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0};
Fk.prototype.preventDefault=function(){Fk.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Dk)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Hk="closure_listenable_"+(1E6*Math.random()|0),Ik=function(a){return!(!a||!a[Hk])},Jk=0;var Kk=function(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.handler=e;this.key=++Jk;this.removed=this.callOnce=!1},Lk=function(a){a.removed=!0;a.listener=null;a.proxy=null;a.src=null;a.handler=null};var Mk=function(a){this.src=a;this.listeners={};this.typeCount_=0};Mk.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.listeners[f];a||(a=this.listeners[f]=[],this.typeCount_++);var h=Nk(a,b,d,e);-1<h?(b=a[h],c||(b.callOnce=!1)):(b=new Kk(b,this.src,f,!!d,e),b.callOnce=c,a.push(b));return b};
Mk.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.listeners))return!1;var e=this.listeners[a];b=Nk(e,b,c,d);return-1<b?(Lk(e[b]),Tj(e,b),0==e.length&&(delete this.listeners[a],this.typeCount_--),!0):!1};var Ok=function(a,b){var c=b.type;c in a.listeners&&Uj(a.listeners[c],b)&&(Lk(b),0==a.listeners[c].length&&(delete a.listeners[c],a.typeCount_--))};
Mk.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.listeners)if(!a||c==a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,Lk(d[e]);delete this.listeners[c];this.typeCount_--}return b};Mk.prototype.getListener=function(a,b,c,d){a=this.listeners[a.toString()];var e=-1;a&&(e=Nk(a,b,c,d));return-1<e?a[e]:null};
Mk.prototype.hasListener=function(a,b){var c=ra(a),d=c?a.toString():"",e=ra(b);return bk(this.listeners,function(a){for(var f=0;f<a.length;++f)if(!(c&&a[f].type!=d||e&&a[f].capture!=b))return!0;return!1})};var Nk=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener==b&&f.capture==!!c&&f.handler==d)return e}return-1};var Pk="closure_lm_"+(1E6*Math.random()|0),Qk={},Rk=0,Tk=function(a,b,c,d,e){if(d&&d.once)return Sk(a,b,c,d,e);if(va(b)){for(var f=0;f<b.length;f++)Tk(a,b[f],c,d,e);return null}c=Uk(c);return Ik(a)?a.listen(b,c,ya(d)?!!d.capture:!!d,e):Vk(a,b,c,!1,d,e)},Vk=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var h=ya(e)?!!e.capture:!!e,l=Wk(a);l||(a[Pk]=l=new Mk(a));c=l.add(b,c,d,h,f);if(c.proxy)return c;d=Xk();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Ek||(e=h),void 0===e&&(e=
!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Yk(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");Rk++;return c},Xk=function(){var a=Zk,b=Ck?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b},Sk=function(a,b,c,d,e){if(va(b)){for(var f=0;f<b.length;f++)Sk(a,b[f],c,d,e);return null}c=Uk(c);return Ik(a)?a.listenOnce(b,c,ya(d)?!!d.capture:!!d,e):Vk(a,b,c,!0,d,e)},$k=function(a,
b,c,d,e){if(va(b))for(var f=0;f<b.length;f++)$k(a,b[f],c,d,e);else d=ya(d)?!!d.capture:!!d,c=Uk(c),Ik(a)?a.unlisten(b,c,d,e):a&&(a=Wk(a))&&(b=a.getListener(b,c,d,e))&&al(b)},al=function(a){if(!sa(a)&&a&&!a.removed){var b=a.src;if(Ik(b))Ok(b.eventTargetListeners_,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(Yk(c),d);Rk--;(c=Wk(b))?(Ok(c,a),0==c.typeCount_&&(c.src=null,b[Pk]=null)):Lk(a)}}},Yk=function(a){return a in Qk?Qk[a]:
Qk[a]="on"+a},cl=function(a,b,c,d){var e=!0;if(a=Wk(a))if(b=a.listeners[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.removed&&(f=bl(f,d),e=e&&!1!==f)}return e},bl=function(a,b){var c=a.listener,d=a.handler||a.src;a.callOnce&&al(a);return c.call(d,b)},Zk=function(a,b){if(a.removed)return!0;if(!Ck){if(!b)a:{b=["window","event"];for(var c=q,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new Fk(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=
!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(h){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.propagationStopped_&&0<=e;e--){b.currentTarget=d[e];var f=cl(d[e],a,!0,b);c=c&&f}for(e=0;!b.propagationStopped_&&e<d.length;e++)b.currentTarget=d[e],f=cl(d[e],a,!1,b),c=c&&f}return c}return bl(a,new Fk(b,this))},Wk=function(a){a=a[Pk];return a instanceof Mk?a:null},dl="__closure_events_fn_"+(1E9*Math.random()>>>0),
Uk=function(a){S(a,"Listener can not be null.");if(xa(a))return a;S(a.handleEvent,"An object listener must have handleEvent method.");a[dl]||(a[dl]=function(b){return a.handleEvent(b)});return a[dl]};var el=function(){U.call(this,"d")};u(el,U);var fl=function(){U.call(this,"c")};u(fl,U);var gl=function(a,b,c){this.limit_=c;this.create_=a;this.reset_=b;this.occupants_=0;this.head_=null};gl.prototype.get=function(){if(0<this.occupants_){this.occupants_--;var a=this.head_;this.head_=a.next;a.next=null}else a=this.create_();return a};gl.prototype.put=function(a){this.reset_(a);this.occupants_<this.limit_&&(this.occupants_++,a.next=this.head_,this.head_=a)};var hl=function(a){q.setTimeout(function(){throw a;},0)},il,jl=function(){var a=q.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!T("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host;
a=t(function(a){if(("*"==d||a.origin==d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!T("Trident")&&!T("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(ra(c.next)){c=c.next;var a=c.cb;c.cb=null;a()}};return function(a){d.next={cb:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?
function(a){var b=document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){q.setTimeout(a,0)}};var kl=function(){this.workTail_=this.workHead_=null},ml=new gl(function(){return new ll},function(a){a.reset()},100);kl.prototype.add=function(a,b){var c=ml.get();c.set(a,b);this.workTail_?this.workTail_.next=c:(S(!this.workHead_),this.workHead_=c);this.workTail_=c};kl.prototype.remove=function(){var a=null;this.workHead_&&(a=this.workHead_,this.workHead_=this.workHead_.next,this.workHead_||(this.workTail_=null),a.next=null);return a};var ll=function(){this.next=this.scope=this.fn=null};
ll.prototype.set=function(a,b){this.fn=a;this.scope=b;this.next=null};ll.prototype.reset=function(){this.next=this.scope=this.fn=null};var nl,pl=function(){if(-1!=String(q.Promise).indexOf("[native code]")){var a=q.Promise.resolve(void 0);nl=function(){a.then(ol)}}else nl=function(){var a=ol;!xa(q.setImmediate)||q.Window&&q.Window.prototype&&!T("Edge")&&q.Window.prototype.setImmediate==q.setImmediate?(il||(il=jl()),il(a)):q.setImmediate(a)}},ql=!1,rl=new kl,ol=function(){for(var a;a=rl.remove();){try{a.fn.call(a.scope)}catch(b){hl(b)}ml.put(a)}ql=!1};var sl=function(){Bk.call(this);this.eventTargetListeners_=new Mk(this);this.actualEventTarget_=this;this.parentEventTarget_=null};u(sl,Bk);sl.prototype[Hk]=!0;g=sl.prototype;g.addEventListener=function(a,b,c,d){Tk(this,a,b,c,d)};g.removeEventListener=function(a,b,c,d){$k(this,a,b,c,d)};
g.dispatchEvent=function(a){tl(this);var b=this.parentEventTarget_;if(b){var c=[];for(var d=1;b;b=b.parentEventTarget_)c.push(b),S(1E3>++d,"infinite loop")}b=this.actualEventTarget_;d=a.type||a;if(r(a))a=new U(a,b);else if(a instanceof U)a.target=a.target||b;else{var e=a;a=new U(d,b);gk(a,e)}e=!0;if(c)for(var f=c.length-1;!a.propagationStopped_&&0<=f;f--){var h=a.currentTarget=c[f];e=ul(h,d,!0,a)&&e}a.propagationStopped_||(h=a.currentTarget=b,e=ul(h,d,!0,a)&&e,a.propagationStopped_||(e=ul(h,d,!1,
a)&&e));if(c)for(f=0;!a.propagationStopped_&&f<c.length;f++)h=a.currentTarget=c[f],e=ul(h,d,!1,a)&&e;return e};g.disposeInternal=function(){sl.superClass_.disposeInternal.call(this);this.removeAllListeners();this.parentEventTarget_=null};g.listen=function(a,b,c,d){tl(this);return this.eventTargetListeners_.add(String(a),b,!1,c,d)};g.listenOnce=function(a,b,c,d){return this.eventTargetListeners_.add(String(a),b,!0,c,d)};
g.unlisten=function(a,b,c,d){return this.eventTargetListeners_.remove(String(a),b,c,d)};g.removeAllListeners=function(a){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(a):0};var ul=function(a,b,c,d){b=a.eventTargetListeners_.listeners[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var h=b[f];if(h&&!h.removed&&h.capture==c){var l=h.listener,p=h.handler||h.src;h.callOnce&&Ok(a.eventTargetListeners_,h);e=!1!==l.call(p,d)&&e}}return e&&0!=d.returnValue_};
sl.prototype.getListener=function(a,b,c,d){return this.eventTargetListeners_.getListener(String(a),b,c,d)};sl.prototype.hasListener=function(a,b){return this.eventTargetListeners_.hasListener(ra(a)?String(a):void 0,b)};var tl=function(a){S(a.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")};var vl=function(a,b){sl.call(this);this.interval_=a||1;this.timerObject_=b||q;this.boundTick_=t(this.tick_,this);this.last_=Ea()};u(vl,sl);g=vl.prototype;g.enabled=!1;g.timer_=null;g.setInterval=function(a){this.interval_=a;this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()};
g.tick_=function(){if(this.enabled){var a=Ea()-this.last_;0<a&&a<.8*this.interval_?this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a):(this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null),this.dispatchEvent("tick"),this.enabled&&(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=Ea()))}};
g.start=function(){this.enabled=!0;this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=Ea())};g.stop=function(){this.enabled=!1;this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)};g.disposeInternal=function(){vl.superClass_.disposeInternal.call(this);this.stop();delete this.timerObject_};
var wl=function(a,b,c){if(xa(a))c&&(a=t(a,c));else if(a&&"function"==typeof a.handleEvent)a=t(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:q.setTimeout(a,b||0)};var xl=function(a,b,c){Bk.call(this);this.listener_=null!=c?t(a,c):a;this.interval_=b;this.callback_=t(this.onTimer_,this);this.args_=[]};u(xl,Bk);g=xl.prototype;g.shouldFire_=!1;g.pauseCount_=0;g.timer_=null;g.fire=function(a){this.args_=arguments;this.timer_||this.pauseCount_?this.shouldFire_=!0:yl(this)};g.stop=function(){this.timer_&&(q.clearTimeout(this.timer_),this.timer_=null,this.shouldFire_=!1,this.args_=[])};g.pause=function(){this.pauseCount_++};
g.resume=function(){this.pauseCount_--;this.pauseCount_||!this.shouldFire_||this.timer_||(this.shouldFire_=!1,yl(this))};g.disposeInternal=function(){xl.superClass_.disposeInternal.call(this);this.stop()};g.onTimer_=function(){this.timer_=null;this.shouldFire_&&!this.pauseCount_&&(this.shouldFire_=!1,yl(this))};var yl=function(a){a.timer_=wl(a.callback_,a.interval_);a.listener_.apply(null,a.args_)};var zl=function(a,b,c,d,e){this.reset(a,b,c,d,e)};zl.prototype.exception_=null;var Al=0;zl.prototype.reset=function(a,b,c,d,e){"number"==typeof e||Al++;d||Ea();this.level_=a;this.msg_=b;delete this.exception_};zl.prototype.setLevel=function(a){this.level_=a};var Bl=function(a){this.name_=a;this.handlers_=this.children_=this.level_=this.parent_=null},Cl=function(a,b){this.name=a;this.value=b};Cl.prototype.toString=function(){return this.name};var Dl=new Cl("SEVERE",1E3),El=new Cl("WARNING",900),Fl=new Cl("INFO",800),Gl=new Cl("CONFIG",700),Hl=new Cl("FINE",500);Bl.prototype.getName=function(){return this.name_};Bl.prototype.getParent=function(){return this.parent_};Bl.prototype.getChildren=function(){this.children_||(this.children_={});return this.children_};
Bl.prototype.setLevel=function(a){this.level_=a};var Il=function(a){if(a.level_)return a.level_;if(a.parent_)return Il(a.parent_);Jj("Root logger has no level set.");return null};g=Bl.prototype;g.log=function(a,b,c){if(a.value>=Il(this).value)for(xa(b)&&(b=b()),a=new zl(a,String(b),this.name_),c&&(a.exception_=c),c="log:"+a.msg_,(b=q.console)&&b.timeStamp&&b.timeStamp(c),(b=q.msWriteProfilerMark)&&b(c),c=this;c;){var d=c,e=a;if(d.handlers_)for(var f=0;b=d.handlers_[f];f++)b(e);c=c.getParent()}};
g.severe=function(a,b){this.log(Dl,a,b)};g.warning=function(a,b){this.log(El,a,b)};g.info=function(a,b){this.log(Fl,a,b)};g.config=function(a,b){this.log(Gl,a,b)};var Jl={},Kl=null,Ll=function(a){Kl||(Kl=new Bl(""),Jl[""]=Kl,Kl.setLevel(Gl));var b;if(!(b=Jl[a])){b=new Bl(a);var c=a.lastIndexOf("."),d=a.substr(c+1);c=Ll(a.substr(0,c));c.getChildren()[d]=b;b.parent_=c;Jl[a]=b}return b};var Ml=function(){this.relativeTimeStart_=Ea()},Nl=null;Ml.prototype.set=function(a){this.relativeTimeStart_=a};Ml.prototype.reset=function(){this.set(Ea())};Ml.prototype.get=function(){return this.relativeTimeStart_};var Ol=function(){Nl||(Nl=new Ml)},Pl=function(){Nl||(Nl=new Ml)};u(Pl,Ol);var Ql=function(a){Bk.call(this);this.handler_=a;this.keys_={}};u(Ql,Bk);var Rl=[];Ql.prototype.listen=function(a,b,c,d){va(b)||(b&&(Rl[0]=b.toString()),b=Rl);for(var e=0;e<b.length;e++){var f=Tk(a,b[e],c||this.handleEvent,d||!1,this.handler_||this);if(!f)break;this.keys_[f.key]=f}return this};Ql.prototype.listenOnce=function(a,b,c,d){return Sl(this,a,b,c,d)};
var Sl=function(a,b,c,d,e,f){if(va(c))for(var h=0;h<c.length;h++)Sl(a,b,c[h],d,e,f);else{b=Sk(b,c,d||a.handleEvent,e,f||a.handler_||a);if(!b)return a;a.keys_[b.key]=b}return a};Ql.prototype.unlisten=function(a,b,c,d,e){if(va(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else c=c||this.handleEvent,d=ya(d)?!!d.capture:!!d,e=e||this.handler_||this,c=Uk(c),d=!!d,b=Ik(a)?a.getListener(b,c,d,e):a?(a=Wk(a))?a.getListener(b,c,d,e):null:null,b&&(al(b),delete this.keys_[b.key]);return this};
Ql.prototype.removeAll=function(){ak(this.keys_,function(a,b){this.keys_.hasOwnProperty(b)&&al(a)},this);this.keys_={}};Ql.prototype.disposeInternal=function(){Ql.superClass_.disposeInternal.call(this);this.removeAll()};Ql.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};var Tl="StopIteration"in q?q.StopIteration:{message:"StopIteration",stack:""},Ul=function(){};Ul.prototype.next=function(){throw Tl;};Ul.prototype.__iterator__=function(){return this};var Vl=function(a){return/^\s*$/.test(a)?!1:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/(?:"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))},Wl=function(a){a=String(a);if(Vl(a))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a);},Zl=function(a){var b=[];Xl(new Yl,a,b);return b.join("")},Yl=function(){this.replacer_=
void 0},Xl=function(a,b,c){if(null==b)c.push("null");else{if("object"==typeof b){if(va(b)){var d=b;b=d.length;c.push("[");for(var e="",f=0;f<b;f++)c.push(e),e=d[f],Xl(a,a.replacer_?a.replacer_.call(d,String(f),e):e,c),e=",";c.push("]");return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push("{");f="";for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(e=b[d],"function"!=typeof e&&(c.push(f),$l(d,c),c.push(":"),Xl(a,a.replacer_?a.replacer_.call(b,d,e):
e,c),f=","));c.push("}");return}}switch(typeof b){case "string":$l(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?String(b):"null");break;case "boolean":c.push(String(b));break;case "function":c.push("null");break;default:throw Error("Unknown type: "+typeof b);}}},am={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},bm=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,$l=function(a,b){b.push('"',a.replace(bm,
function(a){var b=am[a];b||(b="\\u"+(a.charCodeAt(0)|65536).toString(16).substr(1),am[a]=b);return b}),'"')};var cm=function(a,b){S(ra(q.JSON),"JSON not defined");this.replacer_=a;this.reviver_=b};cm.prototype.stringify=function(a){return q.JSON.stringify(a,this.replacer_)};cm.prototype.parse=function(a){return q.JSON.parse(a,this.reviver_)};var dm=new sl,em=function(a){U.call(this,"serverreachability",a)};u(em,U);var fm=function(){dm.dispatchEvent(new em(dm))},gm=function(a,b){U.call(this,"statevent",a);this.stat=b};u(gm,U);var V=function(a){dm.dispatchEvent(new gm(dm,a))},hm=function(a,b,c){U.call(this,"timingevent",a);this.size=b;this.rtt=c};u(hm,U);var im=function(a,b){if(!xa(a))throw Error("Fn must not be null and must be a function");return q.setTimeout(function(){a()},b)};var jm=function(a,b){a&&a.info(b,void 0)},km=function(a,b){a&&a.log(Hl,b,void 0)};var lm=function(){this.logger_=Ll("goog.labs.net.webChannel.WebChannelDebug")},nm=function(a,b,c,d){a.info("XMLHTTP TEXT ("+b+"): "+mm(a,c)+(d?" "+d:""))};lm.prototype.debug=function(a){this.info(a)};var om=function(a,b,c){a.severe((c||"Exception")+b)};lm.prototype.info=function(a){jm(this.logger_,a)};lm.prototype.warning=function(a){var b=this.logger_;b&&b.warning(a,void 0)};lm.prototype.severe=function(a){var b=this.logger_;b&&b.severe(a,void 0)};
var mm=function(a,b){if(!b)return null;try{var c=JSON.parse(b);if(c)for(var d=0;d<c.length;d++)if(va(c[d])){var e=c[d];if(!(2>e.length)){var f=e[1];if(va(f)&&!(1>f.length)){var h=f[0];if("noop"!=h&&"stop"!=h&&"close"!=h)for(var l=1;l<f.length;l++)f[l]=""}}}return Zl(c)}catch(p){return a.debug("Exception parsing expected JS array - probably was not JS"),b}};var pm=function(){};pm.prototype.cachedOptions_=null;var rm=function(a){var b;(b=a.cachedOptions_)||(b={},qm(a)&&(b[0]=!0,b[1]=!0),b=a.cachedOptions_=b);return b};var sm,tm=function(){};u(tm,pm);var um=function(a){return(a=qm(a))?new ActiveXObject(a):new XMLHttpRequest},qm=function(a){if(!a.ieProgId_&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.ieProgId_=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.ieProgId_};
sm=new tm;var W=function(a,b,c,d,e){this.channel_=a;this.channelDebug_=b;this.sid_=c;this.rid_=d;this.retryId_=e||1;this.eventHandler_=new Ql(this);this.timeout_=45E3;this.pollingTimer_=new vl;this.pollingTimer_.setInterval(250);this.extraHeaders_=null;this.successful_=!1;this.postData_=this.requestUri_=this.baseUri_=this.type_=this.requestStartTime_=this.watchDogTimeoutTime_=this.watchDogTimerId_=null;this.pendingMessages_=[];this.xmlHttp_=null;this.xmlHttpChunkStart_=0;this.lastError_=this.verb_=null;this.lastStatusCode_=
-1;this.cancelled_=!1;this.readyStateChangeThrottleMs_=0;this.readyStateChangeThrottle_=null;this.decodeChunks_=!1},wm=function(a,b){switch(a){case 0:return"Non-200 return code ("+b+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}},xm={},ym={};W.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};W.prototype.setTimeout=function(a){this.timeout_=a};
W.prototype.setReadyStateChangeThrottle=function(a){this.readyStateChangeThrottleMs_=a};W.prototype.getPendingMessages=function(){return this.pendingMessages_};
var Bm=function(a,b,c){a.type_=1;a.baseUri_=zm(b.clone());a.postData_=c;a.decodeChunks_=!0;Am(a,null)},Cm=function(a,b,c,d){a.type_=1;a.baseUri_=zm(b.clone());a.postData_=null;a.decodeChunks_=c;Am(a,d)},Am=function(a,b){a.requestStartTime_=Ea();Dm(a);a.requestUri_=a.baseUri_.clone();Em(a.requestUri_,"t",a.retryId_);a.xmlHttpChunkStart_=0;a.xmlHttp_=a.channel_.createXhrIo(a.channel_.shouldUseSecondaryDomains()?b:null);0<a.readyStateChangeThrottleMs_&&(a.readyStateChangeThrottle_=new xl(t(a.xmlHttpHandler_,
a,a.xmlHttp_),a.readyStateChangeThrottleMs_));a.eventHandler_.listen(a.xmlHttp_,"readystatechange",a.readyStateChangeHandler_);b=a.extraHeaders_?ek(a.extraHeaders_):{};a.postData_?(a.verb_||(a.verb_="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.xmlHttp_.send(a.requestUri_,a.verb_,a.postData_,b)):(a.verb_="GET",a.xmlHttp_.send(a.requestUri_,a.verb_,null,b));fm();var c=a.postData_;if(c){b="";c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");if(1<e.length){var f=e[0];
e=e[1];var h=f.split("_");b=2<=h.length&&"type"==h[1]?b+(f+"="+e+"&"):b+(f+"=redacted&")}}}else b=null;a.channelDebug_.info("XMLHTTP REQ ("+a.rid_+") [attempt "+a.retryId_+"]: "+a.verb_+"\n"+a.requestUri_+"\n"+b)};W.prototype.readyStateChangeHandler_=function(a){a=a.target;var b=this.readyStateChangeThrottle_;b&&3==Fm(a)?(this.channelDebug_.debug("Throttling readystatechange."),b.fire()):this.xmlHttpHandler_(a)};
W.prototype.xmlHttpHandler_=function(a){try{if(a==this.xmlHttp_){var b=Fm(this.xmlHttp_),c=this.xmlHttp_.lastErrorCode_;if(!(3>b||3==b&&!lk&&!Gm(this.xmlHttp_))){this.cancelled_||4!=b||7==c||fm();Hm(this);var d=Im(this.xmlHttp_);this.lastStatusCode_=d;var e=Gm(this.xmlHttp_);e||this.channelDebug_.debug("No response text for uri "+this.requestUri_+" status "+d);this.successful_=200==d;this.channelDebug_.info("XMLHTTP RESP ("+this.rid_+") [ attempt "+this.retryId_+"]: "+this.verb_+"\n"+this.requestUri_+
"\n"+b+" "+d);if(this.successful_){if(this.decodeChunks_?(Jm(this,b,e),lk&&this.successful_&&3==b&&(this.eventHandler_.listen(this.pollingTimer_,"tick",this.pollResponse_),this.pollingTimer_.start())):(nm(this.channelDebug_,this.rid_,e,null),Km(this,e)),4==b&&Lm(this),this.successful_&&!this.cancelled_)if(4==b)this.channel_.onRequestComplete(this);else this.successful_=!1,Dm(this)}else 400==d&&0<e.indexOf("Unknown SID")?(this.lastError_=3,V(12),this.channelDebug_.warning("XMLHTTP Unknown SID ("+this.rid_+
")")):(this.lastError_=0,V(13),this.channelDebug_.warning("XMLHTTP Bad status "+d+" ("+this.rid_+")")),Lm(this),Mm(this)}}else this.channelDebug_.warning("Called back with an unexpected xmlhttp")}catch(f){this.channelDebug_.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.xmlHttp_&&Gm(this.xmlHttp_)?om(this.channelDebug_,f,"ResponseText: "+Gm(this.xmlHttp_)):om(this.channelDebug_,f,"No response text")}finally{}};
var Jm=function(a,b,c){for(var d=!0;!a.cancelled_&&a.xmlHttpChunkStart_<c.length;){var e=Nm(a,c);if(e==ym){4==b&&(a.lastError_=4,V(14),d=!1);nm(a.channelDebug_,a.rid_,null,"[Incomplete Response]");break}else if(e==xm){a.lastError_=4;V(15);nm(a.channelDebug_,a.rid_,c,"[Invalid Chunk]");d=!1;break}else nm(a.channelDebug_,a.rid_,e,null),Km(a,e)}4==b&&0==c.length&&(a.lastError_=1,V(16),d=!1);a.successful_=a.successful_&&d;d||(nm(a.channelDebug_,a.rid_,c,"[Invalid Chunked Response]"),Lm(a),Mm(a))};
W.prototype.pollResponse_=function(){var a=Fm(this.xmlHttp_),b=Gm(this.xmlHttp_);this.xmlHttpChunkStart_<b.length&&(Hm(this),Jm(this,a,b),this.successful_&&4!=a&&Dm(this))};var Nm=function(a,b){var c=a.xmlHttpChunkStart_,d=b.indexOf("\n",c);if(-1==d)return ym;c=Number(b.substring(c,d));if(isNaN(c))return xm;d+=1;if(d+c>b.length)return ym;b=b.substr(d,c);a.xmlHttpChunkStart_=d+c;return b};W.prototype.cancel=function(){this.cancelled_=!0;Lm(this)};
var Dm=function(a){a.watchDogTimeoutTime_=Ea()+a.timeout_;Om(a,a.timeout_)},Om=function(a,b){if(null!=a.watchDogTimerId_)throw Error("WatchDog timer not null");a.watchDogTimerId_=im(t(a.onWatchDogTimeout_,a),b)},Hm=function(a){a.watchDogTimerId_&&(q.clearTimeout(a.watchDogTimerId_),a.watchDogTimerId_=null)};
W.prototype.onWatchDogTimeout_=function(){this.watchDogTimerId_=null;var a=Ea();0<=a-this.watchDogTimeoutTime_?(this.successful_&&this.channelDebug_.severe("Received watchdog timeout even though request loaded successfully"),this.channelDebug_.info("TIMEOUT: "+this.requestUri_),2!=this.type_&&(fm(),V(17)),Lm(this),this.lastError_=2,Mm(this)):(this.channelDebug_.warning("WatchDog timer called too early"),Om(this,this.watchDogTimeoutTime_-a))};
var Mm=function(a){if(!a.channel_.isClosed()&&!a.cancelled_)a.channel_.onRequestComplete(a)},Lm=function(a){Hm(a);var b=a.readyStateChangeThrottle_;b&&"function"==typeof b.dispose&&b.dispose();a.readyStateChangeThrottle_=null;a.pollingTimer_.stop();a.eventHandler_.removeAll();a.xmlHttp_&&(b=a.xmlHttp_,a.xmlHttp_=null,b.abort(),b.dispose())};W.prototype.getLastError=function(){return this.lastError_};var Km=function(a,b){try{a.channel_.onRequestData(a,b),fm()}catch(c){om(a.channelDebug_,c,"Error in httprequest callback")}};var Pm=function(a,b){this.channel_=a;this.channelDebug_=b;this.request_=this.extraHeaders_=null;this.receivedIntermediateResult_=!1;this.path_=null;this.lastStatusCode_=-1;this.clientProtocol_=this.hostPrefix_=null};Pm.prototype.state_=null;Pm.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};
Pm.prototype.connect=function(a){this.path_=a;a=Qm(this.channel_,this.path_);V(3);var b=this.channel_.connState_.handshakeResult;null!=b?(this.hostPrefix_=this.channel_.correctHostPrefix(b[0]),this.state_=1,Rm(this)):(Em(a,"MODE","init"),!this.channel_.backgroundChannelTest_&&this.channel_.httpSessionIdParam_&&Em(a,"X-HTTP-Session-Id",this.channel_.httpSessionIdParam_),this.request_=new W(this,this.channelDebug_,void 0,void 0,void 0),this.request_.setExtraHeaders(this.extraHeaders_),Cm(this.request_,
a,!1,null),this.state_=0)};
var Rm=function(a){a.channelDebug_.debug("TestConnection: starting stage 2");var b=a.channel_.connState_.bufferingProxyResult;if(null!=b)a.channelDebug_.debug("TestConnection: skipping stage 2, precomputed result is "+b?"Buffered":"Unbuffered"),V(4),b?(V(10),Sm(a.channel_,a,!1)):(V(11),Sm(a.channel_,a,!0));else{a.request_=new W(a,a.channelDebug_,void 0,void 0,void 0);a.request_.setExtraHeaders(a.extraHeaders_);b=Tm(a.channel_,a.hostPrefix_,a.path_);V(4);Em(b,"TYPE","xmlhttp");var c=a.channel_.httpSessionIdParam_,
d=a.channel_.httpSessionId_;c&&d&&X(b,c,d);Cm(a.request_,b,!1,a.hostPrefix_)}};g=Pm.prototype;g.createXhrIo=function(a){return this.channel_.createXhrIo(a)};g.abort=function(){this.request_&&(this.request_.cancel(),this.request_=null);this.lastStatusCode_=-1};g.isClosed=function(){return!1};
g.onRequestData=function(a,b){this.lastStatusCode_=a.lastStatusCode_;if(0==this.state_)if(this.channelDebug_.debug("TestConnection: Got data for stage 1"),this.applyControlHeaders_(a),b){try{var c=Um(this.channel_.wireCodec_,b)}catch(d){om(this.channelDebug_,d);Vm(this.channel_,this);return}this.hostPrefix_=this.channel_.correctHostPrefix(c[0])}else this.channelDebug_.debug("TestConnection: Null responseText"),Vm(this.channel_,this);else if(1==this.state_)if(this.receivedIntermediateResult_)V(6);
else if("11111"==b){if(V(5),this.receivedIntermediateResult_=!0,!mk||10<=Number(yk))this.lastStatusCode_=200,this.request_.cancel(),this.channelDebug_.debug("Test connection succeeded; using streaming connection"),V(11),Sm(this.channel_,this,!0)}else V(7),this.receivedIntermediateResult_=!1};
g.onRequestComplete=function(){this.lastStatusCode_=this.request_.lastStatusCode_;this.request_.successful_?0==this.state_?(this.state_=1,this.channelDebug_.debug("TestConnection: request complete for initial check"),Rm(this)):1==this.state_&&(this.channelDebug_.debug("TestConnection: request complete for stage 2"),this.receivedIntermediateResult_?(this.channelDebug_.debug("Test connection succeeded; using streaming connection"),V(11),Sm(this.channel_,this,!0)):(this.channelDebug_.debug("Test connection failed; not using streaming"),
V(10),Sm(this.channel_,this,!1))):(this.channelDebug_.debug("TestConnection: request failed, in state "+this.state_),0==this.state_?V(8):1==this.state_&&V(9),Vm(this.channel_,this))};
g.applyControlHeaders_=function(a){if(!this.channel_.backgroundChannelTest_&&(a=a.xmlHttp_)){var b=a.xhr_?a.xhr_.getResponseHeader("X-Client-Wire-Protocol"):null;this.clientProtocol_=b?b:null;this.channel_.httpSessionIdParam_&&((a=a.xhr_?a.xhr_.getResponseHeader("X-HTTP-Session-Id"):null)?this.channel_.httpSessionId_=a:this.channelDebug_.warning("Missing X_HTTP_SESSION_ID in the handshake response"))}};g.shouldUseSecondaryDomains=function(){return this.channel_.shouldUseSecondaryDomains()};
g.isActive=function(){return this.channel_.isActive()};var Wm=function(){this.bufferingProxyResult=this.handshakeResult=null};var Xm=function(a,b){this.mapId=a;this.map=b;this.context=null};var Ym=function(a,b){this.map_={};this.keys_=[];this.version_=this.count_=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)};g=Ym.prototype;g.getCount=function(){return this.count_};g.getValues=function(){Zm(this);for(var a=[],b=0;b<this.keys_.length;b++)a.push(this.map_[this.keys_[b]]);return a};g.getKeys=function(){Zm(this);return this.keys_.concat()};
g.containsKey=function(a){return $m(this.map_,a)};g.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if($m(this.map_,c)&&this.map_[c]==a)return!0}return!1};g.equals=function(a,b){if(this===a)return!0;if(this.count_!=a.getCount())return!1;b=b||an;Zm(this);for(var c,d=0;c=this.keys_[d];d++)if(!b(this.get(c),a.get(c)))return!1;return!0};var an=function(a,b){return a===b};Ym.prototype.isEmpty=function(){return 0==this.count_};
Ym.prototype.clear=function(){this.map_={};this.version_=this.count_=this.keys_.length=0};Ym.prototype.remove=function(a){return $m(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&Zm(this),!0):!1};
var Zm=function(a){if(a.count_!=a.keys_.length){for(var b=0,c=0;b<a.keys_.length;){var d=a.keys_[b];$m(a.map_,d)&&(a.keys_[c++]=d);b++}a.keys_.length=c}if(a.count_!=a.keys_.length){var e={};for(c=b=0;b<a.keys_.length;)d=a.keys_[b],$m(e,d)||(a.keys_[c++]=d,e[d]=1),b++;a.keys_.length=c}};g=Ym.prototype;g.get=function(a,b){return $m(this.map_,a)?this.map_[a]:b};g.set=function(a,b){$m(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++);this.map_[a]=b};
g.addAll=function(a){if(a instanceof Ym){var b=a.getKeys();a=a.getValues()}else b=dk(a),a=ck(a);for(var c=0;c<b.length;c++)this.set(b[c],a[c])};g.forEach=function(a,b){for(var c=this.getKeys(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};g.clone=function(){return new Ym(this)};
g.__iterator__=function(a){Zm(this);var b=0,c=this.version_,d=this,e=new Ul;e.next=function(){if(c!=d.version_)throw Error("The map has changed since the iterator was created");if(b>=d.keys_.length)throw Tl;var e=d.keys_[b++];return a?e:d.map_[e]};return e};var $m=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var bn=function(a){if(a.getCount&&"function"==typeof a.getCount)a=a.getCount();else if(wa(a)||r(a))a=a.length;else{var b=0,c;for(c in a)b++;a=b}return a},cn=function(a){if(a.getValues&&"function"==typeof a.getValues)return a.getValues();if(r(a))return a.split("");if(wa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return ck(a)},dn=function(a){if(a.getKeys&&"function"==typeof a.getKeys)return a.getKeys();if(!a.getValues||"function"!=typeof a.getValues){if(wa(a)||r(a)){var b=[];a=a.length;
for(var c=0;c<a;c++)b.push(c);return b}return dk(a)}},en=function(a,b,c){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,c);else if(wa(a)||r(a))Nj(a,b,c);else for(var d=dn(a),e=cn(a),f=e.length,h=0;h<f;h++)b.call(c,e[h],d&&d[h],a)},fn=function(a,b){if("function"==typeof a.every)return a.every(b,void 0);if(wa(a)||r(a))return Pj(a,b,void 0);for(var c=dn(a),d=cn(a),e=d.length,f=0;f<e;f++)if(!b.call(void 0,d[f],c&&c[f],a))return!1;return!0};var gn=function(a){this.map_=new Ym;a&&this.addAll(a)},hn=function(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+(a[za]||(a[za]=++Aa)):b.substr(0,1)+a};g=gn.prototype;g.getCount=function(){return this.map_.getCount()};g.add=function(a){this.map_.set(hn(a),a)};g.addAll=function(a){a=cn(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};g.removeAll=function(a){a=cn(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};g.remove=function(a){return this.map_.remove(hn(a))};g.clear=function(){this.map_.clear()};
g.isEmpty=function(){return this.map_.isEmpty()};g.contains=function(a){return this.map_.containsKey(hn(a))};g.getValues=function(){return this.map_.getValues()};g.clone=function(){return new gn(this)};g.equals=function(a){return this.getCount()==bn(a)&&jn(this,a)};
var jn=function(a,b){var c=bn(b);if(a.getCount()>c)return!1;!(b instanceof gn)&&5<c&&(b=new gn(b));return fn(a,function(a){var c=b;if(c.contains&&"function"==typeof c.contains)a=c.contains(a);else if(c.containsValue&&"function"==typeof c.containsValue)a=c.containsValue(a);else if(wa(c)||r(c))a=0<=Lj(c,a);else a:{for(var d in c)if(c[d]==a){a=!0;break a}a=!1}return a})};gn.prototype.__iterator__=function(){return this.map_.__iterator__(!1)};var kn=function(a){this.maxPoolSizeConfigured_=a||10;this.maxSize_=q.chrome&&q.chrome.loadTimes&&q.chrome.loadTimes()&&q.chrome.loadTimes().wasFetchedViaSpdy?this.maxPoolSizeConfigured_:1;this.requestPool_=null;1<this.maxSize_&&(this.requestPool_=new gn);this.request_=null;this.pendingMessages_=[]},mn=function(a,b){a.requestPool_||-1==b.indexOf("spdy")&&-1==b.indexOf("quic")&&-1==b.indexOf("h2")||(a.maxSize_=a.maxPoolSizeConfigured_,a.requestPool_=new gn,a.request_&&(ln(a,a.request_),a.request_=null))},
nn=function(a){return a.request_?!0:a.requestPool_?a.requestPool_.getCount()>=a.maxSize_:!1},on=function(a,b){return a.request_?a.request_==b:a.requestPool_?a.requestPool_.contains(b):!1},ln=function(a,b){a.requestPool_?a.requestPool_.add(b):a.request_=b};
kn.prototype.cancel=function(){this.pendingMessages_=this.getPendingMessages();this.request_?(this.request_.cancel(),this.request_=null):this.requestPool_&&!this.requestPool_.isEmpty()&&(Nj(this.requestPool_.getValues(),function(a){a.cancel()}),this.requestPool_.clear())};
kn.prototype.getPendingMessages=function(){if(null!=this.request_)return this.pendingMessages_.concat(this.request_.getPendingMessages());if(null!=this.requestPool_&&!this.requestPool_.isEmpty()){var a=this.pendingMessages_;Nj(this.requestPool_.getValues(),function(b){a=a.concat(b.getPendingMessages())});return a}return Wj(this.pendingMessages_)};var pn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/,qn=function(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}};var rn=function(a,b){this.domain_=this.userInfo_=this.scheme_="";this.port_=null;this.fragment_=this.path_="";this.ignoreCase_=this.isReadOnly_=!1;if(a instanceof rn){this.ignoreCase_=ra(b)?b:a.ignoreCase_;sn(this,a.scheme_);var c=a.userInfo_;tn(this);this.userInfo_=c;un(this,a.domain_);vn(this,a.port_);wn(this,a.path_);xn(this,a.getQueryData().clone());a=a.fragment_;tn(this);this.fragment_=a}else a&&(c=String(a).match(pn))?(this.ignoreCase_=!!b,sn(this,c[1]||"",!0),a=c[2]||"",tn(this),this.userInfo_=
yn(a),un(this,c[3]||"",!0),vn(this,c[4]),wn(this,c[5]||"",!0),xn(this,c[6]||"",!0),a=c[7]||"",tn(this),this.fragment_=yn(a)):(this.ignoreCase_=!!b,this.queryData_=new zn(null,0,this.ignoreCase_))};
rn.prototype.toString=function(){var a=[],b=this.scheme_;b&&a.push(An(b,Bn,!0),":");var c=this.domain_;if(c||"file"==b)a.push("//"),(b=this.userInfo_)&&a.push(An(b,Bn,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.port_,null!=c&&a.push(":",String(c));if(c=this.path_)this.domain_&&"/"!=c.charAt(0)&&a.push("/"),a.push(An(c,"/"==c.charAt(0)?Cn:Dn,!0));(c=this.queryData_.toString())&&a.push("?",c);(c=this.fragment_)&&a.push("#",An(c,En));return a.join("")};
rn.prototype.resolve=function(a){var b=this.clone(),c=!!a.scheme_;c?sn(b,a.scheme_):c=!!a.userInfo_;if(c){var d=a.userInfo_;tn(b);b.userInfo_=d}else c=!!a.domain_;c?un(b,a.domain_):c=null!=a.port_;d=a.path_;if(c)vn(b,a.port_);else if(c=!!a.path_){if("/"!=d.charAt(0))if(this.domain_&&!this.path_)d="/"+d;else{var e=b.path_.lastIndexOf("/");-1!=e&&(d=b.path_.substr(0,e+1)+d)}e=d;if(".."==e||"."==e)d="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){d=0==e.lastIndexOf("/",0);e=e.split("/");for(var f=
[],h=0;h<e.length;){var l=e[h++];"."==l?d&&h==e.length&&f.push(""):".."==l?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),d&&h==e.length&&f.push("")):(f.push(l),d=!0)}d=f.join("/")}else d=e}c?wn(b,d):c=""!==a.queryData_.toString();c?xn(b,a.getQueryData().clone()):c=!!a.fragment_;c&&(a=a.fragment_,tn(b),b.fragment_=a);return b};rn.prototype.clone=function(){return new rn(this)};
var sn=function(a,b,c){tn(a);a.scheme_=c?yn(b,!0):b;a.scheme_&&(a.scheme_=a.scheme_.replace(/:$/,""))},un=function(a,b,c){tn(a);a.domain_=c?yn(b,!0):b},vn=function(a,b){tn(a);if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.port_=b}else a.port_=null},wn=function(a,b,c){tn(a);a.path_=c?yn(b,!0):b},xn=function(a,b,c){tn(a);b instanceof zn?(a.queryData_=b,a.queryData_.setIgnoreCase(a.ignoreCase_)):(c||(b=An(b,Fn)),a.queryData_=new zn(b,0,a.ignoreCase_))};
rn.prototype.getQueryData=function(){return this.queryData_};var X=function(a,b,c){tn(a);a.queryData_.set(b,c)},Em=function(a,b,c){tn(a);va(c)||(c=[String(c)]);Gn(a.queryData_,b,c)},zm=function(a){tn(a);X(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ea()).toString(36));return a};rn.prototype.removeParameter=function(a){tn(this);this.queryData_.remove(a);return this};
var tn=function(a){if(a.isReadOnly_)throw Error("Tried to modify a read-only Uri");};rn.prototype.setIgnoreCase=function(a){this.ignoreCase_=a;this.queryData_&&this.queryData_.setIgnoreCase(a);return this};
var Hn=function(a){return a instanceof rn?a.clone():new rn(a,void 0)},In=function(a,b,c,d){var e=new rn(null,void 0);a&&sn(e,a);b&&un(e,b);c&&vn(e,c);d&&wn(e,d);return e},yn=function(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""},An=function(a,b,c){return r(a)?(a=encodeURI(a).replace(b,Jn),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null},Jn=function(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)},Bn=/[#\/\?@]/g,Dn=/[\#\?:]/g,Cn=/[\#\?]/g,
Fn=/[\#\?@]/g,En=/#/g,zn=function(a,b,c){this.count_=this.keyMap_=null;this.encodedQuery_=a||null;this.ignoreCase_=!!c},Kn=function(a){a.keyMap_||(a.keyMap_=new Ym,a.count_=0,a.encodedQuery_&&qn(a.encodedQuery_,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))};g=zn.prototype;g.getCount=function(){Kn(this);return this.count_};
g.add=function(a,b){Kn(this);this.encodedQuery_=null;a=Ln(this,a);var c=this.keyMap_.get(a);c||this.keyMap_.set(a,c=[]);c.push(b);this.count_=Kj(this.count_)+1;return this};g.remove=function(a){Kn(this);a=Ln(this,a);return this.keyMap_.containsKey(a)?(this.encodedQuery_=null,this.count_=Kj(this.count_)-this.keyMap_.get(a).length,this.keyMap_.remove(a)):!1};g.clear=function(){this.keyMap_=this.encodedQuery_=null;this.count_=0};g.isEmpty=function(){Kn(this);return 0==this.count_};
g.containsKey=function(a){Kn(this);a=Ln(this,a);return this.keyMap_.containsKey(a)};g.containsValue=function(a){var b=this.getValues();return 0<=Lj(b,a)};g.forEach=function(a,b){Kn(this);this.keyMap_.forEach(function(c,d){Nj(c,function(c){a.call(b,c,d,this)},this)},this)};g.getKeys=function(){Kn(this);for(var a=this.keyMap_.getValues(),b=this.keyMap_.getKeys(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
g.getValues=function(a){Kn(this);var b=[];if(r(a))this.containsKey(a)&&(b=Vj(b,this.keyMap_.get(Ln(this,a))));else{a=this.keyMap_.getValues();for(var c=0;c<a.length;c++)b=Vj(b,a[c])}return b};g.set=function(a,b){Kn(this);this.encodedQuery_=null;a=Ln(this,a);this.containsKey(a)&&(this.count_=Kj(this.count_)-this.keyMap_.get(a).length);this.keyMap_.set(a,[b]);this.count_=Kj(this.count_)+1;return this};g.get=function(a,b){a=a?this.getValues(a):[];return 0<a.length?String(a[0]):b};
var Gn=function(a,b,c){a.remove(b);0<c.length&&(a.encodedQuery_=null,a.keyMap_.set(Ln(a,b),Wj(c)),a.count_=Kj(a.count_)+c.length)};zn.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=this.keyMap_.getKeys(),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.getValues(d);for(var f=0;f<d.length;f++){var h=e;""!==d[f]&&(h+="="+encodeURIComponent(String(d[f])));a.push(h)}}return this.encodedQuery_=a.join("&")};
zn.prototype.clone=function(){var a=new zn;a.encodedQuery_=this.encodedQuery_;this.keyMap_&&(a.keyMap_=this.keyMap_.clone(),a.count_=this.count_);return a};var Ln=function(a,b){b=String(b);a.ignoreCase_&&(b=b.toLowerCase());return b};zn.prototype.setIgnoreCase=function(a){a&&!this.ignoreCase_&&(Kn(this),this.encodedQuery_=null,this.keyMap_.forEach(function(a,c){var b=c.toLowerCase();c!=b&&(this.remove(c),Gn(this,b,a))},this));this.ignoreCase_=a};
zn.prototype.extend=function(a){for(var b=0;b<arguments.length;b++)en(arguments[b],function(a,b){this.add(b,a)},this)};var Nn=function(a,b){var c=new lm;c.debug("TestLoadImage: loading "+a);var d=new Image;d.onload=Da(Mn,c,d,"TestLoadImage: loaded",!0,b);d.onerror=Da(Mn,c,d,"TestLoadImage: error",!1,b);d.onabort=Da(Mn,c,d,"TestLoadImage: abort",!1,b);d.ontimeout=Da(Mn,c,d,"TestLoadImage: timeout",!1,b);q.setTimeout(function(){if(d.ontimeout)d.ontimeout()},1E4);d.src=a},Mn=function(a,b,c,d,e){try{a.debug(c),b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,e(d)}catch(f){om(a,f)}};var On=function(){this.parser_=new cm},Pn=function(a,b,c){var d=c||"";try{en(a,function(a,c){var e=a;ya(a)&&(e=Zl(a));b.push(d+c+"="+encodeURIComponent(e))})}catch(e){throw b.push(d+"type="+encodeURIComponent("_badmap")),e;}},Um=function(a,b){a=a.parser_.parse(b);S(va(a));return a};var Qn=function(a){var b="";ak(a,function(a,d){b+=d;b+=":";b+=a;b+="\r\n"});return b},Rn=function(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}if(d)return a;c=Qn(c);if(r(a)){b=encodeURIComponent(String(b));c=null!=c?"="+encodeURIComponent(String(c)):"";if(b+=c){c=a.indexOf("#");0>c&&(c=a.length);d=a.indexOf("?");if(0>d||d>c){d=c;var e=""}else e=a.substring(d+1,c);a=[a.substr(0,d),e,a.substr(c)];c=a[1];a[1]=b?c?c+"&"+b:b:c;a=a[0]+(a[1]?"?"+a[1]:"")+a[2]}return a}X(a,b,c);return a};var Y=function(a){sl.call(this);this.headers=new Ym;this.xmlHttpFactory_=a||null;this.active_=!1;this.xhrOptions_=this.xhr_=null;this.lastMethod_=this.lastUri_="";this.lastErrorCode_=0;this.lastError_="";this.inAbort_=this.inOpen_=this.inSend_=this.errorDispatched_=!1;this.timeoutInterval_=0;this.timeoutId_=null;this.responseType_="";this.useXhr2Timeout_=this.progressEventsEnabled_=this.withCredentials_=!1};u(Y,sl);Y.prototype.logger_=Ll("goog.net.XhrIo");var Sn=/^https?$/i,Tn=["POST","PUT"];
Y.prototype.send=function(a,b,c,d){if(this.xhr_)throw Error("[goog.net.XhrIo] Object is active with another request="+this.lastUri_+"; newUri="+a);b=b?b.toUpperCase():"GET";this.lastUri_=a;this.lastError_="";this.lastErrorCode_=0;this.lastMethod_=b;this.errorDispatched_=!1;this.active_=!0;this.xhr_=this.xmlHttpFactory_?um(this.xmlHttpFactory_):um(sm);this.xhrOptions_=this.xmlHttpFactory_?rm(this.xmlHttpFactory_):rm(sm);this.xhr_.onreadystatechange=t(this.onReadyStateChange_,this);this.progressEventsEnabled_&&
"onprogress"in this.xhr_&&(this.xhr_.onprogress=t(function(a){this.onProgressHandler_(a,!0)},this),this.xhr_.upload&&(this.xhr_.upload.onprogress=t(this.onProgressHandler_,this)));try{km(this.logger_,Un(this,"Opening Xhr")),this.inOpen_=!0,this.xhr_.open(b,String(a),!0),this.inOpen_=!1}catch(f){km(this.logger_,Un(this,"Error opening Xhr: "+f.message));Vn(this,f);return}a=c||"";var e=this.headers.clone();d&&en(d,function(a,b){e.set(b,a)});d=Rj(e.getKeys());c=q.FormData&&a instanceof q.FormData;!(0<=
Lj(Tn,b))||d||c||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");e.forEach(function(a,b){this.xhr_.setRequestHeader(b,a)},this);this.responseType_&&(this.xhr_.responseType=this.responseType_);"withCredentials"in this.xhr_&&this.xhr_.withCredentials!==this.withCredentials_&&(this.xhr_.withCredentials=this.withCredentials_);try{Wn(this),0<this.timeoutInterval_&&(this.useXhr2Timeout_=Xn(this.xhr_),km(this.logger_,Un(this,"Will abort after "+this.timeoutInterval_+"ms if incomplete, xhr2 "+
this.useXhr2Timeout_)),this.useXhr2Timeout_?(this.xhr_.timeout=this.timeoutInterval_,this.xhr_.ontimeout=t(this.timeout_,this)):this.timeoutId_=wl(this.timeout_,this.timeoutInterval_,this)),km(this.logger_,Un(this,"Sending request")),this.inSend_=!0,this.xhr_.send(a),this.inSend_=!1}catch(f){km(this.logger_,Un(this,"Send error: "+f.message)),Vn(this,f)}};var Xn=function(a){return mk&&xk(9)&&sa(a.timeout)&&ra(a.ontimeout)},Qj=function(a){return"content-type"==a.toLowerCase()};
Y.prototype.timeout_=function(){"undefined"!=typeof qa&&this.xhr_&&(this.lastError_="Timed out after "+this.timeoutInterval_+"ms, aborting",this.lastErrorCode_=8,km(this.logger_,Un(this,this.lastError_)),this.dispatchEvent("timeout"),this.abort(8))};var Vn=function(a,b){a.active_=!1;a.xhr_&&(a.inAbort_=!0,a.xhr_.abort(),a.inAbort_=!1);a.lastError_=b;a.lastErrorCode_=5;Yn(a);Zn(a)},Yn=function(a){a.errorDispatched_||(a.errorDispatched_=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))};
Y.prototype.abort=function(a){this.xhr_&&this.active_&&(km(this.logger_,Un(this,"Aborting")),this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1,this.lastErrorCode_=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Zn(this))};Y.prototype.disposeInternal=function(){this.xhr_&&(this.active_&&(this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1),Zn(this,!0));Y.superClass_.disposeInternal.call(this)};
Y.prototype.onReadyStateChange_=function(){if(!this.disposed_)if(this.inOpen_||this.inSend_||this.inAbort_)$n(this);else this.onReadyStateChangeEntryPoint_()};Y.prototype.onReadyStateChangeEntryPoint_=function(){$n(this)};
var $n=function(a){if(a.active_&&"undefined"!=typeof qa)if(a.xhrOptions_[1]&&4==Fm(a)&&2==Im(a))km(a.logger_,Un(a,"Local request error detected and ignored"));else if(a.inSend_&&4==Fm(a))wl(a.onReadyStateChange_,0,a);else if(a.dispatchEvent("readystatechange"),4==Fm(a)){km(a.logger_,Un(a,"Request complete"));a.active_=!1;try{var b=Im(a);a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break a;default:c=!1}var d;if(!(d=c)){var e;if(e=0===b){var f=String(a.lastUri_).match(pn)[1]||
null;if(!f&&q.self&&q.self.location){var h=q.self.location.protocol;f=h.substr(0,h.length-1)}e=!Sn.test(f?f.toLowerCase():"")}d=e}d?(a.dispatchEvent("complete"),a.dispatchEvent("success")):(a.lastErrorCode_=6,a.lastError_=ao(a)+" ["+Im(a)+"]",Yn(a))}finally{Zn(a)}}};Y.prototype.onProgressHandler_=function(a,b){S("progress"===a.type,"goog.net.EventType.PROGRESS is of the same type as raw XHR progress.");this.dispatchEvent(bo(a,"progress"));this.dispatchEvent(bo(a,b?"downloadprogress":"uploadprogress"))};
var bo=function(a,b){return{type:b,lengthComputable:a.lengthComputable,loaded:a.loaded,total:a.total}},Zn=function(a,b){if(a.xhr_){Wn(a);var c=a.xhr_,d=a.xhrOptions_[0]?ta:null;a.xhr_=null;a.xhrOptions_=null;b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(a=a.logger_)&&a.severe("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}},Wn=function(a){a.xhr_&&a.useXhr2Timeout_&&(a.xhr_.ontimeout=null);sa(a.timeoutId_)&&(q.clearTimeout(a.timeoutId_),a.timeoutId_=null)};
Y.prototype.isActive=function(){return!!this.xhr_};var Fm=function(a){return a.xhr_?a.xhr_.readyState:0},Im=function(a){try{return 2<Fm(a)?a.xhr_.status:-1}catch(b){return-1}},ao=function(a){try{return 2<Fm(a)?a.xhr_.statusText:""}catch(b){return km(a.logger_,"Can not get status: "+b.message),""}},Gm=function(a){try{return a.xhr_?a.xhr_.responseText:""}catch(b){return km(a.logger_,"Can not get responseText: "+b.message),""}};
Y.prototype.getResponseHeader=function(a){if(this.xhr_&&4==Fm(this))return a=this.xhr_.getResponseHeader(a),null===a?void 0:a};Y.prototype.getAllResponseHeaders=function(){return this.xhr_&&4==Fm(this)?this.xhr_.getAllResponseHeaders():""};Y.prototype.getLastError=function(){return r(this.lastError_)?this.lastError_:String(this.lastError_)};var Un=function(a,b){return b+" ["+a.lastMethod_+" "+a.lastUri_+" "+Im(a)+"]"};var Z=function(a,b,c){this.clientVersion_=b||0;this.serverVersion_=0;this.outgoingMaps_=[];this.channelDebug_=new lm;this.connState_=c||new Wm;this.hostPrefix_=this.backChannelUri_=this.forwardChannelUri_=this.path_=this.backChannelRequest_=this.httpSessionId_=this.httpSessionIdParam_=this.extraParams_=this.httpHeadersOverwriteParam_=this.initHeaders_=this.extraHeaders_=null;this.allowHostPrefix_=!0;this.nextMapId_=this.nextRid_=0;this.failFast_=!1;this.useChunked_=this.connectionTest_=this.deadBackChannelTimerId_=
this.backChannelTimerId_=this.forwardChannelTimerId_=this.handler_=null;this.allowChunkedMode_=!0;this.lastStatusCode_=this.lastPostResponseArrayId_=this.lastArrayId_=-1;this.backChannelAttemptId_=this.backChannelRetryCount_=this.forwardChannelRetryCount_=0;this.baseRetryDelayMs_=5E3;this.retryDelaySeedMs_=1E4;this.forwardChannelMaxRetries_=2;this.forwardChannelRequestTimeoutMs_=2E4;this.readyStateChangeThrottleMs_=0;this.supportsCrossDomainXhrs_=a&&a.supportsCrossDomainXhr||!1;this.sid_="";this.forwardChannelRequestPool_=
new kn(a&&a.concurrentRequestLimit);this.wireCodec_=new On;this.backgroundChannelTest_=a&&ra(a.backgroundChannelTest)?a.backgroundChannelTest:!0;this.fastHandshake_=a&&a.fastHandshake||!1};Z.prototype.channelVersion_=8;Z.prototype.state_=1;
Z.prototype.connect=function(a,b,c,d,e){this.channelDebug_.debug("connect()");V(0);this.path_=b;this.extraParams_=c||{};d&&ra(e)&&(this.extraParams_.OSID=d,this.extraParams_.OAID=e);this.backgroundChannelTest_&&(this.channelDebug_.debug("connect() bypassed channel-test."),this.connState_.handshakeResult=[],this.connState_.bufferingProxyResult=!1);this.channelDebug_.debug("connectTest_()");this.connectionTest_=new Pm(this,this.channelDebug_);null===this.httpHeadersOverwriteParam_&&this.connectionTest_.setExtraHeaders(this.extraHeaders_);
b=a;this.httpHeadersOverwriteParam_&&this.extraHeaders_&&(b=Rn(a,this.httpHeadersOverwriteParam_,this.extraHeaders_));this.connectionTest_.connect(b)};
Z.prototype.disconnect=function(){this.channelDebug_.debug("disconnect()");co(this);if(3==this.state_){var a=this.nextRid_++,b=this.forwardChannelUri_.clone();X(b,"SID",this.sid_);X(b,"RID",a);X(b,"TYPE","terminate");eo(this,b);a=new W(this,this.channelDebug_,this.sid_,a,void 0);a.type_=2;a.baseUri_=zm(b.clone());b=!1;q.navigator&&q.navigator.sendBeacon&&(b=q.navigator.sendBeacon(a.baseUri_.toString(),""));b||((new Image).src=a.baseUri_);a.requestStartTime_=Ea();Dm(a)}fo(this)};
var co=function(a){a.connectionTest_&&(a.connectionTest_.abort(),a.connectionTest_=null);a.backChannelRequest_&&(a.backChannelRequest_.cancel(),a.backChannelRequest_=null);a.backChannelTimerId_&&(q.clearTimeout(a.backChannelTimerId_),a.backChannelTimerId_=null);go(a);a.forwardChannelRequestPool_.cancel();a.forwardChannelTimerId_&&(q.clearTimeout(a.forwardChannelTimerId_),a.forwardChannelTimerId_=null)};Z.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};
Z.prototype.setReadyStateChangeThrottle=function(a){this.readyStateChangeThrottleMs_=a};var io=function(a,b){S(0!=a.state_,"Invalid operation: sending map when state is closed");1E3==a.outgoingMaps_.length&&a.channelDebug_.severe("Already have 1000 queued maps upon queueing "+Zl(b));a.outgoingMaps_.push(new Xm(a.nextMapId_++,b));3==a.state_&&ho(a)};Z.prototype.isClosed=function(){return 0==this.state_};Z.prototype.getState=function(){return this.state_};
var ho=function(a){nn(a.forwardChannelRequestPool_)||a.forwardChannelTimerId_||(a.forwardChannelTimerId_=im(t(a.onStartForwardChannelTimer_,a),0),a.forwardChannelRetryCount_=0)};
Z.prototype.onStartForwardChannelTimer_=function(a){this.forwardChannelTimerId_=null;this.channelDebug_.debug("startForwardChannel_");if(1==this.state_)if(a)this.channelDebug_.severe("Not supposed to retry the open");else{this.channelDebug_.debug("open_()");this.nextRid_=Math.floor(1E5*Math.random());a=this.nextRid_++;var b=new W(this,this.channelDebug_,"",a,void 0),c=this.extraHeaders_;this.initHeaders_&&(c?(c=ek(c),gk(c,this.initHeaders_)):c=this.initHeaders_);null===this.httpHeadersOverwriteParam_&&
b.setExtraHeaders(c);var d=jo(this,b),e=this.forwardChannelUri_.clone();X(e,"RID",a);0<this.clientVersion_&&X(e,"CVER",this.clientVersion_);this.backgroundChannelTest_&&this.httpSessionIdParam_&&X(e,"X-HTTP-Session-Id",this.httpSessionIdParam_);eo(this,e);this.httpHeadersOverwriteParam_&&c&&Rn(e,this.httpHeadersOverwriteParam_,c);ln(this.forwardChannelRequestPool_,b);this.fastHandshake_?(X(e,"$req",d),Bm(b,e,null)):Bm(b,e,d);this.state_=2}else 3==this.state_&&(a?ko(this,a):0==this.outgoingMaps_.length?
this.channelDebug_.debug("startForwardChannel_ returned: nothing to send"):nn(this.forwardChannelRequestPool_)?this.channelDebug_.severe("startForwardChannel_ returned: connection already in progress"):(ko(this),this.channelDebug_.debug("startForwardChannel_ finished, sent request")))};
var ko=function(a,b){var c=b?b.rid_:a.nextRid_++;var d=a.forwardChannelUri_.clone();X(d,"SID",a.sid_);X(d,"RID",c);X(d,"AID",a.lastArrayId_);eo(a,d);a.httpHeadersOverwriteParam_&&a.extraHeaders_&&Rn(d,a.httpHeadersOverwriteParam_,a.extraHeaders_);c=new W(a,a.channelDebug_,a.sid_,c,a.forwardChannelRetryCount_+1);null===a.httpHeadersOverwriteParam_&&c.setExtraHeaders(a.extraHeaders_);b&&(a.outgoingMaps_=b.getPendingMessages().concat(a.outgoingMaps_));b=jo(a,c);c.setTimeout(Math.round(.5*a.forwardChannelRequestTimeoutMs_)+
Math.round(.5*a.forwardChannelRequestTimeoutMs_*Math.random()));ln(a.forwardChannelRequestPool_,c);Bm(c,d,b)},eo=function(a,b){a.handler_&&en({},function(a,d){X(b,d,a)})},jo=function(a,b){var c=Math.min(a.outgoingMaps_.length,1E3),d=a.handler_?t(a.handler_.badMapError,a.handler_,a):null,e=a.outgoingMaps_,f=["count="+c];if(0<c){var h=e[0].mapId;f.push("ofs="+h)}else h=0;for(var l=0;l<c;l++){var p=e[l].mapId,w=e[l].map;p-=h;try{Pn(w,f,"req"+p+"_")}catch(B){d&&d(w)}}d=f.join("&");a=a.outgoingMaps_.splice(0,
c);b.pendingMessages_=a;return d},lo=function(a){if(!a.backChannelRequest_&&!a.backChannelTimerId_){a.backChannelAttemptId_=1;var b=a.onStartBackChannelTimer_;nl||pl();ql||(nl(),ql=!0);rl.add(b,a);a.backChannelRetryCount_=0}},no=function(a){if(a.backChannelRequest_||a.backChannelTimerId_)return a.channelDebug_.severe("Request already in progress"),!1;if(3<=a.backChannelRetryCount_)return!1;a.channelDebug_.debug("Going to retry GET");a.backChannelAttemptId_++;a.backChannelTimerId_=im(t(a.onStartBackChannelTimer_,
a),mo(a,a.backChannelRetryCount_));a.backChannelRetryCount_++;return!0};
Z.prototype.onStartBackChannelTimer_=function(){this.backChannelTimerId_=null;this.channelDebug_.debug("Creating new HttpRequest");this.backChannelRequest_=new W(this,this.channelDebug_,this.sid_,"rpc",this.backChannelAttemptId_);null===this.httpHeadersOverwriteParam_&&this.backChannelRequest_.setExtraHeaders(this.extraHeaders_);this.backChannelRequest_.setReadyStateChangeThrottle(this.readyStateChangeThrottleMs_);var a=this.backChannelUri_.clone();X(a,"RID","rpc");X(a,"SID",this.sid_);X(a,"CI",this.useChunked_?
"0":"1");X(a,"AID",this.lastArrayId_);eo(this,a);X(a,"TYPE","xmlhttp");this.httpHeadersOverwriteParam_&&this.extraHeaders_&&Rn(a,this.httpHeadersOverwriteParam_,this.extraHeaders_);Cm(this.backChannelRequest_,a,!0,this.hostPrefix_);this.channelDebug_.debug("New Request created")};
var Sm=function(a,b,c){a.channelDebug_.debug("Test Connection Finished");var d=b.clientProtocol_;d&&mn(a.forwardChannelRequestPool_,d);a.useChunked_=a.allowChunkedMode_&&c;a.lastStatusCode_=b.lastStatusCode_;a.channelDebug_.debug("connectChannel_()");a.ensureInState_(1,0);a.forwardChannelUri_=Qm(a,a.path_);ho(a)},Vm=function(a,b){a.channelDebug_.debug("Test Connection Failed");a.lastStatusCode_=b.lastStatusCode_;oo(a,2)};
Z.prototype.onRequestData=function(a,b){if(0!=this.state_&&(this.backChannelRequest_==a||on(this.forwardChannelRequestPool_,a)))if(this.lastStatusCode_=a.lastStatusCode_,on(this.forwardChannelRequestPool_,a)&&3==this.state_){try{var c=Um(this.wireCodec_,b)}catch(h){c=null}if(va(c)&&3==c.length)if(b=c,0==b[0])a:if(this.channelDebug_.debug("Server claims our backchannel is missing."),this.backChannelTimerId_)this.channelDebug_.debug("But we are currently starting the request.");else{if(this.backChannelRequest_)if(this.backChannelRequest_.requestStartTime_+
3E3<a.requestStartTime_)go(this),this.backChannelRequest_.cancel(),this.backChannelRequest_=null;else break a;else this.channelDebug_.warning("We do not have a BackChannel established");no(this);V(18)}else this.lastPostResponseArrayId_=b[1],a=this.lastPostResponseArrayId_-this.lastArrayId_,0<a&&(b=b[2],this.channelDebug_.debug(b+" bytes (in "+a+" arrays) are outstanding on the BackChannel"),37500>b&&this.useChunked_&&0==this.backChannelRetryCount_&&!this.deadBackChannelTimerId_&&(this.deadBackChannelTimerId_=
im(t(this.onBackChannelDead_,this),6E3)));else this.channelDebug_.debug("Bad POST response data returned"),oo(this,11)}else if(this.backChannelRequest_==a&&go(this),!/^[\s\xa0]*$/.test(b)){b=c=Um(this.wireCodec_,b);c=this.handler_&&this.handler_.channelHandleMultipleArrays?[]:null;for(var d=0;d<b.length;d++){var e=b[d];this.lastArrayId_=e[0];e=e[1];if(2==this.state_)if("c"==e[0]){this.sid_=e[1];this.hostPrefix_=this.correctHostPrefix(e[2]);var f=e[3];null!=f&&(this.channelVersion_=f,this.channelDebug_.info("VER="+
this.channelVersion_));e=e[4];null!=e&&(this.serverVersion_=e,this.channelDebug_.info("SVER="+this.serverVersion_));this.applyControlHeaders_(a);this.state_=3;this.handler_&&this.handler_.channelOpened(this);this.backChannelUri_=Tm(this,this.hostPrefix_,this.path_);lo(this)}else"stop"!=e[0]&&"close"!=e[0]||oo(this,7);else 3==this.state_&&("stop"==e[0]||"close"==e[0]?(c&&0!=c.length&&(this.handler_.channelHandleMultipleArrays(this,c),c.length=0),"stop"==e[0]?oo(this,7):this.disconnect()):"noop"!=e[0]&&
(c?c.push(e):this.handler_&&this.handler_.channelHandleArray(this,e)),this.backChannelRetryCount_=0)}c&&0!=c.length&&this.handler_.channelHandleMultipleArrays(this,c)}};Z.prototype.correctHostPrefix=function(a){return this.allowHostPrefix_?this.handler_?this.handler_.correctHostPrefix(a):a:null};Z.prototype.onBackChannelDead_=function(){null!=this.deadBackChannelTimerId_&&(this.deadBackChannelTimerId_=null,this.backChannelRequest_.cancel(),this.backChannelRequest_=null,no(this),V(19))};
var go=function(a){null!=a.deadBackChannelTimerId_&&(q.clearTimeout(a.deadBackChannelTimerId_),a.deadBackChannelTimerId_=null)};
Z.prototype.onRequestComplete=function(a){this.channelDebug_.debug("Request complete");var b=null;if(this.backChannelRequest_==a){go(this);this.backChannelRequest_=null;var c=2}else if(on(this.forwardChannelRequestPool_,a)){b=a.getPendingMessages();var d=this.forwardChannelRequestPool_;d.request_&&d.request_==a?d.request_=null:d.requestPool_&&d.requestPool_.contains(a)&&d.requestPool_.remove(a);c=1}else return;this.lastStatusCode_=a.lastStatusCode_;if(0!=this.state_)if(a.successful_)1==c?(b=Ea()-
a.requestStartTime_,dm.dispatchEvent(new hm(dm,a.postData_?a.postData_.length:0,b)),ho(this)):lo(this);else{d=a.getLastError();if(3==d||0==d&&0<this.lastStatusCode_)this.channelDebug_.debug("Not retrying due to error type");else{this.channelDebug_.debug("Maybe retrying, last error: "+wm(d,this.lastStatusCode_));var e;if(e=1==c)nn(this.forwardChannelRequestPool_)||this.forwardChannelTimerId_?(this.channelDebug_.severe("Request already in progress"),e=!1):1==this.state_||2==this.state_||this.forwardChannelRetryCount_>=
(this.failFast_?0:this.forwardChannelMaxRetries_)?e=!1:(this.channelDebug_.debug("Going to retry POST"),this.forwardChannelTimerId_=im(t(this.onStartForwardChannelTimer_,this,a),mo(this,this.forwardChannelRetryCount_)),this.forwardChannelRetryCount_++,e=!0);if(e||2==c&&no(this))return;this.channelDebug_.debug("Exceeded max number of retries")}b&&0<b.length&&(a=this.forwardChannelRequestPool_,a.pendingMessages_=a.pendingMessages_.concat(b));this.channelDebug_.debug("Error: HTTP request failed");switch(d){case 1:oo(this,
5);break;case 4:oo(this,10);break;case 3:oo(this,6);break;default:oo(this,2)}}};var mo=function(a,b){var c=a.baseRetryDelayMs_+Math.floor(Math.random()*a.retryDelaySeedMs_);a.isActive()||(a.channelDebug_.debug("Inactive channel"),c*=2);return c*b};
Z.prototype.applyControlHeaders_=function(a){if(this.backgroundChannelTest_&&(a=a.xmlHttp_)){var b=a.xhr_?a.xhr_.getResponseHeader("X-Client-Wire-Protocol"):null;b&&mn(this.forwardChannelRequestPool_,b);this.httpSessionIdParam_&&((a=a.xhr_?a.xhr_.getResponseHeader("X-HTTP-Session-Id"):null)?(this.httpSessionId_=a,X(this.forwardChannelUri_,this.httpSessionIdParam_,a)):this.channelDebug_.warning("Missing X_HTTP_SESSION_ID in the handshake response"))}};
Z.prototype.ensureInState_=function(a){S(0<=Lj(arguments,this.state_),"Unexpected channel state: %s",this.state_)};var oo=function(a,b){a.channelDebug_.info("Error code "+b);if(2==b){var c=null;a.handler_&&(c=null);var d=t(a.testNetworkCallback_,a);c||(c=new rn("//www.google.com/images/cleardot.gif"),q.location&&"http"==q.location.protocol||sn(c,"https"),zm(c));Nn(c.toString(),d)}else V(2);a.channelDebug_.debug("HttpChannel: error - "+b);a.state_=0;a.handler_&&a.handler_.channelError(a,b);fo(a);co(a)};
Z.prototype.testNetworkCallback_=function(a){a?(this.channelDebug_.info("Successfully pinged google.com"),V(2)):(this.channelDebug_.info("Failed to ping google.com"),V(1))};
var fo=function(a){a.state_=0;a.lastStatusCode_=-1;if(a.handler_){var b=a.forwardChannelRequestPool_.getPendingMessages();if(0==b.length&&0==a.outgoingMaps_.length)a.handler_.channelClosed(a);else{a.channelDebug_.debug("Number of undelivered maps, pending: "+b.length+", outgoing: "+a.outgoingMaps_.length);a.forwardChannelRequestPool_.pendingMessages_.length=0;var c=Wj(a.outgoingMaps_);a.outgoingMaps_.length=0;a.handler_.channelClosed(a,b,c)}}},Qm=function(a,b){b=po(a,null,b);a.channelDebug_.debug("GetForwardChannelUri: "+
b);return b},Tm=function(a,b,c){b=po(a,a.shouldUseSecondaryDomains()?b:null,c);a.channelDebug_.debug("GetBackChannelUri: "+b);return b},po=function(a,b,c){var d=Hn(c);if(""!=d.domain_)b&&un(d,b+"."+d.domain_),vn(d,d.port_);else{var e=q.location;d=In(e.protocol,b?b+"."+e.hostname:e.hostname,e.port,c)}a.extraParams_&&ak(a.extraParams_,function(a,b){X(d,b,a)});b=a.httpSessionIdParam_;c=a.httpSessionId_;b&&c&&X(d,b,c);X(d,"VER",a.channelVersion_);eo(a,d);return d};
Z.prototype.createXhrIo=function(a){if(a&&!this.supportsCrossDomainXhrs_)throw Error("Can't create secondary domain capable XhrIo object.");a=new Y;a.withCredentials_=this.supportsCrossDomainXhrs_;return a};Z.prototype.isActive=function(){return!!this.handler_&&this.handler_.isActive(this)};Z.prototype.shouldUseSecondaryDomains=function(){return this.supportsCrossDomainXhrs_};new Pl;var qo=function(){};g=qo.prototype;g.channelHandleMultipleArrays=null;g.channelOpened=function(){};
g.channelHandleArray=function(){};g.channelError=function(){};g.channelClosed=function(){};g.isActive=function(){return!0};g.badMapError=function(){};g.correctHostPrefix=function(a){return a};var ro=function(a){for(var b=arguments[0],c=1;c<arguments.length;c++){var d=arguments[c];if(0==d.lastIndexOf("/",0))b=d;else{var e;(e=""==b)||(e=b.length-1,e=0<=e&&b.indexOf("/",e)==e);b=e?b+d:b+("/"+d)}}return b};var to=function(a,b){sl.call(this);this.channel_=new Z(b,20);this.url_=a;this.testUrl_=b&&b.testUrl?b.testUrl:ro(this.url_,"test");this.logger_=Ll("goog.labs.net.webChannel.WebChannelBaseTransport");this.messageUrlParams_=b&&b.messageUrlParams||null;a=b&&b.messageHeaders||null;b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"});this.channel_.setExtraHeaders(a);a=b&&b.initMessageHeaders||null;b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=
b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType});this.channel_.initHeaders_=a;(a=b&&b.httpHeadersOverwriteParam)&&!/^[\s\xa0]*$/.test(a)&&(this.channel_.httpHeadersOverwriteParam_=a);this.supportsCrossDomainXhr_=b&&b.supportsCrossDomainXhr||!1;this.sendRawJson_=b&&b.sendRawJson||!1;(b=b&&b.httpSessionIdParam)&&!/^[\s\xa0]*$/.test(b)&&(this.channel_.httpSessionIdParam_=b,a=this.messageUrlParams_,null!==a&&b in a&&(a=this.messageUrlParams_,b in a&&delete a[b],(a=this.logger_)&&
a.warning("Ignore httpSessionIdParam also specified with messageUrlParams: "+b,void 0)));this.channelHandler_=new so(this)};u(to,sl);to.prototype.open=function(){this.channel_.handler_=this.channelHandler_;this.supportsCrossDomainXhr_&&(this.channel_.supportsCrossDomainXhrs_=!0);this.channel_.connect(this.testUrl_,this.url_,this.messageUrlParams_||void 0)};to.prototype.close=function(){this.channel_.disconnect()};
to.prototype.send=function(a){S(ya(a)||r(a),"only object type or raw string is supported");if(r(a)){var b={};b.__data__=a;io(this.channel_,b)}else this.sendRawJson_?(b={},b.__data__=Zl(a),io(this.channel_,b)):io(this.channel_,a)};to.prototype.disposeInternal=function(){this.channel_.handler_=null;delete this.channelHandler_;this.channel_.disconnect();delete this.channel_;to.superClass_.disposeInternal.call(this)};var uo=function(a){el.call(this);this.data=a};u(uo,el);
var vo=function(a){fl.call(this);this.status=1;this.errorCode=a};u(vo,fl);var so=function(a){this.channel_=a};u(so,qo);so.prototype.channelOpened=function(){jm(this.channel_.logger_,"WebChannel opened on "+this.channel_.url_);this.channel_.dispatchEvent("a")};so.prototype.channelHandleArray=function(a,b){S(b,"array expected to be defined");this.channel_.dispatchEvent(new uo(b))};
so.prototype.channelError=function(a,b){jm(this.channel_.logger_,"WebChannel aborted on "+this.channel_.url_+" due to channel error: "+b);this.channel_.dispatchEvent(new vo(b))};so.prototype.channelClosed=function(){jm(this.channel_.logger_,"WebChannel closed on "+this.channel_.url_);this.channel_.dispatchEvent("b")};var wo=Da(function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c},function(){if(mk&&!(10<=Number(yk)))throw Error("Environmental error: no available transport.");});var xo=function(){this.front_=[];this.back_=[]};g=xo.prototype;g.enqueue=function(a){this.back_.push(a)};g.dequeue=function(){0==this.front_.length&&(this.front_=this.back_,this.front_.reverse(),this.back_=[]);return this.front_.pop()};g.getCount=function(){return this.front_.length+this.back_.length};g.isEmpty=function(){return 0==this.front_.length&&0==this.back_.length};g.clear=function(){this.front_=[];this.back_=[]};g.contains=function(a){return 0<=Lj(this.front_,a)||0<=Lj(this.back_,a)};
g.remove=function(a){var b=this.front_;var c=Mj(b,a);0<=c?(Tj(b,c),b=!0):b=!1;return b||Uj(this.back_,a)};g.getValues=function(){for(var a=[],b=this.front_.length-1;0<=b;--b)a.push(this.front_[b]);var c=this.back_.length;for(b=0;b<c;++b)a.push(this.back_[b]);return a};var yo=function(a,b){Bk.call(this);this.minCount_=a||0;this.maxCount_=b||10;if(this.minCount_>this.maxCount_)throw Error("[goog.structs.Pool] Min can not be greater than max");this.freeQueue_=new xo;this.inUseSet_=new gn;this.delay=0;this.lastAccess=null;this.adjustForMinMax()};u(yo,Bk);
yo.prototype.getObject=function(){var a=Ea();if(!(null!=this.lastAccess&&a-this.lastAccess<this.delay)){for(var b;0<this.freeQueue_.getCount()&&(b=this.freeQueue_.dequeue(),!this.objectCanBeReused(b));)this.adjustForMinMax();!b&&this.getCount()<this.maxCount_&&(b=this.createObject());b&&(this.lastAccess=a,this.inUseSet_.add(b));return b}};yo.prototype.addFreeObject=function(a){this.inUseSet_.remove(a);this.objectCanBeReused(a)&&this.getCount()<this.maxCount_?this.freeQueue_.enqueue(a):zo(a)};
yo.prototype.adjustForMinMax=function(){for(var a=this.freeQueue_;this.getCount()<this.minCount_;)a.enqueue(this.createObject());for(;this.getCount()>this.maxCount_&&0<this.freeQueue_.getCount();)zo(a.dequeue())};yo.prototype.createObject=function(){return{}};var zo=function(a){if("function"==typeof a.dispose)a.dispose();else for(var b in a)a[b]=null};g=yo.prototype;g.objectCanBeReused=function(a){return"function"==typeof a.canBeReused?a.canBeReused():!0};
g.contains=function(a){return this.freeQueue_.contains(a)||this.inUseSet_.contains(a)};g.getCount=function(){return this.freeQueue_.getCount()+this.inUseSet_.getCount()};g.isEmpty=function(){return this.freeQueue_.isEmpty()&&this.inUseSet_.isEmpty()};g.disposeInternal=function(){yo.superClass_.disposeInternal.call(this);if(0<this.inUseSet_.getCount())throw Error("[goog.structs.Pool] Objects not released");delete this.inUseSet_;for(var a=this.freeQueue_;!a.isEmpty();)zo(a.dequeue());delete this.freeQueue_};var Ao=function(a,b){this.key_=a;this.value_=b};Ao.prototype.getKey=function(){return this.key_};Ao.prototype.clone=function(){return new Ao(this.key_,this.value_)};var Bo=function(a){this.nodes_=[];if(a)a:{if(a instanceof Bo){var b=a.getKeys();a=a.getValues();if(0>=this.getCount()){for(var c=this.nodes_,d=0;d<b.length;d++)c.push(new Ao(b[d],a[d]));break a}}else b=dk(a),a=ck(a);for(d=0;d<b.length;d++)this.insert(b[d],a[d])}};g=Bo.prototype;g.insert=function(a,b){var c=this.nodes_;c.push(new Ao(a,b));a=c.length-1;b=this.nodes_;for(c=b[a];0<a;){var d=a-1>>1;if(b[d].getKey()>c.getKey())b[a]=b[d],a=d;else break}b[a]=c};
g.remove=function(){var a=this.nodes_,b=a.length,c=a[0];if(!(0>=b)){if(1==b)Sj(a);else{a[0]=a.pop();a=0;b=this.nodes_;for(var d=b.length,e=b[a];a<d>>1;){var f=2*a+1,h=2*a+2;f=h<d&&b[h].getKey()<b[f].getKey()?h:f;if(b[f].getKey()>e.getKey())break;b[a]=b[f];a=f}b[a]=e}return c.value_}};g.getValues=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].value_);return b};g.getKeys=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].getKey());return b};
g.containsValue=function(a){return Oj(this.nodes_,function(b){return b.value_==a})};g.containsKey=function(a){return Oj(this.nodes_,function(b){return b.getKey()==a})};g.clone=function(){return new Bo(this)};g.getCount=function(){return this.nodes_.length};g.isEmpty=function(){return 0==this.nodes_.length};g.clear=function(){Sj(this.nodes_)};var Co=function(){Bo.call(this)};u(Co,Bo);Co.prototype.enqueue=function(a,b){this.insert(a,b)};Co.prototype.dequeue=function(){return this.remove()};var Do=function(a,b){this.delayTimeout_=void 0;this.requestQueue_=new Co;yo.call(this,a,b)};u(Do,yo);g=Do.prototype;g.getObject=function(a,b){if(!a)return(a=Do.superClass_.getObject.call(this))&&this.delay&&(this.delayTimeout_=q.setTimeout(t(this.handleQueueRequests_,this),this.delay)),a;this.requestQueue_.enqueue(ra(b)?b:100,a);this.handleQueueRequests_()};g.handleQueueRequests_=function(){for(var a=this.requestQueue_;0<a.getCount();){var b=this.getObject();if(b)a.dequeue().apply(this,[b]);else break}};
g.addFreeObject=function(a){Do.superClass_.addFreeObject.call(this,a);this.handleQueueRequests_()};g.adjustForMinMax=function(){Do.superClass_.adjustForMinMax.call(this);this.handleQueueRequests_()};g.disposeInternal=function(){Do.superClass_.disposeInternal.call(this);q.clearTimeout(this.delayTimeout_);this.requestQueue_.clear();this.requestQueue_=null};var Eo=function(a,b,c,d){this.headers_=a;this.withCredentials_=!!d;Do.call(this,b,c)};u(Eo,Do);Eo.prototype.createObject=function(){var a=new Y,b=this.headers_;b&&b.forEach(function(b,d){a.headers.set(d,b)});this.withCredentials_&&(a.withCredentials_=!0);return a};Eo.prototype.objectCanBeReused=function(a){return!a.disposed_&&!a.isActive()};var pi=function(a){this.databaseId=a.databaseId;this.pool=new Eo;this.baseUrl=(a.ssl?"https":"http")+"://"+a.host},Fo=function(a,b,c){if(c)for(var d in c.authHeaders)c.authHeaders.hasOwnProperty(d)&&(b[d]=c.authHeaders[d]);b["X-Goog-Api-Client"]="gl-js/ fire/0.5.0";b["google-cloud-resource-prefix"]="projects/"+a.databaseId.projectId+"/"+("databases/"+a.databaseId.database)},Ug=function(a,b,c,d){var e=Go(a,b);return new Promise(function(f,h){a.pool.getObject(function(l){l.listenOnce("complete",function(){try{switch(l.lastErrorCode_){case 0:if(l.xhr_)b:{var c=
l.xhr_.responseText;if(q.JSON)try{var d=q.JSON.parse(c);S("object"==typeof d);var e=d;break b}catch(Qc){}e=Wl(c)}else e=void 0;var p=e;x("Connection","XHR received:",JSON.stringify(p));f(p);break;case 8:Ia('RPC "'+b+'" timed out, retrying.');h(new A("deadline-exceeded","Request time out"));break;case 6:var w=Im(l);Ia('RPC "'+b+'" failed with status:',w,"response text:",Gm(l));0<w?h(new A(qh(w),"Server responded with status "+ao(l))):(Ia("Connection",'RPC "'+b+'" failed, retrying.'),h(new A("unavailable",
"Connection failed.")));break;default:y('RPC "'+b+'" failed with unanticipated webchannel error '+l.lastErrorCode_+": "+l.getLastError()+", giving up.")}}finally{x("Connection",'RPC "'+b+'" completed.'),p=a.pool,p.inUseSet_.remove(l)&&p.addFreeObject(l)}});var p=JSON.stringify(c);x("Connection","XHR sending: ",e+" "+p);var w={"Content-Type":"text/plain"};Fo(a,w,d);l.send(e,"POST",p,w,15)})})},Hg=function(a,b,c){var d=Ho[b],e=Io[b];d&&e||y("Unknown RPC name: "+b);d=[a.baseUrl,"/",d,"/",e,"/channel"];
wo();b={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},sendRawJson:!0,supportsCrossDomainXhr:!0};Fo(a,b.initMessageHeaders,c);a=d.join("");x("Connection","Creating WebChannel: "+a+" "+b);var f=new to(a,b),h=!1,l=!1,p=new Bj({sendFn:function(a){l?x("Connection","Not sending because WebChannel is closed:",a):(h||(x("Connection","Opening WebChannel transport."),f.open(),h=!0),x("Connection","WebChannel sending:",a),f.send(a))},closeFn:function(){return f.close()}});a=
function(a,b){f.listen(a,function(a){try{b(a)}catch(Sd){setTimeout(function(){throw Sd;},0)}})};a("a",function(){l||x("Connection","WebChannel transport opened.")});a("b",function(){l||(l=!0,x("Connection","WebChannel transport closed"),Cj(p))});a("c",function(a){l||(l=!0,x("Connection","WebChannel transport errored:",a),Cj(p,new A("unavailable","The operation could not be completed")))});a("d",function(a){if(!l){var b=a.data[0];z(!!b,"Got a webchannel message without data.");if(a=b.error||b[0]&&
b[0].error){x("Connection","WebChannel received error:",a);b=a.status;var c=oh[b];c=void 0!==c?Ig(c):void 0;var d=a.message;void 0===c&&(c="internal",d="Unknown error status: "+b+" with message "+a.message);l=!0;Cj(p,new A(c,d));f.close()}else x("Connection","WebChannel received:",b),z(null!==p.wrappedOnMessage,"Cannot call onMessage because no callback was set"),p.wrappedOnMessage(b)}});setTimeout(function(){z(null!==p.wrappedOnOpen,"Cannot call onOpen because no callback was set");p.wrappedOnOpen()},
0);return p},Go=function(a,b){var c=[a.baseUrl,"/","v1beta1"];c.push("/projects/");c.push(a.databaseId.projectId);c.push("/databases/");c.push(a.databaseId.database);c.push("/documents");c.push(":");c.push(b);return c.join("")},Ho={Write:"google.firestore.v1beta1.Firestore",Listen:"google.firestore.v1beta1.Firestore"},Io={Write:"Write",Listen:"Listen"};var Jo=function(){this.emptyByteString="";this.base64Available="undefined"!==typeof atob};Jo.prototype.atob=function(a){return atob(a)};Jo.prototype.btoa=function(a){return btoa(a)};var Ko=new Jo;Ja&&y("Platform already defined");Ja=Ko;if("undefined"!==typeof firebase&&"undefined"!==typeof firebase.INTERNAL)Aj();else throw Error("Firebase SDK not found.");; }).call(this);